<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: October 2002 Archives</title>


    <link rel="prev" href="/pub/2002/09/" title="September 2002" />
    <link rel="next" href="/pub/2002/11/" title="November 2002" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">October 2002 Archives</h1>





                            
                            <div id="entry-1382" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/10/30/topic.html" rel="bookmark">On Topic</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                <abbr class="published" title="2002-10-30T00:00:00-08:00">October 30, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->


<p>A few concepts in Perl 6 are strange at first sight. They seem hard to
understand, but it's only because they're new and different. They aren't
deep mystical concepts known only to Tibetan lamas. Anyone can
understand them, but it helps to start with a common-sense explanation.</p>
<p>This article looks at the concepts of &quot;topic&quot; and &quot;topicalizer&quot;. The
words aren't quotes from a particularly nasty bit of Vogon poetry.
They're actually common terms from the field of linguistics ... which
some might say is even worse. Still, the best way to understand topic in
Perl is to understand its source.</p>

<h3><a name="topic in linguistics">Topic in Linguistics</a></h3>
<p>Every larger unit of human language has a topic -- whether it's a
sentence, a paragraph, a conversation or some other sizable chunk. The
topic is the central idea of the unit. It's the focus of what's
communicated. Native speakers usually have no trouble figuring out what
the current topic is, when they think about it. If two little old ladies
were talking over a cup of tea:</p>
<p><em>&quot;I saw Lister yesterday.&quot;</em></p>
<p><em>&quot;Really? What's he up to these days?&quot;</em></p>
<p><em>&quot;Oh, you know, drunk again, and mooning over that awful Krissy
     Kochanski.&quot;</em></p>
<p>etc ...</p>
<p>and someone asked an observer what the conversation was about, they
would instantly reply &quot;Lister&quot;.</p>
<h3><a name="topicalizers in linguistics">Topicalizers in Linguistics</a></h3>
<p>A topicalizer is simply a word that marks some thing or some idea as the
current topic. In English, we have topicalizers such as &quot;for&quot;, &quot;given&quot;
and &quot;regarding&quot;:</p>
<p><em>&quot;For our first trick tonight, ladies and gentlemen, my partner Kryten
will attempt to eat a boiled egg.&quot;</em></p>
<p><em>&quot;Given that God is infinite, and that the universe is also infinite,
would you like a toasted tea-cake?&quot;</em></p>
<p><em>&quot;Regarding topicalizers, I should point out that this sentence starts
with one.&quot;</em></p>
<h3><a name="topic in perl">Topic in Perl</a></h3>
<p>Now we need to adapt the linguistic definition of topic to Perl. In
Perl, the topic is the most important variable in a block of code. It
can be any variable: a scalar, array, hash, object. To be more
accurate, it's the underlying storage location that's the topic. This
might sound a little too abstract, but it's an important distinction.
Variables are really only names we use to get at stored values. A single
storage location can have multiple names. In English, &quot;Rimmer&quot;, &quot;he&quot; and
&quot;the hologram&quot; could all appear in a text meaning the same person. In
Perl $_, $name, %characters{'title'} and any number of other variables
could appear in a section of code as different ways of accessing a
single value. And if that value is the current topic then all the
variables connected to it are too. This will be important later.</p>
<p>At this point, the average reader is thinking &quot;That's very interesting,
but why do I care what the topic is? I've gotten along just fine without
it all these years. Why start now?&quot;</p>
<p>And the answer is: it's not required. No one has to understand topic to
use it, any more than they have to understand gravity to catch a ball.</p>
<p>Why? It's a really simple rule. We'll call it the first law of topics:
Topic is $_. Any time a value becomes the current topic, $_ becomes
another one of the names for that value. We say $_ is aliased to it. So,
all it takes to use topic is to use $_ either explicitly or implicitly
in all the old familiar places, like <code>chomp</code>, <code>print</code> and
substitutions, and in a few new places, like <code>when</code> statements and with
unary dot.</p>
<p>Even so, it's still a good idea to understand topic. Understanding
gravity makes a number of things that seem unrelated suddenly fit.
Things like apples falling, planes crashing, the way the moon and sun
move, baseball, and rollercoasters. It's the same with topic. Any
programmer can use $_ without understanding topic. But when they
understand topic, it becomes a logical system instead of a random
collection of &quot;things $_ does&quot;. I like logical systems.</p>
<h3><a name="topicalizers in perl">Topicalizers in Perl</a></h3>
<p>A topicalizer in Perl is a keyword or construct that makes a value
become the current topic. The current topicalizers are <code>given</code>, <code>for</code>,
<code>method</code>, <code>rule</code>, <code>-&gt;</code>, certain bare closures, and <code>CATCH</code>
blocks, but the cast of characters keeps growing.</p>
<h4><a name="coal and switches">Coal and Switches</a></h4>
<p>Perl 6's switch, the <code>given</code> construct, is the prime example of a
topicalizer. Its sole purpose is to make the value passed to it the
current topic within the block.</p>
<pre><code>
    given $name {
        when &quot;Lister&quot; { print &quot;I'm a curryaholic.&quot; }
        when &quot;Cat&quot;    { print &quot;Orange?! With this suit?!&quot; }
        when &quot;Rimmer&quot; { print &quot;4,691 irradiated haggis.&quot; }
    }</code></pre>
<p>So, in this example, the <code>given</code> makes $name the current topic by
aliasing it to $_. Then the <code>when</code> statements compare against $_. After
the block, $_ regains the value in the outer scope. In Perl 6, $_ is
just an ordinary lexical variable and every topicalizer creates its own
$_ variable, lexically scoped to its associated block.</p>
<h4><a name="fruit loops and m&m's">Fruit Loops and M&amp;M's</a></h4>
<p>The <code>for</code> loop is the classic topicalizer. It was topicalizing long
before most of us had a word for the activity. <code>for</code> is similar to
<code>given</code>, but instead of creating a single topic, it creates a series of
topics, one for each iteration.</p>
<pre><code>
    for @orders {
        when /scone/ {
            print &quot;Would you like some toast?&quot;;
        }
        when /croissant/ {
            print &quot;Hot, buttered, scrummy toast?&quot;;
        }
        when /toast/ {
            print &quot;Really? How about a muffin?&quot;;
        }
    }</code></pre>
<p>Just like <code>given</code>, <code>for</code> takes a value, in this case the current
element of the array, and makes it the topic.</p>
<p>In simple cases like these, both <code>for</code> and <code>given</code> create the $_ alias
read-write. This is the same as Perl 5: any change to $_ inside the
block modifies the original value.</p>
<h4><a name="bow and arrow">Bow and Arrow</a></h4>
<p>The new and improved arrow (<code>-&gt;</code>) is the most flexible topicalizer.
It appears in a variety of different contexts. By itself <code>-&gt;</code>
creates an anonymous subroutine just like <code>sub</code>.</p>
<pre><code>
        -&gt; $param { ... }</code></pre>
<pre><code>
        # is the same as:</code></pre>
<pre><code>
        sub ($param) { ... }</code></pre>
<p>The only differences are that <code>-&gt;</code> doesn't require parentheses
around its parameter list, and that <code>-&gt;</code> topicalizes its first
parameter.</p>
<p>In the following example, the first expression creates an anonymous sub
and stores it in $cleanup. When the sub stored in $cleanup executes,
the $line parameter takes the string argument and becomes the current
topic, so both $line and $_ are aliased to the value of $intro. The
usual suspects, <code>chomp</code>, substitution and <code>print</code> then use the topic
as default.</p>
<pre><code>
    $cleanup = -&gt; $line is rw {
        s:w/Captain Rimmer!/the bloke/;
        $line _= &quot; who cleans the soup machine!&quot;;
        print;
    }</code></pre>
<pre><code>
    $intro = &quot;Fear not, I'm Captain Rimmer!&quot;;
    $cleanup($intro);</code></pre>
<p>Unlike the simple <code>for</code> and <code>given</code>, the arrow creates its aliases
read-only by default. The <code>is rw</code> property marks both the named alias
and the $_ alias as read-write. Without the property attached, any
statements within the block that modify $line or $_ cause a compile-time
error just as if they had been explicitly flagged <code>is constant</code>.</p>
<p>The arrow isn't limited to working alone. It can also combine with other
topicalizers. When it does, it creates a named alias for the current
topic.</p>
<pre><code>
    for @lines -&gt; $line is rw {
        s:w/Captain Rimmer!/the bloke/;
        $line _= &quot; who cleans the soup machine!&quot;;
        print;
    }</code></pre>
<p>As the <code>for</code> iterates over the array it aliases every element in turn
to $line and to $_. This takes the place of the Perl 5 way of aliasing a
loop variable:</p>
<pre><code>
    # Perl 5
    for my $line (@lines) {
        $line =~ s/Captain Rimmer!/the bloke/;
        $line .= &quot; who cleans the soup machine!&quot;;
        print $line;
    }</code></pre>
<p>The Perl 6 way has some added benefits, though. Since the arrow aliases
both $line and $_ to the current value, it works with the defaulting
constructs, like <code>print</code>, but also provides a more meaningful name than
$_ when an explicitly named variable is necessary.</p>
<p>The first example of <code>for</code> and the example of the anonymous sub
reference are fascinatingly similar. The only difference is one is
stored in a variable to be called later and one is tacked onto a <code>for</code>.
Really, all the <code>for</code> example has done is replace the loop's block with
an anonymous sub reference. This is the second advantage of the Perl 6
way. Because $line is now the parameter of a subroutine, it's
automatically lexically scoped to the block. The <code>my</code> happens
implicitly.</p>
<p>The arrow also combines with constructs that aren't topicalizers, like
<code>if</code> and <code>while</code>, and allows them to topicalize.</p>
<pre><code>
    if %people{$name}{'details'}{'age'} -&gt; $age {
        print &quot;$age already?\n&quot;;
        if $age &gt; 3000000 {
            print &quot;How was your stasis?\n&quot;;
        } elsif $age &lt; 10 {
            print &quot;How 'bout a muffin?\n&quot;;
        }
    }</code></pre>
<p>As the <code>if</code> tests the truth value of the element of the data structure,
the arrow also aliases that value to $age and to $_. The example could
have accessed the hash of hashes of hashes directly each time it needed
the age value, but the short alias is much more convenient.</p>
<p>This feature is really only useful with simple truth tests. The truth
value tested in the following example isn't <code>3</code> or $counter, it's the
result of a complex conditional, <code>$counter &gt; 3</code>.</p>
<pre><code>
    if $counter &gt; 3 -&gt; $value {
        # do something with $value
    }</code></pre>
<p>The result will be true or false, but if it's false, the block will
never execute. In fact, when the truth test is false, $value is never
aliased at all. It simply doesn't exist. A lexically scoped variable
with a true value would have the same effect.</p>
<pre><code>
    if $counter &gt; 3 {
        my $value = 1;
        # do something with $value
    }</code></pre>
<p>So the arrow isn't a Ronco plum-pitter, yoghurt-squirter, do-everything
tool. When it's useful, it's very, very useful, but when it's not...
well... don't use it. <code>:)</code></p>
















<h4><a name="method in my madness">Method in my Madness</a></h4>
<p>Methods topicalize their invocant. An invocant is the object on which a
method is called. After saying that 10 times fast, anyone can see why it
needed a name. The design team chose &quot;invocant&quot;. Methods topicalize the
invocant when it's a named parameter like $self:
</p>
<pre><code>

    method sub_ether ($self: $message) {
        .transmit( .encode($message) );
    }</code></pre>
<p>and when it's left implicit:</p>
<pre><code>
    method sub_ether {
        .transmit( .encoded_message );
    }</code></pre>
<pre><code>
    method sub_ether (: $message) {
        .transmit( .encode($message) );
    }</code></pre>
<p>This is handy in short methods. The unary dot is just another defaulting
construct. Any method call without an explicit object executes on the
current topic. In the previous examples, <code>.transmit</code> is exactly the
same as <code>$self.transmit</code> and <code>$_.transmit</code>.</p>
<h4><a name="the sub of all fears">The Sub of All Fears</a></h4>
<p>Unlike methods and the arrow, ordinary subs don't topicalize, at least
not by default. The following example will either print nothing, or else
print a stray $_ that is in lexical scope wherever the sub is defined.</p>
<pre><code>
    sub eddy ($space, $time) {
        print;
    }</code></pre>
<p>Subs can topicalize, though, with a little help from the <code>is topic</code>
property. The property flags a parameter as the topic within the
subroutine's block. It can be attached to any parameter in the list, but
not to more than one parameter at a time.</p>
<pre><code>
    sub eddy ($space, $time is topic) {
        print;
    }</code></pre>
<p>Built-in functions like <code>print</code> that default to the current topic when
they're called are incredibly useful. Wouldn't it be great to have
user-defined subroutines that behaved the same way? But, since $_ is now
just an ordinary lexical variable, a subroutine generally can't access
the topic from its caller. It can only access variables in the scope
where it is defined.</p>
<p>The <code>is given</code> property gives subroutines access to their caller's
topic. It accesses the topic within the caller's scope and binds it to
the property's parameter.</p>
<pre><code>
    sub print_quotes is given($default) {
        print &quot;Random Quote: &quot;;
        print $default;
    }
    ...
    given $quote {
        print_quotes;
    }</code></pre>
<p>The <code>is given</code> property can appear on subroutines with a full parameter
list as well. The only restriction is that the property's parameter
can't have the same name as a parameter in the full list.</p>
<pre><code>
    sub print_quotes (*@quotes) is given($default) {
        print &quot;Random Quote: &quot;;
        if ( @quotes.length &gt; 0 ) {
            print @quotes;
        } else {
            print $default;
        }
    }</code></pre>
<p>(A true simulation of the built-in print function would use multimethod
dispatch, but that's outside the scope of this article.)</p>
<p>The property's parameter can have any name, but a parameter named $_ or
one that has the <code>is topic</code> property attached will set the caller's
topic as the topic within the subroutine as well.</p>
<pre><code>
    sub print_quotes is given($_) {  
                # alias $_ to caller's $_
        print;  # prints the value of caller's $_
    }
    # or
    sub print_quotes is given($default is topic) { 
                # alias $default to caller's $_
                # and to $_ within the subroutine
        print;  # prints $default, the value of caller's $_
    }</code></pre>
<h4><a name="perl rules!">Perl Rules!</a></h4>
<p>Grammar rules and closures within a rule topicalize their state object.
This is convenient because it means methods on the state object can use
the unary dot syntax.</p>
<pre><code>
    m:each/ aardvark { print .pos } /</code></pre>
<p>The state object for a rule is similar to the $self object for a method.
It's an instance of a grammar class. Named rules are really just named
methods called on the state object and anonymous rules and closures
within a rule are really just anonymous methods called on the state
object. Unfortunately, that's just enough information to be tantalizing
without actually being useful, but a full explanation could take up an
entire article. Still, knowing that the state object is like a $self
object is a step in the right direction.</p>
<h4><a name="the catcher in the try">The <code>CATCH</code>-er in the <code>try</code></a></h4>
<p><code>CATCH</code> blocks always topicalize the error variable, <code>$!</code>. This
streamlines the exception catching syntax because the <code>CATCH</code> block
acts as its own switch statement.</p>
<pre><code>
    CATCH {
        when Err::WrongUniverse {
            try_new_universe();
        }
    }</code></pre>
<p>This is much tidier than the equivalent:</p>
<pre><code>
    CATCH {
        if $!.isa(Err::WrongUniverse) {
            try_new_universe();
        }
    }</code></pre>
<h4><a name="the bare truth">The Bare Truth</a></h4>
<p>Bare closures topicalize their first argument. If the block uses
placeholder variables, the topic is also aliased to the
Unicode-abetically first variable. The topic is lexically scoped to the
block, but it is a read-write parameter, so modifications to $_ within
the block modify the original value.</p>
<pre><code>
    %commands = (
        add  =&gt; { $^a + $^b },
        incr =&gt; { $_  + 1 },
    );</code></pre>
<p>Constructs like <code>grep</code> and <code>map</code> are no longer special because they
use $_ within the block argument. They simply benefit from the normal
behavior of bare blocks.</p>
<pre><code>
    @names = map { chomp; split /\s*/; } @input;</code></pre>
<h4><a name="nesting instinct">Nesting Instinct</a></h4>
<p>Nested topicalizers are a little more complicated. The following example
starts with $name as the topic and the first case matches against it.
Within the case, the <code>print</code> also defaults to the current topic. The
second case is a little more complicated; it contains a loop. Within the
loop is another <code>print</code> statement. This one also defaults to the
current topic which is... Hmmmm... is the topic $name or $quote?</p>
<pre><code>
    given $name {
        when /Rimmer/ {
            print;
            print rimmer_quote();
        }
        when /Kryten/ {
            for kryten_quotes() -&gt; $quote {
                print;
            }
        }
    }</code></pre>
<p>The answer falls out of a few simple rules:</p>
<ul>
<li>
There is only one topic at a time.</li>
</ul>
<p>A series of nested topicalizers doesn't create a collection of topics.
The interpreter doesn't have to sort through a complicated set of
options to know what the current topic is. There will never be any
ambiguity. A script or module may have a series of different topics, but
only one at a time.</p>
<ul>
<li>
Topic obeys the lexical scope of topicalizers.</li>
</ul>
<p>For the programmer, determining the current topic is never any more
complex than tracing outward to the nearest topicalizer. The scope of
the topic is always restricted to the scope of the topicalizer that
created it. So the example above will print the inner topic, $quote.</p>
<p>An equivalent pair of nested topicalizers in Perl 5 would have printed
the outer topic instead. That's because topicalizers never created a $_
alias at the same time as a named alias. It's a fairly common trick in
Perl 5 to use a named alias with a <code>for</code> loop to avoid clobbering $_.
That trick doesn't work anymore. Which brings us to the third rule:</p>
<ul>
<li>
To keep outer topics, use a named alias.</li>
</ul>
<p>It's just the old trick inverted. Instead of using a named alias with
the inner topicalizer to avoid clobbering the outer topic, it uses a
named alias with the outer topicalizer to access it after the topic has
changed.</p>
<pre><code>
        when /Kryten/ {
            for kryten_quotes() -&gt; $quote {
                print $name;
                print;
            }</code></pre>
<p>This really fits better with the way humans think. It makes more sense
to give a name to the thing worth keeping than to give a name to the
thing to be thrown away.</p>
<p>Methods have the same problem, but in their case it means that even
though the unary dot is really handy in simple methods, in more complex
methods with nested topicalizers it's better to use a named parameter
for the invocant.</p>
<pre><code>
    method locate ($self: *@characters) {
        .cleanup_names(@characters);
        for @characters -&gt; $name {
            .display_location($name);
        }
        .change_location('Holly');
    }</code></pre>
<p>The <code>.display_location</code> method won't call a method on $self, it will
try to call a method on $name, and fail (unless $name is an object with
a <code>.display_location</code> method). The code will have to call the method as
<code>$self.display_location()</code> instead. It would be clearer to add $self in
front of the other method calls as well, but that's entirely a matter of
style.</p>
<h4><a name="multiple aliases">Multiple aliases</a></h4>
<p>Another complication is that topicalizers aren't restricted to a single
alias. A <code>for</code> loop might iterate through an array several parameters
at a time:</p>
<pre><code>
    for @characters -&gt; $role1, $role2, $role3 {
        ...
    }</code></pre>
<p>iterate through several arrays, one after the other, taking a few
parameters at a time:</p>
<pre><code>
    for @humans, @betelgeusians, @vogons -&gt; $role1, $role2 {
        ...
    }</code></pre>
<p>or iterate through several arrays at the same time:</p>
<pre><code>
    for @characters; @locations -&gt; $name; $place {
        ...
    }</code></pre>
<p>But no matter how complicated the code gets, the topic stays the same.
The rules of the game are:</p>
<ul>
<li>
There is only one topic.</li>
</ul>
<p>This rule should look familiar. It might even deserve to be called &quot;the
second law of topics&quot;. With nested topicalizers, the restriction means
that two topics from different scopes will never be accessible at the
same time. With multiple aliases, it means that while a topicalizer can
create more than one alias, only one of the aliases can be the topic.</p>
<ul>
<li>
The topic is the first parameter.</li>
</ul>
<p>This rule makes it easy to pick out the topic. In the first two examples, the topic is $role1, and in the third example it's $name.</p>
<p>There is one exception to the rule. The <code>is topic</code> property can select
any parameter as topic in place of the default first parameter.</p>
<pre><code>
    for @characters -&gt; $role1, $role2 is topic, $role3 {
        ...
    }</code></pre>
<h3><a name="the final frontier">The Final Frontier</a></h3>
<p>That's pretty much all there is to topic. Hopefully, this article has
pushed one more thing into the &quot;Gee, that's easy!&quot; category. But, if
not, carry away one idea: that first law, &quot;Topic is $_&quot;. The next time
conversation turns to Perl 6 and topic, that simple translation will
make it understandable.</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1380" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/10/22/phrasebook.html" rel="bookmark">The Phrasebook Design Pattern</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Rani Pinchuk</span> on <abbr class="published" title="2002-10-22T00:00:00-08:00">October 22, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
             
<!-- sidebar begins -->
<!-- don't move sidebars -->
<!-- sidebar ends -->

<p>Have you ever written a Perl application that connects to a database? If
so, then you probably faced a problem of having some code like:</p>
<pre><code>
 $statement = q(select isbn from book where title = 'Design Patterns');
 
 $sth = $dbh-&gt;prepare($statement) ; 
 $rc=$sth-&gt;execute();</code></pre>
<p>Why is this &quot;a problem&quot;? It looks like nice code, doesn't it? Actually,
if you look at the code above, you will see two languages: Perl and SQL.
This makes the code not that readable. Besides, SQL statements
that are only slightly different may appear in several places, and this
will make it more difficult to maintain. In addition, suppose you have
an SQL expert who should optimize your SQL calls. How do you let him
work on the SQL; should he look through your Perl code for it? And 
what if that guy is so ignorant that he doesn't even know Perl?
</p>
<pre><code>

We can solve these problems by writing:</code></pre>
<pre><code>
 $statement = $sql-&gt;get(&quot;FIND_ISBN&quot;, { title =&gt; &quot;Design Patterns&quot; });
 $sth = $dbh-&gt;prepare($statement);
 $rc=$sth-&gt;execute();</code></pre>
<p>We keep the actual SQL statements and their corresponding lookup keys
in a separate place that we call a phrasebook. We can use XML to wrap
the SQL and the lookup keys:</p>
<pre><code>
 ... 
 &lt;phrase name=&quot;FIND_ISBN&quot;&gt;
   select isbn from book where title = '$title' 
 &lt;/phrase&gt; 
 ...</code></pre>
<p>As we can see above, the SQL statement can hold placeholders, so we
can use one generic SQL statement that can be used in different
places.</p>
<p>Now, our code is more readable and maintainable. As we will see later,
there are additional advantages for writing using the phrasebook design
pattern - it helps when we port the code, or when we debug.</p>
<p>Nevertheless, is it a design pattern at all? We saw only one problem and
one solution, right? So here are two more examples: When you
need to generate an error code from your application, you might have in
your code two languages: Perl and English. Moreover, suppose you want to
have later the error code in other languages? The phrasebook design
pattern suggests that you should separate the languages, and put the
error messages in a phrasebook. It also guides you as to how to have the
error messages in different languages.</p>
<p>Suppose you write a code generator that generates PostScript. In order
to have readable code, it is better to separate the PostScript code
from the rest of your code, and put it in a phrasebook.  
</p>

<p>If you are particularly interested, then you can find the original Phrasebook
Design Pattern paper in
<a href="http://jerry.cs.uiuc.edu/~plop/plop2k/proceedings/Pinchuk/Pinchuk.pdf">http://jerry.cs.uiuc.edu/~plop/plop2k/proceedings/Pinchuk/Pinchuk.pdf</a>.
</p>

<p>Because our examples above were about writing applications that
uses database, I would like to add a paragraph or two about
persistency. Some readers might argue that instead of having the SQL
code within our Perl code, or even within our phrasebook,  we should
create objects that take the responsibility for connecting to the
database, and load or save themselves. This way, if we use those
objects, we need no SQL in the rest of our code. There are two points
to make in this context:</p>

<p>I would suggest the use of the phrasebook within the classes that
implement those persistence objects. This way, the code of those classes
will gain from the advantages that the phrasebook pattern offers.</p>
<p>Usually a persistence object represents one or more tables in the
database. The idea is that we should not access those tables without
using the object. Yet, in my experience, because of performance issues,
you may need complex SQL statements that access tables belonging to more
then one object. So the programmer might find himself writing an SQL
statement in his main application anyway, instead of using the
persistence objects.</p>


<h3><a name="class::phrasebook">Class::Phrasebook</a></h3>
<p>You probably guessed already that the phrasebook class implements the
phrasebook design pattern. Like the rest of the classes that are
described in this paper, it is available for downloading from
CPAN. Let us see how we use that class to generate some error codes in
different languages (English and Dutch for example).</p>
<p>We begin with writing the phrasebook. The phrasebook is a simple
XML file. It will look like:</p>
<pre><code>
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;
 &lt;!DOCTYPE phrasebook [
 &lt;!ELEMENT phrasebook (dictionary)*&gt;
 &lt;!ELEMENT dictionary (phrase)*&gt;
 &lt;!ATTLIST dictionary name CDATA #REQUIRED&gt;
 &lt;!ELEMENT phrase (#PCDATA)&gt;
 &lt;!ATTLIST phrase name CDATA #REQUIRED&gt;
 ]&gt;</code></pre>
<pre><code>
 &lt;phrasebook&gt;
  &lt;dictionary name=&quot;EN&quot;&gt;
   &lt;phrase name=&quot;MISUSE_OF_MANUAL_TEMPLATE_NAME&quot;&gt;
     The name $name can be used only as manual template
   &lt;/phrase&gt;
   ...
  &lt;/dictionary&gt;
  &lt;dictionary name=&quot;NL&quot;&gt;
   &lt;phrase name=&quot;MISUSE_OF_MANUAL_TEMPLATE_NAME&quot;&gt;
    De naam $name mag enkle gebriuk worden als webboek template
   &lt;/phrase&gt;
   ...
  &lt;/dictionary&gt; 
 &lt;/phrasebook&gt;</code></pre>
<p>As we can see, the phrasebook file starts with the Document Type
Definition (DTD). Don't panic - just copy it as is. It is used by the
XML parser to validate the XML code. Then we open the definition of
the phrasebook, and inside it one or more definitions of
dictionaries. Each dictionary will hold the phrases. The first
dictionary is taken as the default dictionary: if a phrase is missing
in other dictionary, it will be taken from the first one. The phrases
can hold placeholders. The placeholders look exactly like Perl scalar
variables.</p>
<p>Now let's see how we get a phrase from the phrasebook:</p>
<pre><code>
 ...
 $msg = new Class::Phrasebook($log, &quot;errors.xml&quot;);
 $msg-&gt;load($language);
 ...
 # check that the name of the document is not a manual_template name
 if (is_manual_template_name($template_name)) {
    my $message = $msg-&gt;get(&quot;MISUSE_OF_MANUAL_TEMPLATE_NAME&quot;,
                            { name =&gt; &quot;$template_name&quot;} ); 
    $log-&gt;write($message, 5);
    return 0;
 }</code></pre>
<p>First, we create the Class::Phrasebook object. We supply to the
constructor a Log::LogLite object and a name of the XML file that
contains the phrasebook we want to use. We will discuss the Log::LogLite
class later. For now, you should only know that this class provides with
the ability to have log messages - so if, for example, our new
Class::Phrasebook object fails to find the XML file, a log message will
be written to a log file.</p>
<p>How the XML file will be found if we do not supply any path? The class
automatically searches the following directories:</p>
<ul>
<li>
The current directory.</li>

<li>
The directory ./lib in the current directory.</li>

<li>
The directory ../lib in the current directory.</li>

<li>
@INC.</li>
</ul>
<p>This allows us to create an XML file that comes with a module in an easy
way: We should place the XML file in a lib directory below the
directory of our module. Therefore, if the module we write is <em>Blah</em>, then its
XML file will be placed in the directory <em>Blah/lib</em>. Of course, it is
a good idea to give the XML file a name that is similar to the
module name - <em>blah.xml</em>, so it will be unique on the system (because
&quot;make install&quot; will install the XML file next to the module file
<em>Blah.pm</em>).</p>















<p>The next thing we do is to load a dictionary from the phrasebook
file. The $language variable above will hold the dictionary name -
in our example, it will be &quot;EN&quot; or &quot;NL&quot;.</p>
<p>Finally, when we need to get the text for an error message, we call the
get method of the Class::Phrasebook object with the key of the message
we want to get, and a reference to a hash that holds the name-value
pairs of the placeholders within the phrase.</p>
<p>Some careful readers might point out that if we use the
Class::Phrasebook inside another class, then we might end up with a memory
problem. Suppose many of the other class objects are constructed, and
all of them load the same dictionary using the Class::Phrasebook
objects. We will end up with many identical dictionaries loaded into
the memory.</p>
<p>For example, assume we have object User that uses an object of
Class::Phrasebook to generate error messages. When we construct the
User object, we also construct a Class::Phrasebook object and load the
dictionary for the error messages in the right language. Let's assume
we have 100 User objects that are supposed to provide the error messages in
English. It means that those 100 User objects will hold 100
Class::Phrasebook objects and each of them will hold its own copy of
the English error dictionary. Terrible loss of memory!</p>
<p>Well, not exactly. The Class::Phrasebook keeps the loaded dictionaries
in a cache that is actually class data. That means that all the
objects of Class::Phrasebook have one cache like that. The cache is
managed by the class, and knows to load only one dictionary of each
sort. It will know also to delete that dictionary from the memory when
there are no more objects that refer to it. Therefore, the careful
readers should not worry about this issue any more.</p>
<p>However, continuing the example above, sometimes we might load the 100
User objects one after the other. Each time, that object will be
destroyed. Other careful reader might point out that in this case the
dictionary will go out of scope every time, and actually we will load
the same dictionary 100 times!</p>
<p>Because of that, the class provides for that careful reader a class
method that configures the class to keep the loaded dictionaries in the
cache forever. This is not the default behavior, but when coding
daemons, for example, it will be desirable.</p>


<h3><a name="class::phrasebook::sql">Class::Phrasebook::SQL</a></h3>
<p>The class Class::Phrasebook::SQL is a daughter class of
Class::Phrasebook. It provides us with some extra features that helps us
to deal with SQL phrases more easily. One example is the way it deals
with the update SQL statement. Imagine that you have in your application
a form that the user is supposed to fill in. If the user fills in only
two fields, then you are supposed to update only those two fields in his
record. Usually this problem is solved by having a simple code that
builds our update SQL statement from its possible parts. However, this
will not be that readable. The Class::Phrasebook::SQL will let you do it
in the following way:</p>
<p>We will place as a phrase the update SQL statement with all the
possible fields:</p>
<pre><code>
 &lt;phrase name=&quot;UPDATE_T_ACCOUNT&quot;&gt;
   update t_account set
         login = '$login',
         description = '$description',
         dates_id = $dates_id,
         groups = $groups,
         owners = $owners
      where id = $id
 &lt;/phrase&gt;</code></pre>
<p>The Class::Phrasebook::SQL will drop the &quot;set&quot; lines, where there is a
placeholder that its value is undefined. As I wanted to avoid from
real parsing of the update statements, the update statements must look
as the example above - each &quot;set&quot; expression in different line. Now,
if we call the get method as the following:</p>
<pre><code>
 $statement = $sql-&gt;get(&quot;UPDATE_T_ACCOUNT&quot;,
                        { description =&gt; &quot;administrator of manuals&quot;,
                          id =&gt; 77 });</code></pre>
<p>We will get the statement:</p>
<pre><code>
 update t_account set
       description = 'administrator of manuals'
    where id = 77</code></pre>
<p>&quot;Set&quot; lines that contained undefined placeholders in the original update
statement were removed.</p>


<h3><a name="debugging_with_the_phrasebook_classes">Debugging With the Phrasebook Classes</a></h3>
Both the classes <code>Class::Phrasebook</code> and
<code>Class::Phrasebook::SQL</code> provide
us with debugging services. One example is the environment variable
<code>PHRASEBOOK_SQL_DEBUG_PRINTS</code>. If this variable holds the value &quot;TEXT&quot;
then it will print debug message each time the method C&lt;get&gt; is called:</code>
<pre><code>
 path = Oefeningen/logoklad.source
 [DBOrderedTreeUI.pm:322--&gt;DBOrderedTreeUI::show_list &gt; DBOrderedTreeUI.
 pm:4134--&gt;Manual::fill_node_info_container_from_list &gt; Manual.pm:2885--
 &gt;Document::load &gt; /htdocs/html/projects/webiso/code/classes/Document.pm
 :403--&gt;Revisions::load &gt; /htdocs/html/projects/webiso/code/classes/Revi
 sions.pm:114--&gt;Revision::load: ][GET_LAST_REVISION]</code></pre>
<pre><code>
        select path, major, minor, date, user_id,
               state_id, md5, data_md5, is_patch, is_changed 
            from revision 
            where path = 'Oefeningen/logoklad.source'
              and is_patch = 0</code></pre>
<p>If the value of the environment is &quot;COLOR&quot;, then the output would be with
colors. The colors come from the Term::ANSIColor module. If the value
is &quot;HTML&quot; then the output would be HTML code that generates a similar
colorful representation.</p>
<pre><code><font color=magenta> path = Oefeningen/logoklad.source</font></code></pre>
<pre><code> [<font color=darkgreen>DBOrderedTreeUI.pm:322-->DBOrderedTreeUI::show_list > DBOrderedTreeUI 
 .pm:4134-->Manual::fill_node_info_container_from_list > Manual.pm:2885
 -->Document::load > /htdocs/html/projects/webiso/code/classes/Document
 .pm:403-->Revisions::load > /htdocs/html/projects/webiso/code/classes/
 Revisions.pm:114-->Revision::load: </font>]<font color=red>[</font><font color=blue>GET_LAST_REVISION</font><font color=red>]</font>
        select path, major, minor, date, user_id,
               state_id, md5, data_md5, is_patch, is_changed 
            from revision 
            where path = 'Oefeningen/logoklad.source'
              and is_patch = 0
  </code></pre>
  
  <p>Imagine that you need to see what are the SQL statements that are
generated from a certain piece of code. Setting the
PHRASEBOOK_SQL_DEBUG_PRINTS environment variable within that code will
do the trick in no time. This feature can help not only in debugging,
but also in the optimization of SQL code.</p>
<p>A similar environment variable is the
PHRASEBOOK_SQL_SAVE_STATEMENTS_FILE_PATH. When this environment is set
to a certain file path, all the SQL statements that are generated by
calling to the get method will be written to that file. That way, you
can see later which SQL statements your application issued, and even to
re-run them from that file.</p>
<p>Actually, this is the way I found a bug in one of the former versions of
the database PostgreSQL. I noticed that under certain conditions, some
select statements fail while they are not supposed to fail. As usual,
the &quot;certain conditions&quot; were totally unknown. What I did was to run
my application while having the environment
PHRASEBOOK_SQL_SAVE_STATEMENTS_FILE_PATH set. When the bug happened, I
took the file with all the SQL statements that I got and ran the SQL
statements directly from it. Then, I started to clean it until I had
only few SQL statements left, and still the bug happened when they
were run. I sent those statements with my report of the bug and got
within two hours a solution for the problem (Well - you know, when you
use open source software, you get support - and the PostgreSQL team is
very responsive).</p>


<h3><a name="log::loglite_and_log::nullloglite">Log::LogLite and Log::NullLogLite</a></h3>
<p>The Log::LogLite and the Log::NullLogLite classes provide us with an
excellent opportunity to introduce a beautiful design pattern called
the Null Object Design Pattern.</p>
<p>The Log::LogLite is a simple class that let us create simple log files
in our application. The synopsis from the manual page of the class
gives a good overview of how to use the class:</p>
<pre><code>
 use Log::LogLite;
 my $LOG_DIRECTORY = &quot;/where/ever/our/log/file/should/be&quot;;
 my $ERROR_LOG_LEVEL = 6;
 # create new Log::LogLite object
 my $log = new Log::LogLite($LOG_DIRECTORY.&quot;/error.log&quot;,
                            $ERROR_LOG_LEVEL); 
 ...
 # we had an error
 $log-&gt;write(&quot;Could not open the file &quot;.$file_name.&quot;: $!&quot;, 4);</code></pre>
<p>As we saw Class::Phrasebook demands the use of a Log::LogLite object. This
allows Class::Phrasebook to generate log messages when errors occur -
for example, when the parsing of the XML file fails. However, it might
be that we do not want to have a log file for every use of the
Class::Phrasebook. How can we avoid from having a log file without
changing the code of Class::Phrasebook?</p>
<p>The solution for that problem comes from the beautiful Null Object
Design Pattern by Bobby Woolf. The pattern guides us to inherit from
our class a null class - a class that does nothing, but implement the
same interface of the original class. In our example, Log::NullLogLite
overrides some of the methods of Log::LogLite to do nothing. So when we
call the method write, nothing is written. Because the
class inherits from Log::LogLite, the classes that use Log::LogLite
continue to run correctly also when we send to them Log::NullLogLite
objects.</p>


<h3><a name="conclusion">Conclusion</a></h3>
<p>The phrasebook design pattern helps us to get more readable and
maintainable code by separating expressions in one language from the
main code that is written in other language. The Class::Phrasebook
module helps us to implement this pattern in Perl.</p>
<p>The classes that are presented above have been used by my colleagues and 
me for few years. During that time, we could see in practice all the
advantages that the pattern promises. For example, an application of
65,000 lines had to be ported to another database. When the SQL code
is concentrated in XML files, we could achieve that kind of port very
rapidly.</p>
<p>In my opinion, Perl gives us a nice platform to program in
object-oriented techniques. However, I am not sure that this opinion is
well-spread. Many programmers stop learning when things they write start
running, and with Perl things start to run very soon. Nevertheless, with
good design, big and sophisticated applications can be written with
Perl, like with other OO languages.</p>


<h3><a name="thanks">Thanks</a></h3>
<p>Many thanks to Ockham Technology N.V. for letting me release the above 
modules and others as open source on CPAN. 

</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1386" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/10/p6pdigest/20021016.html" rel="bookmark">This week on Perl 6 (10/7-14, 2002)</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Leon Brocard</span> on <abbr class="published" title="2002-10-16T00:00:00-08:00">October 16, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>This is yet another Perl 6 summary documenting what has happened over
on the perl6-internals (where Parrot, the virtual machine that will
run Perl 6 is discussed) and perl6-language (where Perl 6 language
design is discussed) mailing lists. Piers is still on vacation
(bungee jumping and motocrossing, no doubt), so I'm still your host
this week. A fairly quiet week, so let's start with the
perl6-internals list as usual.</p>
<h3><a name="the pumpking is dead, long live the pumpking!">The Pumpking Is Dead, Long Live the Pumpking!</a></h3>
<p>I am happy to report that we have a new Parrot pumpking. Jeff Goff has
done great work in the past, but taking over is Steve Fink, who has
been active in Parrot since near the beginning. He's been extremely
active this week, participating in almost all of the discussions and
accepting patches left, right and center.</p>
<p><a href="http://groups.google.com/groups?as_umsgid=a05111b0eb9c788d82e71%40%5B63.120.19.221%5D">http://groups.google.com/groups</a></p>

<h3><a name="variables have three parts">Variables Have Three Parts</a></h3>
<p>Dan Sugalski decreed that vtables were about to get more
complicated. Variables and values used to be simple, but now we need
to have three parts for each ``thing:'' an optional name, a container
and the contents of the container. There wasn't any discussion, but I
expect Dan will rejig vtables some more.</p>
<p><a href="http://groups.google.com/groups?as_umsgid=a05111b07b9c6cdf2da21@[63.120.19.221]">http://groups.google.com/groups</a></p>

<h3><a name="line number metadata">Line Number Metadata</a></h3>
<p>Juergen Boemmels explained that the line number information given by
the <code>setline</code> opcode was quite verbose in the source and suggested
adding line number metadata into Parrot bytecode. He proposed using
the DWARF-2 debugging format (as used by the Mono project) so as not
to reinvent the wheel. Dan promised some specs for moving this
information out of band.</p>
<p>This thread quickly got out of hand, with Nicholas Clark noticing that
having column number information magically built in full debugging
support for Befunge (a two-dimensional language) and
Sean O'Rouke wishing to make ``source position'' a vector, thus
generalizing to scripting languages of any dimension.</p>
<p><a href="http://groups.google.com/groups?as_umsgid=m2bs66hzou.fsf@helium.physik.uni-kl.de">http://groups.google.com/groups</a></p>

<h3><a name="new array base">New Array Base</a></h3>
<p>Leopold Toetsch continued in his attempt to confuse the summarizer
with thousands of patches. He had rewritten the base routines from the
array PMC as a working engine for list operations. It should be fast
and simple, being based on chunks with fast index get and set. He
committed this as list.c, and commented that most of the other
array-style PMCs will start to use it as a base, and that it may
replace the intlist PMC (and other typed array PMCs).</p>
<p><a href="http://groups.google.com/groups?as_umsgid=3DA1FBCB.3030001@toetsch.at">http://groups.google.com/groups</a></p>

<h3><a name="parrot_sprintf">Parrot_sprintf</a></h3>
<p>Continuing last week's ``sprintf in Parrot'' mention, Brent Dax
committed a huge patch completing the feature set of Parrot_sprintf,
including width and precision for ints and strings, and modified many
little bits of code to use it.</p>
<p>Inspiration then struck him, or rather, vtables did. He's rewritten it
to use vtables, and split some of the code out of <code>misc.c</code> and into the
new <code>spf_render.c</code> and <code>spf_vtable.c</code>, which managed to turn into
another huge patch. Looks like there is a portability issue on PPC
systems with <code>va_copy</code> however.</p>
<p><a href="http://bugs6.perl.org/rt2/Ticket/Display.html?id=17791">http://bugs6.perl.org/rt2/Ticket/Display.html</a></p>
<p><a href="http://bugs6.perl.org/rt2/Ticket/Display.html?id=17817">http://bugs6.perl.org/rt2/Ticket/Display.html</a></p>
<h3><a name="nuke dem opcodes">Nuke dem opcodes</a></h3>
<p>Simon Glover proposed a patch to get rid of the 2-element ``ne'' opcode,
which at a first glance should be optimizable at compiler time and
hence should not be in Parrot -- barring complicated number precision
issues. After a little discussion, Nicholas Clark pointed out that
maybe we should do as C99 and state that constant folding will be done
at compile time and at the precision of the compiling Parrot. Some of
the opcodes where nuked, but it's important to keep some opcodes just
in case of overloading.</p>
<p><a href="http://groups.google.com/groups?as_umsgid=Pine.GSO.4.43.0210101155360.17996-100000@egg.amnh.org">http://groups.google.com/groups</a></p>
<h3><a name="getting started guide">Getting Started Guide</a></h3>
<p>Cast your minds back, dear readers, if you will, to last week, when
Erik Lechak proposed writing a getting-started guide. Well, he did
just that, starting from the beginning with the configure system and
then all the way out. There were many comments and suggestions, and it
would be great to see this as POD and in the repository
soon. Unfortunately, it is not in the archive.</p>
<h3><a name="larry explains all">Larry Explains All</a></h3>
<p>Perl6-language had very few new threads this week. Instead, there were
mostly little updates to previous threads, which makes it somewhat
tricky to summarize. However, Larry Wall was everywhere this week,
giving us detailed insights into the Perl 6 language.</p>
<p>Larry clarified that to remove ambiguity, variable properties will
surrounded in brackets and have repetitions of ``is'':</p>
<pre>
  # instead of this:
  my $foo is rw cmp &quot;&quot;;
  # we would have:
  my ($foo is foo is bar, $bar is baz) = (1,2);</pre>
<p>Additionally, it looked like class attributes had changed name from
<code>attr</code> to <code>has</code>.</p>
<p>There was also some talk on the module versioning system, which could
be done with a slice-like notation:</p>
<pre>
  use Acme[1.0];                  # like so
  use Acme[ (1;17..) | (2;0..) ]; # or perhaps
  use Acme[1;17..] | Acme[2;0..]; # or even</pre>
<p>I'm pretty sure he was joking, but Larry considered alternatives to
the <code>...</code>, which issues a warning (or maybe an exception) if you try
to execute it. <code>???</code> would never complain and <code>!!!</code> would always
throw an exception. Or the other way around. Or one is fatal. Or more
likely, stick with <code>...</code> and make its behaviour pragmatically
controllable. <code>...</code> is useful for abstract method declaration.</p>
<p>There definitely wasn't any talk about <code>&amp;&amp;&amp;</code> and <code>|||</code>.</p>
<h3><a name="perl6 oo cookbook">Perl6 OO Cookbook</a></h3>
<p>Michael Lazzaro made good on his promise last week and produced a
comprehensive Perl 6 OO cookbook describing ``stuff that hasn't yet
been designed, for a language that doesn't yet exist.'' It is a great
piece of work and tries to examine real-life Perl 6 examples.</p>
<p>There was some discussion of the recipes and the Michael announced
that he wanted to work on an online system for adding new data and
many other changes. Worried about Perl 6 OO? Then check this out:</p>
<p><a href="http://cog.cognitivity.com/perl6/">http://cog.cognitivity.com/perl6/</a></p>
<h3><a name="in brief">In Brief</a></h3>
<p>Some of the Parrot tests still don't work under Win32.</p>
<p>Some bugs in various bits of the Parrot JITs were found, and some
fixed.</p>
<p>Dakkar found a bug in the Perl 6 compiler that basically boiled down
to checking for truth instead of definedness. Hopefully, Perl 6 will
remove this particular problem for us ;-)</p>
<p>We probably need more tinderboxes.</p>
<p>Brent Dax promises to fit a pony into his next patch.</p>
<p>Simon Glover added quite a few tests and pieces of documentation.</p>
<p>C structs need to be padded for the more exotic architectures and
compilers.</p>
<p>There are still some DOD / GC bugs.</p>
<h3><a name="who's who in perl6">Who's Who in Perl6</a></h3>
<p>Once more we get to meet people involved in the development of Perl 6.</p>
<dl>
<dt><strong><a name="item_Who_are_you%3F">Who are you?</a></strong></dt>
<dd>
J&eacute;r&ocirc;me Quelin.</dd>

<dt><strong><a name="item_What_do_you_do_for%2Fwith_Perl_6%3F">What do you do for/with Perl 6?</a></strong></dt>
<dd>
I wrote a Befunge interpreter in Parrot assembly. Now I'm waiting for
Parrot to handle multi-arrays and objects in order to implement the
Befunge-98 specs.</dd>

<dt><strong><a name="item_Where_are_you_coming_from%3F">Where are you coming from?</a></strong></dt>
<dd>
Some Perl Golf rumors have said that I'm an alien coming from Mars.</dd>

<dt><strong><a name="item_When_do_you_think_Perl_6_will_be_released%3F">When do you think Perl 6 will be released?</a></strong></dt>
<dd>
Some day.</dd>

<dt><strong><a name="item_Why_are_you_doing_this%3F">Why are you doing this?</a></strong></dt>
<dd>
In order to have a chance to understand Perl 6 sources. And because
Befunge is a fun language, that deserves to be supported by Parrot.</dd>

<dt><strong><a name="item_You_have_5_words%2E_Describe_yourself%2E">You have five words. Describe yourself.</a></strong></dt>
<dd>
Perl Golf and Befunge addicted.</dd>

<dt><strong><a name="item_Do_you_have_anything_to_declare%3F">Do you have anything to declare?</a></strong></dt>
<dd>
Befunge rocks.</dd>
</dl>
<h3><a name="acknowledgements">Acknowledgements</a></h3>
<p>This summary was brought to you with slightly less distraction from
Super Mario Sunshine and more recognition of the sterling work that
Piers does every week.</p>
<p>As Piers says: One more, if you think this summary has value send
money to the Perl Foundation <a href="http://donate.perl-foundation.org">http://donate.perl-foundation.org</a> and
feed back and/or T?iBooks to me, <em><a href="mailto:mailto:pdcawley@bofh.org.uk">mailto:pdcawley@bofh.org.uk</a></em>. As
usual, the fee paid for publication of this summary on perl.com has
been donated directly to the Perl Foundation.</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1378" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/10/15/radiator.html" rel="bookmark">Radiator</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2002-10-15T00:00:00-08:00">October 15, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>
Are you fed up with those who think that commercial applications need to
be written in an "enterprise" language such as Java or C++? 
While we're big fans of open source at Perl.com, we're bigger fans
of Perl, and we're frustrated when people claim there's something that
Perl can't do; so we spoke to Mike McCauley at Open System Consultants.
</p>

<p> Open Systems produces <a href="http://www.open.com.au/radiator/index.html">Radiator</a>, a
commercial RADIUS server implementation, first released four years ago
and with new versions and enhancements continually developed. It has
about 5,000 paying installations worldwide. Mike explains: "It's used to
authenticate dialup and wireless access to an ISP or corporate network.
In order to authenticate users, it can look up user details in a wide
range of data sources, such as SQL, LDAP, flat files, Unix password
files, OPIE, PAM, Windows NT SAM, Active Directory, third-party billing
packages, and so on." </p>

<p>Mike was particularly impressed with Perl's write-once-run-anywhere
nature, which has completely obviated the need for porting or
platform-specific alteration. As he says, "The finished product runs
without change on almost every platform known to humanity. That means we
can appeal to more potential customers, with less effort spent on
porting and maintenance."</p>

<p>But there were other reasons for choosing Perl as an implementation
language: "The richness of Perl allows us to express
complicated algorithms quickly and concisely, and know they will work
wherever the customer wants to run the code; and the connect easily to
lots of different data sources." Perl's reusability and the great
library of code already available also played its part. "The modules
from CPAN mean we can talk to servers like SQL, LDAP, NISPLUS, Active
Directory, OpenSSL, and <b>lots</b> of other things. We can concentrate on
writing the product, rather than coding and maintaining interfaces."
</p>

<p>
We asked about the performance of going with Perl instead of, for example, C,
but this seemed not to be the problem that many people might expect.
"Most authentications rely on some external server or system, such
as an LDAP or SQL server, and so the speed determining step is usually that
extenal system. Also, the interfaces to those systems are generally compiled
Perl modules written in C. And where there is no external server, we can use
clever hashing mechanisms to make lookups faster than some C based Radius
servers. That means that Radiator can be up there with a server written in C,
and with much more features and flexibility."
</p>

<p> Mike also explained that good Perl programming practice can keep
performance high: "In order to get the best performance, you have to
code so that you use as much of Perl's internal lovingly hand-wrought C
code as possible. That means using complex operators like
<code>map</code>, <code>grep</code>, hashes etc, to do the maximum of
work with as few Perl operators as possible. You have to balance that
against readability though, otherwise you can end up with unmaintainable
code that looks like line noise. Radiator makes heavy use of Perl's
Object Oriented support, which costs in performance, but we think the
benefits in maintainability and easy extensibility (for us and the
customer) are worth it."</p>

<p> One common concern with businesses releasing Perl products is that
they're worried about piracy; if the source code is visible by anyone,
isn't it easy for people to run away with it? The evaluation version of
Radiator is shipped with a small portion of the code encrypted, and only
made available to bona fide equirers. However, the full product is
shipped completely unencrypted. Mike flips over the concern and sees the
advantages. "Most network operators really like the idea of a product
with full source code: They can be sure that the product does what it
claims, and they can change or enhance it if necessary. ...
We like to offer full source code, but we also need to be
paid for our hard work, and partial encryption of demos seems to be a
good compromise that results in most of our demos turning into sales."
</p>

<p> What, then, about people making customizations or passing on copies
to their friends? "Actually, we don't mind if customers change their code
to suit their own needs. But we don't like it if they give the code
to someone else, so that we get to support them without being paid.
There is a little bit of that goes on, but ours is not really a
mass-market consumer product, and I think that most people realise
they get more benefit from an honest relationship with us. In the
end, a license is not very expensive, especially since the support is so
good."
</p>

<p>Finally, we asked Mike to sum up his thoughts on commercial
development with Perl. "Technically, I think it is unsurpassed for
almost any application. In Perl, I can be five to 10 times more productive,
line-for-line than in C or C++ (and I'm no slouch at them, either). For
software vendors, that means a more maintainable product delivered to
market faster. For customers it means a better product for less money.
And interoperability and portability is fantastic. As you can tell, we
really like it!"</p>

<p> "Commercially, a qualified yes, provided you have control over
licensing and distribution issues, which might be hard in anything
other than a niche market. You can't keep writing software unless
you get to pay the mortgage and feed the kids, too."
</p>

<p>
Mike McCauley is chief software developer at Open System Consultants in
Melbourne, Australia. He has a bachelor of engineering from the
University of Queensland, and has worked in the computer software
industry for 20 years. When he is not writing software, he flies
light planes and has fun with his family.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1376" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/10/09/komodo.html" rel="bookmark">A Review of Komodo</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2002-10-09T00:00:00-08:00">October  9, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>Every time I get a new copy of <a href="http://www.activestate.com/">ActiveState</a>'s 
<a href="http://www.activestate.com/Products/Komodo/">Komodo IDE</a>, I do a review
that invariably ends &quot;this would be the perfect IDE for me if I were
the sort of person who used IDEs&quot;. And every time I get the next
release, I get closer to being persuaded I should be using IDEs. With
Komodo 2.0, ActiveState is getting very, very close to persuading me -
but it's not there yet. Let's see what it got right and got wrong
this time.</p>

<p>From a Perl point of view, the syntax highlighting and background syntax
checking has been greatly improved. Now, every time someone claims to do
decent Perl syntax highlighting, there'll be at least one annoying
pedant who crawls out of the woodwork with some pathological case and
the oft-quoted &quot;only perl can parse Perl!&quot;. Well, so what? For something
that's impossible, Komodo does a surprisingly fine job. Combining the
background syntax checking with <code>use strict</code> catches a reassuring
amount of coding errors almost instantly.</p>

<p>My old favourite, Rx, is still there, and is still a great way to
visualize what's going on in complicated regular expressions. One
problem I found was that the Rx window changed size awkwardly while
stepping through the regex match - but maybe this is a good time to
mention that I'm working from a beta version of Komodo 2.0, and many of
my gripes may be fixed by the time 2.0 is released for real.</p>

<csperl file="grab" domain="on" record="b/718" template="article_sidebar.view">

<p>There are a bunch of little things too that one should come to expect
from this caliber of IDE. Integration with CVS was touted as being a
feature, but I couldn't find any mention of it, although the FTP
&quot;remote editing&quot; feature works well; combined with the CGI features of
Komodo, this could be a fantastic workstation for the Windows user
deploying CGI files on a remote server.</p>

<p>The Web services integration is a nice touch, especially with its
automated installer, but it would benefit from some kind of progress
indicator. Integration with the ASPN Cookbooks is a nice idea, but I
don't know how much use it would see in day-to-day coding. The &quot;external
debugger&quot; feature sounds interesting, but I couldn't find any
documentation on it.</p>

<p>If I had to point to something that really impressed me about Komodo
2.0, then it would be the toolbox; this is actually something that I've been
looking for in my own development environment and could be the one
feature that persuades me to use Komodo. The toolbox is, simply put,
somewhere to collect stuff that might be useful during your development.
That's to say, snippets of code that you can drop into place, commands
that you can execute, URLs to start a browser at, and so on. For example, you can highlight a function in Perl, and have a button in the
toolbox run <code>perldoc -f</code> on it. You can drag a piece of boilerplate
code directly into your file. It's just a nice, fast way of working,
making the repeated things easy - precisely what a GUI should be doing. 
This is combined with a macro recording facility to make it easy for you
to create your own toolbox items.</p>

<p>It's worth remembering that Komodo is not just about Perl. Komodo's XML
mode is absolutely wonderful; it offers per-tag folding, tag completion
on insertion, and XSLT debugging. Since I write all of my books in XML
these days, I'm seriously considering using Komodo instead of jEdit and
even emacs's psgml mode for my writing work; the only slight snag is
that Komodo's tag insertion works by divining the acceptable XML tags
from the structure of the documentation, instead of loading a DTD if one
is explicitly supplied. However, perhaps this is unfair - Komodo doesn't
claim to be an XML editor, just an XSLT editor, and the fact that it
makes quite a good XML editor is a surprising bonus.</p>

<p>So why won't I switch to using Komodo? Two reasons: First, it's not
out on my favorite OS, Apple's OS X - although I'm told that a port is
in progress. Unfortunately, when that happens, Komodo will be competing
with Apple's own Project Builder.</p>

<p>Second, speed. If I'm going to be giving up vi and emacs, then I'm going to
want something that can keep up with them in terms of speed and keyboard
response times. Komodo, even running a fairly beefy box, was slowing
down my coding. No amount of cool syntax highlighting is worth that.</p>
<p>As with the last time I reviewed Komodo, I'd heartily recommend it for
those who enjoy programming with IDEs, but reluctantly say that it's not
for me. But it's very, very close.</p>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1384" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/10/p6pdigest/20021006.html" rel="bookmark">This week on Perl 6 (9/30 - 10/6, 2002)</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Leon Brocard</span> on <abbr class="published" title="2002-10-06T00:00:00-08:00">October  6, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <p>This is yet another Perl 6 summary, documenting what has happened over
on the perl6-internals (where Parrot, the virtual machine that will
run Perl 6, is discussed) and perl6-language (where Perl 6 language
design is discussed) mailing lists. Piers is off on holiday
(snowboarding and parachuting, no doubt), so I will be your host for
the next two weeks. A particularly average week, so let's start off
with the perl6-internals list as usual.</p>

<h3><a name="getting_started_guide">Getting started guide</a></h3>
<p>Erik Lechak offered to help write a getting started guide to Parrot -
he thought (correctly) that there may be &quot;a pressing need for a
document helping newbie developers figure out how to get
started&quot;.</p>
<p>Unfortunately, Erik isn't a big fan of POD and attempted to code up a
better replacement. While POD may not be perfect, an awful lot of
Parrot developers are also Perl developers and POD is simple and good
enough for Parrot for now.</p>
<p><a href="http://groups.google.com/groups?threadm=3D96698C.4080602%40the-small-print.com">http://groups.google.com/groups</a></p>

<h3><a name="debugger_debugged">Debugger debugged</a></h3>
<p>Juergen Boemmels noticed that hitting the Enter key in the Parrot
debugger (pdb) caused a segfault and that this wasn't quite ideal
behaviour. He provided a patch which ignored empty lines, and after a
nudge from Aldo Calpini provided another patch which followed the
suggested behaviour in <code>docs/debugger.pod</code>, instead repeating the
last command entered.</p>
<p><a href="http://groups.google.com/groups?threadm=rt-17683-38900.14.1279881352507%40bugs6.perl.org">http://groups.google.com/groups</a></p>

<h3><a name="patch_master">Patch Master</a></h3>
<p>The main patcher these recent weeks has been Leopold Toetsch, and he
kept it up this week as well. He provided patches to stop Parrot
permanently allocating increasing amounts of memory, fix a parser
error in imcc, add stats to life.p6 and more. In fact, so many patches
that I have a feeling he'll get CVS write access soon ;-)</p>

<h3><a name="new_allocator">New allocator</a></h3>
<p>Leopold had a play with plugging in the Doug Lea memory allocator,
providing a patch to configure in support for the current Parrot
malloc, the Doug Lea malloc, or ptmalloc in libc. He also attempted to
plug in Perl 5's malloc and found similar speed results.  Later on, he
created a document to explain memory internals, continuing the recent
trend for more docs.</p>
<p><a href="http://gee.cs.oswego.edu/dl/html/malloc.html">http://gee.cs.oswego.edu/dl/html/malloc.html</a></p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=17731">http://rt.perl.org/rt2/Ticket/Display.html</a></p>
<p><a href="http://rt.perl.org/rt2/Ticket/Display.html?id=17766">http://rt.perl.org/rt2/Ticket/Display.html</a></p>

<h3><a name="patches,_patches_everywhere">Patches, patches everywhere</a></h3>
<p>There have been a lot of pending patches recently, and Robert Spier
prodded us about them and hopes to have an automated weekly email
nudge too.</p>
<p><a href="http://www.parrotcode.org/openpatches">http://www.parrotcode.org/openpatches</a></p>

<h3><a name="library_name_collisions">Library name collisions</a></h3>
<p>Steve Fink reported a problem with library name collisions. For
example, having <code>intlist.c</code> as well as <code>classes/intlist.c</code> and
<code>key.c</code> as well as <code>classes/key.c</code>. Dan proposed a naming convention
where classes start with a CL_prefix, encodings with an EN_ prefix and
character set stuff with a CS_prefix, although it looks like a simpler
solution may be taken.</p>
<p><a href="http://groups.google.com/groups?threadm=20020929230154.GF2030%40foxglove.digital-integrity.com">http://groups.google.com/groups</a></p>

<h3><a name="core.ops_ate_my_(miniscule)_ram">core.ops ate my (miniscule) RAM</a></h3>
<p>David Chan is using an itty bitty box (Cyrix with 32 MB of RAM) and
found that compiling Parrot failed due to lack of memory. Nicholas
Clark reminded us that you can disable the (faster, but needs more
memory to compile) computed goto core at configure time using
<code>./Configure.pl --cgoto=0</code>.</p>
<p><a href="http://groups.google.com/groups?threadm=20021002070022.GA7669%40virtuosi.fsnet.co.uk">http://groups.google.com/groups</a></p>

<h3><a name="parrot_file_list">Parrot file list</a></h3>
<p>There are a great number of source files in the Parrot distribution
and Mark Sparshatt gathered ideas for how to have a file list which
explained what each actually does.</p>
<p><a href="http://groups.google.com/groups?threadm=E17xRrm-0007H8-00.2002-10-04-13-47-39%40tmailb1.svr.pol.co.uk">http://groups.google.com/groups</a></p>

<h3><a name="interfaces">Interfaces</a></h3>
<p>Over in perl6-language, Michael Schwern was asked at a recent Java
conference whether Perl 6 will support interfaces. He tried to
describe a likely interface and raised some problems with
interfaces. This spawned a huge thread about OO, interfaces, and some
of the weirder OO languages. Do we enforce strict interfaces? Are some
methods allowed to be optional?</p>
<p>One of the more interesting ideas would be to move from just using
prototypes to using Design-By-Contract features: pre- and
post-conditions and invariants. Dave Whipp seemed a big fan of the
Eiffel model, where it is possible to rename methods in a derived
class. There was lots of scary Perl 6 pseudocode including cars, MP3
players, birds, and wings.</p>
<p>A little later, Schwern came back and worried about enforcing
interfaces on subclasses. One interesting approach is to follow Eiffel
and only allow subclasses to weaken the preconditions or strengthen
the postconditions of the parent. Weakening involves adding ORs,
strengthening ANDs. (More Foo and Bar pseudocode. Oh, and apparently
Schwern only has 2 toes).</p>
<p>There was a short sidetrack on having multiple versions of modules
running at the same time, and Allison Randal informed us that it looks
like the full name of classes will include their version number, ie
<code>Acme::N-1.1</code>.</p>
<p>In fact, a lot of the discussion is a bit in the air: as Dan Sugalski
pointed out, things like object attributes aren't until Apocalypse
12 and it may be a little early to worry about such things.</p>
<p><a href="http://groups.google.com/groups?threadm=20020930001137.GN3858%40ool-18b93024.dyn.optonline.net">http://groups.google.com/groups</a></p>
<p><a href="http://groups.google.com/groups?threadm=20021003184638.GN3858%40ool-18b93024.dyn.optonline.net">http://groups.google.com/groups</a></p>

<h3><a name="subjectoriented_programming">Subject-Oriented Programming</a></h3>
<p>Schwern also asked about subject-oriented programming, which looked
interesting but which he couldn't quite understand. Andy Wardley
explained that all these &quot;advanced&quot; programming techniques are all
attempting a clear separation of concerns, and went on to describe and
give pointers to more info.</p>
<p><a href="http://groups.google.com/groups?threadm=20021001032202.GX3858%40ool-18b93024.dyn.optonline.net">http://groups.google.com/groups</a></p>

<h3><a name="matching">Matching</a></h3>
<p>Someone mysteriously known only as &quot;Ed&quot; <i>[ Ed Pescho - Ed.]</i>
asked what the favoured syntax
would be to match negative multi-byte strings in Perl 6. It wasn't
entirely clear what the question was, but one thing is sure: the Perl
6 pattern matching engine will have a lot of scope for optimisation.</p>
<p><a href="http://groups.google.com/groups?threadm=20021001122724.A18606%40rama.comp.pge.com">http://groups.google.com/groups</a></p>

<h3><a name="in_brief">In brief</a></h3>
<p>Tim Bunce asked if there were any good tools for static code analysis
around. None, apparently.</p>
<p>Brent Dax reminded Andy Dougherty and others about
<code>/Parrot_v?sn?printf(_[sc])?/</code> in <code>misc.c</code> - a reimplementation of
the printf functions for portability reasons.</p>
<p>Simon Glover added tests for the assign opcode.</p>
<p>It looks like Michael Lazzaro will be writing a list of issues with OO
as well as a tutorial so that everyone is clear what exactly we are
talking about.</p>
<p>Larry cringes every time someone says &quot;Parens construct lists in Perl
6&quot;.</p>

<h3><a name="who's_who_in_perl6">Who's Who in Perl6</a></h3>
<p>Once more we get to meet people involved in the development of Perl 6.</p>
<dl>
<dt><strong><a name="item_who_are_you%3f">Who are you?</a></strong><br />
</dt>
<dd>
Simon Cozens
</dd>

<dt><strong><a name="item_what_do_you_do_for%2fwith_perl_6%3f">What do you do for/with Perl 6?</a></strong><br />
</dt>
<dd>
I was the Parrot pumpking up until 0.0.4, and wrote much of the PMC
and string infrastructure. I then escaped to get a life, play more Go
and be a nicer person.
</dd>
<dd>
<p>As perl.com editor and occasional author, I pop in from time to time
just to check on the correctness of things I'm writing about and make
sure Parrot compiles on at least one platform I possess so I can test
code for articles. Rumours of my return to development have been
greatly exaggerated. :)</p>
</dd>

<dt><strong><a name="item_where_are_you_coming_from%3f">Where are you coming from?</a></strong><br />
</dt>
<dd>
I'm not, I'm already here!
</dd>

<dt><strong><a name="item_when_do_you_think_perl_6_will_be_released%3f">When do you think Perl 6 will be released?</a></strong><br />
</dt>
<dd>
I don't think Perl 6 - as we understand it - ever will be
released. How's that for a Delphic pronouncement?
</dd>

<dt><strong><a name="item_why_are_you_doing_this%3f">Why are you doing this?</a></strong><br />
</dt>
<dd>
Because I like food.
</dd>

<dt><strong><a name="item_you_have_5_words%2e_describe_yourself%2e">You have 5 words. Describe yourself.</a></strong><br />
</dt>
<dd>
Less vehemently obnoxious than before.
</dd>

<dt><strong><a name="item_do_you_have_anything_to_declare%3f">Do you have anything to declare?</a></strong><br />
</dt>
<dd>
Watch out for some surprises in the near future.
</dd>
</dl>

<h3><a name="acknowledgements">Acknowledgements</a></h3>
<p>This summary was brought to you with much distraction indeed from
Super Mario Sunshine. Thanks to Kate Pugh and #london.pm for
proofreading.</p>
<p>As Piers says: One more, if you think this summary has value send
money to the Perl Foundation <a href="http://donate.perl-foundation.org">http://donate.perl-foundation.org</a> and
feed back and/or T?iBooks to me, <em><a href="mailto:mailto:pdcawley@bofh.org.uk">mailto:pdcawley@bofh.org.uk</a></em>. As
usual, the fee paid for publication of this summary on perl.com has
been donated directly to the Perl Foundation.</p>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1374" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2002/10/01/hashes.html" rel="bookmark">How Hashes Really Work</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Abhijit Menon-Sen</span> on <abbr class="published" title="2002-10-01T00:00:00-08:00">October  1, 2002 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            

<p>It's easy to take hashes for granted in Perl. They are simple, fast, and
they usually &quot;just work,&quot; so people never need to know or care about how
they are implemented. Sometimes, though, it's interesting and rewarding
to look at familiar tools in a different light. This article follows the
development of a simple hash class in Perl in an attempt to find out how
hashes really work.</p>
<p>A hash is an unordered collection of values, each of which is identified
by a unique key. A value can be retrieved by its key, and one can add to
or delete from the collection. A data structure with these properties is
called a dictionary, and some of the many ways to implement them are
outlined below.</p>

<csperl file="grab" domain="on" record="b/515" template="article_sidebar.view">

<p>Many objects are naturally identified by unique keys (like login names),
and it is convenient to use a dictionary to address them in this manner.
Programs use their dictionaries in different ways. A compiler's symbol
table (which records the names of functions and variables encountered
during compilation) might hold a few hundred names that are looked up
repeatedly (since names usually occur many times in a section of code).
Another program might need to store 64-bit integers as keys, or search
through several thousands of filenames.</p>
<p>How can we build a generally useful dictionary?</p>

<h3><a name="implementing_dictionaries">Implementing Dictionaries</a></h3>
<p>One simple way to implement a dictionary is to use a linked list of keys
and values (that is, a list where each element contains a key and the
corresponding value). To find a particular value, one would need to scan
the list sequentially, comparing the desired key with each key in turn
until a match is found, or we reach the end of the list.</p>
<p>This approach becomes progressively slower as more values are added to
the dictionary, because the average number of elements we need to scan
to find a match keeps increasing. We would discover that a key was not
in the dictionary only after scanning every element in it. We could make
things faster by performing binary searches on a sorted array of keys
instead of using a linked list, but performance would still degrade as
the dictionary grew larger.</p>
<p>If we could transform every possible key into a unique array index (for
example, by turning the string &quot;red&quot; into the index 14328.), then we could
store each value in a corresponding array entry. All searches,
insertions and deletions could then be performed with a single array
lookup, irrespective of the number of keys. But although this strategy
is simple and fast, it has many disadvantages and is not always useful.</p>
<p>For one thing, calculating an index must be fast, and independent of the
size of the dictionary (or we would lose all that we gained by not using
a linked list). Unless the keys are already unique integers, however, it
isn't always easy to quickly convert them into array indexes (especially
when the set of possible keys is not known in advance, which is common).
Furthermore, the number of keys actually stored in the dictionary is
usually minute in comparison to the total number of possible keys, so
allocating an array that could hold everything is wasteful.</p>
<p>For example, although a typical symbol table could contain a few hundred
entries, there are about 50 billion alphanumeric names with six or fewer
characters. Memory may be cheap enough for an occasional million-element
array, but 50 billion elements (of which most remain unused) is still
definitely overkill.</p>
<p>(Of course, there are many different ways to implement dictionaries. For
example, red-black trees provide different guarantees about expected and
worst-case running times, that are most appropriate for certain kinds of
applications. This article does not discuss these possibilities further,
but future articles may explore them in more detail.)</p>
<p>What we need is a practical compromise between speed and memory usage; a
dictionary whose memory usage is proportional to the number of values it
contains, but whose performance doesn't become progressively worse as it
grows larger.</p>
<p>Hashes represent just such a compromise.</p>

<h3><a name="hashes">Hashes</a></h3>
<p>Hashes are arrays (entries in it are called slots or buckets), but they
do not require that every possible key correspond directly to a unique
entry. Instead, a function (called a hashing function) is used to
calculate the index corresponding to a particular key. This index
doesn't have to be unique, i.e., the function may return the same hash
value for two or more keys.  (We disregard this possibility for a while,
but return to it later, since it is of great importance.)</p>
<p>We can now look up a value by computing the hash of its key, and looking
at the corresponding bucket in the array. As long as the running time of
our hashing function is independent of the number of keys, we can always
perform dictionary operations in constant time. Since hashing functions
make no uniqueness guarantees, however, we need some way to to resolve
collisions (i.e., the hashed value of a key pointing to an occupied
bucket).</p>
<p>The simple way to resolve collisions is to avoid storing keys and values
directly in buckets, and to use per-bucket linked lists instead. To find
a particular value, its key is hashed to find the index of a bucket, and
the linked list is scanned to find the exact key. The lists are known as
chains, and this technique is called chaining.</p>
<p>(There are other ways to handle collisions, e.g. via open addressing, in
which colliding keys are stored in the first unoccupied slot whose index
can be recursively derived from that of an occupied one. One consequence
is that the hash can contain only as many values as it has buckets. This
technique is not discussed here, but references to relevant material are
included below.)</p>

<h4><a name="hashing_functions">Hashing Functions</a></h4>
<p>Since chaining repeatedly performs linear searches through linked lists,
it is important that the chains always remain short (that is, the number
of collisions remains low). A good hashing function would ensure that it
distributed keys uniformly into the available buckets, thus reducing the
probability of collisions.</p>
<p>In principle, a hashing function returns an array index directly; in
practice, it is common to use its (arbitrary) return value modulo the
number of buckets as the actual index. (Using a prime number of buckets
that is not too close to a power of two tends to produce a sufficiently
uniform key distribution.)</p>
<p>Another way to keep chains remain short is to use a technique known as
dynamic hashing: adding more buckets when the existing buckets are all
used (i.e., when collisions become inevitable), and using a new hashing
function that distributes keys uniformly into all of the buckets (it is
usually possible to use the same hashing function, but compute indexes
modulo the new number of buckets). We also need to re-distribute keys,
since the corresponding indices will be different with the new hashing
function.</p>
<p>Here's the hashing function used in Perl 5.005:</p>
<pre><code>
  # Return the hashed value of a string: $hash = perlhash(&quot;key&quot;)
  # (Defined by the PERL_HASH macro in hv.h)
  sub perlhash
  {
      $hash = 0;
      foreach (split //, shift) {
          $hash = $hash*33 + ord($_);
      }
      return $hash;
  }</code></pre>
<p>More recent versions use a function designed by Bob Jenkins, and his Web
page (listed below) does an excellent job of explaining how it and other
hashing functions work.</p>

<h4><a name="representing_hashes_in_perl">Representing Hashes in Perl</a></h4>
<p>We can represent a hash as an array of buckets, where each bucket is an
array of <code>[$key, $value]</code> pairs (there's no particular need for chains
to be linked lists; arrays are more convenient). As an exercise, let us
add each of the keys in <code>%example</code> below into three empty buckets.</p>
<pre><code>
  %example = (
      ab =&gt; &quot;foo&quot;, cd =&gt; &quot;bar&quot;,
      ef =&gt; &quot;baz&quot;, gh =&gt; &quot;quux&quot;
  );
  
  @buckets = ( [],[],[] );
  
  while (($k, $v) = each(%example)) {
      $hash  = perlhash($k);
      $chain = $buckets[ $hash % @buckets ];
	  
      $entry = [ $k, $v ];
      push @$chain, $entry;
  }</code></pre>
  
<p>We end up with the following structure (you may want to verify that the
keys are correctly hashed and distributed), in which we can identify any
key-value pair in the hash with one index into the array of buckets and
a second index into the entries therein. Another index serves to access
either the key or the value.</p>
<pre><code>
  @buckets = (
      [ [ &quot;ef&quot;, &quot;baz&quot; ]                   ],    # Bucket 0: 1 entry
      [ [ &quot;cd&quot;, &quot;bar&quot; ]                   ],    # Bucket 1: 1 entry
      [ [ &quot;ab&quot;, &quot;foo&quot; ], [ &quot;gh&quot;, &quot;quux&quot; ] ],    # Bucket 2: 2 entries
  );
  $key = $buckets[2][1][0];   # $key = &quot;gh&quot;
  $val = $buckets[2][1][1];   # $val = $hash{$key}
  $buckets[0][0][1] = &quot;zab&quot;;  # $hash{ef} = &quot;zab&quot;</code></pre>














<h3><a name="building_toy_hashes">Building Toy Hashes</a></h3>
<p>In this section, we'll use the representation discussed above to write a
tied hash class that emulates the behavior of real Perl hashes. For the
sake of brevity, the code doesn't check for erroneous input. My comments
also gloss over details that aren't directly relevant to hashing, so you
may want to have a copy of <em>perltie</em> handy to fill in blanks.</p>
<p>(All of the code in the class is available at the URL mentioned below.)</p>
<p>We begin by writing a tied hash constructor that creates an empty hash,
and another function to empty an existing hash.</p>
<pre><code>
  package Hash;
  
  # We'll reuse the perlhash() function presented previously.
  
  # Create a tied hash. (Analogous to newHV in hv.c)
  sub TIEHASH
  {
      $h = {
          keys    =&gt; 0,                         # Number of keys
          buckets =&gt; [ [],[],[],[],[],[],[] ],  # Seven empty buckets
          current =&gt; [ undef, undef ]           # Current iterator entry
      };                                        # (Explained below)
      return bless $h, shift;
  }
  
  # Empty an existing hash. (See hv.c:hv_clear)
  sub CLEAR
  {
      ($h) = @_;
	  
         $h-&gt;{keys}      = 0;
      @{ $h-&gt;{buckets} } = ([],[],[],[],[],[],[]);
      @{ $h-&gt;{current} } = (undef, undef);
  }</code></pre>
  
<p>For convenience, we also write a function that looks up a given key in a
hash and returns the indices of its bucket and the correct entry within.
Both indexes are undefined if the key is not found in the hash.</p>
<pre><code>
  # Look up a specified key in a hash.
  sub lookup
  {
      ($h, $key) = @_;
	  
      $buckets = $h-&gt;{buckets};
      $bucket  = perlhash($key) % @$buckets;
	  
      $entries = @{ $buckets-&gt;[$bucket] };
      if ($entries &gt; 0) {
          # Look for the correct entry inside the bucket.
          $entry = 0;
          while ($buckets-&gt;[$bucket][$entry][0] ne $key) {
              if (++$entry == $entries) {
                  # None of the entries in the bucket matched.
                  $bucket = $entry = undef;
                  last;
              }
          }
      }
      else {
          # The relevant bucket was empty, so the key doesn't exist.
          $bucket = $entry = undef;
      }
	  
      return ($bucket, $entry);
  }</code></pre>
  
  
<p>The <code>lookup</code> function makes it easy to write <code>EXISTS</code>, <code>FETCH</code>, and
<code>DELETE</code> methods for our class:</p>
<pre><code>
  # Check whether a key exists in a hash. (See hv.c:hv_exists)
  sub EXISTS
  {
      ($h, $key) = @_;
      ($bucket, $entry) = lookup($h, $key);
	  
      # If $bucket is undefined, the key doesn't exist.
      return defined $bucket;
  }
  
  # Retrieve the value associated with a key. (See hv.c:hv_fetch)
  sub FETCH
  {
      ($h, $key) = @_;
	  
      $buckets = $h-&gt;{buckets};
      ($bucket, $entry) = lookup($h, $key);
	  
      if (defined $bucket) {
          return $buckets-&gt;[$bucket][$entry][1];
      }
      else {
          return undef;
      }
  }
  
  # Delete a key-value pair from a hash. (See hv.c:hv_delete)
  sub DELETE
  {
      ($h, $key) = @_;
	  
      $buckets = $h-&gt;{buckets};
      ($bucket, $entry) = lookup($h, $key);
	  
      if (defined $bucket) {
          # Remove the entry from the bucket, and return its value.
          $entry = splice(@{ $buckets-&gt;[$bucket] }, $entry, 1);
          return $entry-&gt;[1];
      }
      else {
          return undef;
      }
  }</code></pre>
  
  
<p><code>STORE</code> is a little more complex. It must either update the value of an
existing key (which is just an assignment), or add an entirely new entry
(by pushing an arrayref into a suitable bucket). In the latter case, if
the number of keys exceeds the number of buckets, then we create more buckets
and redistribute existing keys (under the assumption that the hash will
grow further; this is how we implement dynamic hashing).</p>
<pre><code>
  # Store a key-value pair in a hash. (See hv.c:hv_store)
  sub STORE
  {
      ($h, $key, $val) = @_;
  
      $buckets = $h-&gt;{buckets};
      ($bucket, $entry) = lookup($h, $key);
  
      if (defined $bucket) {
          $buckets-&gt;[$bucket][$entry][1] = $val;
      }
      else {
          $h-&gt;{keys}++;
          $bucket = perlhash($key) % @$buckets;
          push @{ $buckets-&gt;[$bucket] }, [ $key, $val ];
  
          # Expand the hash if all the buckets are full. (See hv.c:S_hsplit)
          if ($h-&gt;{keys} &gt; @$buckets) {
              # We just double the number of buckets, as Perl itself does
              # (and disregard the number becoming non-prime).
              $newbuckets = [];
              push(@$newbuckets, []) for 1..2*@$buckets;
  
              # Redistribute keys
              foreach $entry (map {@$_} @$buckets) {
                  $bucket = perlhash($entry-&gt;[0]) % @$newbuckets;
                  push @{$newbuckets-&gt;[$bucket]}, $entry;
              }
              $h-&gt;{buckets} = $newbuckets;
          }
      }
  }</code></pre>
  
  
<p>For completeness, we implement an iteration mechanism for our class. The
<code>current</code> element in each hash identifies a single entry (by its bucket
and entry indices). <code>FIRSTKEY</code> sets it to an initial (undefined) state,
and leaves all the hard work to <code>NEXTKEY</code>, which steps through each key
in turn.</p>
<pre><code>
  # Return the first key in a hash. (See hv.c:hv_iterinit)
  sub FIRSTKEY
  {
      $h = shift;
      @{ $h-&gt;{current} } = (undef, undef);
      return $h-&gt;NEXTKEY(@_);
  }</code></pre>
  
<p>If <code>NEXTKEY</code> is called with the hash iterator in its initial state (by
<code>FIRSTKEY</code>), it returns the first key in the first occupied bucket. On
subsequent calls, it returns either the next key in the current chain,
or the first key in the next occupied bucket.</p>
<pre><code>
  # Return the next key in a hash. (See hv.c:hv_iterkeysv et al.)
  sub NEXTKEY
  {
      $h = shift;
      $buckets = $h-&gt;{buckets};
      $current = $h-&gt;{current};
	  
      ($bucket, $entry) = @{ $current };
	  
      if (!defined $bucket || $entry+1 == @{ $buckets-&gt;[$bucket] }) {
      FIND_NEXT_BUCKET:
          do {
              if (++$current-&gt;[0] == @$buckets) {
                  @{ $current } = (undef, undef);
                  return undef;
              }
          } while (@{ $buckets-&gt;[$current-&gt;[0]] } == 0);
          $current-&gt;[1] = 0;
      }
      else {
          $current-&gt;[1]++;
      }
	  
      return $buckets-&gt;[$current-&gt;[0]][$current-&gt;[1]][0];
  }</code></pre>
  
  
<p>The <code>do</code> loop at <code>FIND_NEXT_BUCKET</code> finds the next occupied bucket if
the iterator is in its initial undefined state, or if the current entry
is at the end of a chain. When there are no more keys in the hash, it
resets the iterator and returns <code>undef</code>.</p>
<p>We now have all the pieces required to use our Hash class exactly as we
would a real Perl hash.</p>
<pre><code>
  tie %h, &quot;Hash&quot;;
  
  %h = ( foo =&gt; &quot;bar&quot;, bar =&gt; &quot;foo&quot; );
  while (($key, $val) = each(%h)) {
      print &quot;$key =&gt; $val\n&quot;;
  }
  delete $h{foo};
  
  # ...</code></pre>


<h3><a name="the_perl_internals">Perl Internals</a></h3>
<p>If you want to learn more about the hashes inside Perl, then the <code>FakeHash</code>
module by Mark-Jason Dominus and a copy of <em>hash.c</em> from Perl 1.0 are
good places to start. The PerlGuts Illustrated Web site by Gisle Aas is
also an invaluable resource in exploring the Perl internals. (References
to all three are included below.)</p>
<p>Although our <code>Hash</code> class is based on Perl's hash implementation, it is
not a faithful reproduction; and while a detailed discussion of the Perl
source is beyond the scope of this article, parenthetical notes in the
code above may serve as a starting point for further exploration.</p>

<h3><a name="history">History</a></h3>
<p>Donald Knuth credits H. P. Luhn at IBM for the idea of hash tables and
chaining in 1953. About the same time, the idea also occurred to
another group at IBM, including Gene Amdahl, who suggested open
addressing and linear probing to handle collisions. Although the term
&quot;hashing&quot; was standard terminology in the 1960s, the term did not
actually appear in print until 1967 or so.</p>
<p>Perl 1 and 2 had &quot;two and a half data types&quot;, of which one half was an
&quot;associative array.&quot; With some squinting, associative arrays look very
much like hashes. The major differences were the lack of the <code>%</code> symbol
on hash names, and that one could only assign to them one key at a time.
Thus, one would say <code>$foo{'key'} = 1;</code>, but only <code>@keys = keys(foo);</code>.
Familiar functions like <code>each</code>, <code>keys</code>, and <code>values</code> worked as they
do now (and <code>delete</code> was added in Perl 2).</p>
<p>Perl 3 had three whole data types: it had the <code>%</code> symbol on hash names,
allowed an entire hash to be assigned to at once, and added <code>dbmopen</code>
(now deprecated in favour of <code>tie</code>). Perl 4 used comma-separated hash
keys to emulate multidimensional arrays (which are now better handled
with array references).</p>
<p>Perl 5 took the giant leap of referring to associative arrays as hashes.
(As far as I know, it is the first language to have referred to the data
structure thus, rather than &quot;hash table&quot; or something similar.) Somewhat
ironically, it also moved the relevant code from <em>hash.c</em> into <em>hv.c</em>.</p>

<h3><a name="nomenclature">Nomenclature</a></h3>
<p>Dictionaries, as explained earlier, are unordered collections of values
indexed by unique keys. They are sometimes called associative arrays or
maps. They can be implemented in several ways, one of which is by using
a data structure known as a hash table (and this is what Perl refers to
as a hash).</p>
<p>Perl's use of the term &quot;hash&quot; is the source of some potential confusion,
because the output of a hashing function is also sometimes called a hash
(especially in cryptographic contexts), and because hash tables aren't
usually called hashes anywhere else.</p>
<p>To be on the safe side, refer to the data structure as a hash table, and
use the term &quot;hash&quot; only in obvious, Perl-specific contexts.</p>

<h3><a name="further_resources">Further Resources</a></h3>
<dl>
<dt><strong><a name="item_algorithms">Introduction to Algorithms (Cormen, Leiserson and Rivest)</a></strong></dt>
<dd>
Chapter 12 of this excellent book discusses hash tables in detail.
</dd>

<dt><strong><a name="item_programming">The Art of Computer Programming (Donald E. Knuth)</a></strong><br />
</dt>
<dd>
Volume 3 (&quot;Sorting and Searching&quot;) devotes a section (6.4) to an
exhaustive description, analysis, and a historical perspective on
various hashing techniques.
</dd>

<dt><strong><a name="item_http%3a%2f%2fperl%2eplover%2ecom%2fbadhash%2epl" /><a href="http://perl.plover.com/badhash.pl">http://perl.plover.com/badhash.pl</a></strong><br />
</dt>
<dd>
&quot;When Hashes Go Wrong&quot; by Mark-Jason Dominus demonstrates a pathological
case of collisions, by creating a large number of keys that hash to the
same value, and effectively turn the hash into a very long linked list.
</dd>

<dt><strong><a name="item_http%3a%2f%2fburtleburtle%2enet%2fbob%2fhash%2fdoo" /><a href="http://burtleburtle.net/bob/hash/doobs.html">http://burtleburtle.net/bob/hash/doobs.html</a></strong><br />
</dt>
<dd>
Current versions of Perl use a hashing function designed by Bob Jenkins.
His web page explains how the function was constructed, and provides an
excellent overview of how various hashing functions perform in practice.
</dd>

<dt><strong><a name="item_http%3a%2f%2fperl%2eplover%2ecom%2ffakehash%2f" /><a href="http://perl.plover.com/FakeHash/">http://perl.plover.com/FakeHash/</a></strong><br />
</dt>
<dd>
This module, by Mark-Jason Dominus, is a more faithful re-implementation
of Perl's hashes in Perl, and is particularly useful because it can draw
pictures of the data structures involved.
</dd>

<dt><strong><a name="item_http%3a%2f%2fwww%2eetla%2eorg%2fretroperl%2fperl1%" /><a href="http://www.etla.org/retroperl/perl1/perl-1.0.tar.gz">http://www.etla.org/retroperl/perl1/perl-1.0.tar.gz</a></strong><br />
</dt>
<dd>
It might be instructive to read <em>hash.c</em> from the much less cluttered
(and much less capable) Perl 1.0 source code, before going through the
newer <em>hv.c</em>.
</dd>

<dt><strong><a name="item_http%3a%2f%2fgisle%2eaas%2eno%2fperl%2fillguts%2fh" /><a href="http://gisle.aas.no/perl/illguts/hv.png">http://gisle.aas.no/perl/illguts/hv.png</a></strong><br />
</dt>
<dd>
This image, from Gisle Aas's &quot;PerlGuts Illustrated&quot;, depicts the layout
of the various structures that comprise hashes in the core. The entire
web site is a treasure trove for people exploring the internals.
</dd>

<dt><strong><a name="item_http%3a%2f%2fams%2ewiw%2eorg%2fsrc%2fhash%2epm" /><a href="http://ams.wiw.org/src/Hash.pm">http://ams.wiw.org/src/Hash.pm</a></strong><br />
</dt>
<dd>
The source code for the tied Hash class developed in this article.
</dd>
</dl>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2002/09/">&laquo; September 2002</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2002/11/">November 2002 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
