<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" id="sixapart-standard">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="Movable Type Pro 5.13-en" />
<link rel="stylesheet" href="/pub/styles.css" type="text/css" />
<link rel="start" href="/pub/" title="Home" />
<link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/pub/atom.xml" />
<script type="text/javascript" src="/pub/mt.js"></script>
<!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="/pub/">
<dc:title>Perl.com</dc:title>
<dc:description>news and views of the Perl programming language</dc:description>
<license rdf:resource="http://creativecommons.org/licenses/by-nc-nd/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-nc-nd/3.0/">
</License>
</rdf:RDF>
-->

<script type="text/javascript">

 var _gaq = _gaq || [];
 _gaq.push(['_setAccount', 'UA-50555-22']);
 _gaq.push(['_trackPageview']);

 (function() {
   var ga = document.createElement('script'); ga.type =
   'text/javascript'; ga.async = true;
   ga.src = ('https:' == document.location.protocol ? 'https://ssl' :
   'http://www') + '.google-analytics.com/ga.js';
   var s = document.getElementsByTagName('script')[0];
   s.parentNode.insertBefore(ga, s);
 })();

</script>
<script type='text/javascript' src='http://partner.googleadservices.com/gampad/google_service.js'></script>
<script type='text/javascript'>
GS_googleAddAdSenseService("ca-pub-4136420132070439");
GS_googleEnableAllServices();
</script>
<script type='text/javascript'>
GA_googleAddSlot("ca-pub-4136420132070439", "Perl_728x90");
</script>
<script type='text/javascript'>GA_googleFetchAds();</script>
    <title>Perl.com: February 2001 Archives</title>


    <link rel="prev" href="/pub/2001/01/" title="January 2001" />
    <link rel="next" href="/pub/2001/03/" title="March 2001" />

</head>
<body id="perl-com" class="mt-archive-listing mt-datebased-monthly-archive layout-wt">
    <div id="container">
        <div id="container-inner">


            <div id="header">
    <div id="header-inner">
        <div id="header-content">
        <span id="top_advert"> 
<!-- Put any landscape advert in here -->
<!-- Perl_728x90 -->
<script type='text/javascript'>
GA_googleFillSlot("Perl_728x90");
</script>
        </span> 



            <div id="header-name"><a href="/pub/" accesskey="1">Perl.com</a></div>
            <div id="header-description">news and views of the Perl programming language</div>




        </div>
    </div>
</div>



            <div id="content">
                <div id="content-inner">


                    <div id="alpha">
                        <div id="alpha-inner">


                            <h1 id="page-title" class="archive-title">February 2001 Archives</h1>





                            
                            <div id="entry-1458" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/02/p5pdigest/THISWEEK-20010226.html" rel="bookmark">This Week on p5p 2001/02/26</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-02-28T00:00:00-08:00">February 28, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            </P>

<P>


<!-- This week on perl5-porters (20-26 Feb 2001) -->

<br />
<br />
      <H3><a name="Notes">Notes</a></H3>

</P>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:perl5-porters-digest@netthink.co.uk"><tt>perl5-porters-digest@netthink.co.uk</tt></a>; there's also a similar summary for the Perl 6 mailing lists, which you
can subscribe to at 
<a href="mailto:perl6-digest@netthink.co.uk"><tt>perl6-digest@netthink.co.uk</tt></a>.
</P>

<P>

Please send corrections and additions to 
<CODE>perl-thisweek-YYYYMM@simon-cozens.org</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
</P>

<P>
This week was very busy, but there were a lot of cross-posts from other
lists. Partly due to the volume of traffic and partly due to work
getting horribly, horribly busy, I've had to delay finishing this
summary for a couple of days. My apologies. 
<H3><a name="Smoke_Testing">Smoke Testing</a></H3>

</P>

<P>

Mr. Schwern sprung into action yet again with another brilliant idea:
automated builds of Perl in all possible configurations and reporting
the &quot;smoke test&quot; results to P5P. OK, it's been talked about a number of
times in the past, but this time someone's done something about it.
Bravo, Schwern!
Of course, as with all good ideas<!-- in the Perl community-->, it
was nearly drowned out by lots and lots of trivial bickering. Schwern had called
the mailing list 
<CODE>smokers@perl.org</CODE>, and the smoke testing software 
<CODE>SmokingJacket</CODE>. This produced objections from non-smokers and recovering smokers, and
started a long and tedious objection - counterproposal cycle.
Eventually, the list was given an alias of 
<CODE>daily-build@perl.org</CODE>.
</P>

<P>
Schwern, however, had the last laugh when a change was needed to 
[SmokingJacket]:
<blockquote></P>

<P>
It seems we're overwhelming perlbug and p5p with redundant reports.  A
little too successful. :) The perlbug people are working on a way to
accommodate us and we should produce a new version of SmokingJacket
shortly.
</P>

<P>
Until then, please *STOP* using SmokingJacket.  Sorry about the
trouble, I know it can be difficult to stop smoking, but we'll be sure
to issue a patch to help. :P
</blockquote></P>

<P>
If you have spare cycles and you want to help put them to use without
much effort on your part, join the daily build mailing list.
<H3><a name="Overriding_">Overriding +=</a></H3>

</P>

<P>

Alex Gough noted that overriding 
<CODE>+=</CODE> does unexpected things when the left-hand side is undefined or
non-overloaded; in his words:
<blockquote></P>

<P>
I'm not claiming overload has a problem, just that it is not possible to   
write overloading modules which do not warn on
</P>

<P>
 $undef += $obj
</P>

<P>
without also not warning on
</P>

<P>
 $whatever = $undef + $obj
</blockquote></P>

<P>

Rick Delaney had a patch which makes the &quot;add-assign&quot; method (instead of
the &quot;add&quot; method, which is the current behaviour) get called even on
non-overload left-hand sides. This broke old code, so there was some
discussion as to whether there was a neater way to do it. Tels suggested
treating undefined left-hand sides as zero, but Ronald Kimball pointed
out:
<blockquote></P>

<P>

I think that, since the 
<CODE>+=</CODE> is being overloaded, we *don't* know that the
undef will be treated like a 0.  An overloaded 
<CODE>+=</CODE> could do whatever it
wants with an undef.
</P>

<P>
Someone could even implement an overloaded 
<CODE>+=</CODE> that's supposed to warn
when the lefthand operand is undef.  :)
</blockquote>    <a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-02/msg00959.html">Read about it.</a></P>

<P>

<H3><a name="More_Big_Unicode_Wars">More Big Unicode Wars</a></H3>

</P>

<P>
Most of this week's (many) messages were taken up in various debates
about the state of Unicode handling and how the Unicode semantics should
work. I'm obviously too involved in the whole thing to give you an
objective summary of what went on, but I can point you at the highlights
and the starts of the threads.
</P>

<P>
One of the Unicode threads started
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-02/msg01091.html">here</a>, and eventually, let to some agreement between myself, Nick Ing-Simmons, Ilya
and Jarkko, which is a feat in itself; we decided that the model for
Unicode on EBCDIC will look like
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-02/msg01259.html">this</a>. (Incidentally, thanks to Morgan Stanley Dean Witter, who've promised
me a day's hacking time on their mainframes, this might even be implemented
soon.)
</P>

<P>
Another of the threads started 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-02/msg01369.html">here</a> with Karsten Sperling attempting to nail down the semantics of Unicode
handling. Most of the ensuing discussion was a mixture of boring
language-lawyering and acrimony. Karsten also found some interesting
bugs related to character ranges on EBCDIC, which everyone swore had
been fixed years ago, but still seem to remain.
</P>

<P>
Nick Ing-Simmons posted a well thought-out and informative list and
discussion of the 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-02/msg01563.html">remaining conflicts</a> between our Unicode implementation and the Camel III's discussion of
 what should happen.
</P>

<P>
Unintentional irony of the week award goes to Ilya, for breathtakingly
accusing Jarkko of &quot;unnecessarily obfuscating&quot; the regular expression
engine.
<H3><a name="Patchlevel_in_V_and_571">Patchlevel in $^V and 5.7.1</a></H3>

</P>

<P>

Nicholas Clark asked 
<blockquote></P>

<P>

Would it be possible to make the $^V version string for bleadperl have
the devel number after a third dot?
</P>

<P>
ie instead of
</P>

</P><PRE>
    perl -we 'printf "%vd\n", $^V'
    5.7.0
</PRE>

<P>
I'd like it if I could get
</P>

</P><PRE>
    perl -we 'printf "%vd\n", $^V'
    5.7.0.8670
</blockquote></PRE>

<P>

Jarkko noted that this would cause problems with CPAN.pm; Nick turned
around and asked when 5.7.1 was likely to happen. The outstanding issues
seem to be Unicode, PerlIO and numerical problems including casting.
</P>

<P>
PerlIO is now the default IO system, and isn't giving that many
problems. Nick Ing-Simmons noted that Nicholas Clark had produced a 
<a href="http://search.cpan.org/search?dist=PerlIO-gzip">PerlIO::gzip</a> filter extension which had flushed out a bunch of bugs.
</P>

<P>
Philip Newton said that a 5.7.0.8670-style release number wouldn't help
us much anyway, because features would get folded back into, say, 5.6.1
or 5.6.2, and if you said
</P>

</P><PRE>
    require 5.7.0.8760;
</PRE>

<P>
Perl barf on 5.6.1 even if the features you need had been folded back
in, bringing up the &quot;feature test&quot; discussion again.
</P>

<P>
Johan Vromans suggested that Perl could have a built-in 
<CODE>Config.pm</CODE> equivalent to report its configuration. Ted Ashton complained about the
 size of the resulting binary, but Robert Spier pointed out that 
<CODE>Config.pm</CODE> itself is pretty bloaty. Vadim Konovalov suggested that the advantage of 
having an external 
<CODE>Config.pm</CODE> is that you can change it and lie to Perl about how it was configured.
Don't try this at home, folks.
<H3><a name="Deleting_stashes">Deleting stashes</a></H3>

</P>

<P>

Here's an interesting and probably not too hard job for someone. Alan
Burlison found that if you delete a stash and then call a subroutine
that was in it, Perl segfaults:
</P>

</P><PRE>
    $ perl -e 'sub bang { print "bang!\n"; } undef %main::; bang;'
    Segmentation Fault(coredump)
</PRE>

<P>
What Alan and I agreed should happen is that stash deletion should be
allowed, but the method cache needs to be invalidated for that stash
when it is deleted so that the next attempt to call a sub on it will
give the ordinary &quot;undefined subroutine&quot; error.
<H3><a name="IO_on_VMS">IO on VMS</a></H3>

</P>

<P>

VMS seemed to be doing something very strange with output and pipes to
the effect that 
<CODE>Test::Harness</CODE> couldn't properly see the results of 
<CODE>Test.pm</CODE>. Eventually it was simplified to 
</P>

</P><PRE>
    print "a ";
    print "b ";
    print "c\n";
</PRE>

<P>
acting differently to 
</P>

</P><PRE>
    print "a b c\n";
</PRE>

<P>
and this was explained by Dan Sugalski in a way that startled nearly
everyone: &quot;The way perl does communication between processes on VMS
involves mailboxes.&quot;
</P>

<P>
But it transpired that the reality is somewhat more boring than we
imagined: rather than a Heath-Robinsonian email-based IPC system,
mailboxes are actually a little like Unix domain sockets. You send
output as batches of records. Hence, there's a difference between
sending the output as three records and as one. As there's a record
separator between the prints, you get different output. 
<H3><a name="Various">Various</a></H3>

</P>

<P>

Tim Jenness fixed up some long-standing known issues with 
<CODE>File::Temp</CODE>; if you were getting scary warning messages from 
<CODE>File::Temp</CODE> tests in the past, you won't any more.
</P>

<P>
Alan's been whacking at some more memory leaks; Jarkko was reproducing
far more leaks than Alan until he turned up 
<CODE>PERL_DESTRUCT_LEVEL</CODE>, which actually frees the memory in use tidily, instead of allowing it
to be reclaimed when the process exits. He asked why we don't do this
all the time; the answer was &quot;speed&quot; - the exit's going to happen
anyway, so why shut down gracefully? As Jarkko put it, &quot;No point
shaving in the morning if you are a kamikaze pilot?&quot; Naturally, this
lead to a discussion about the grooming habits of kamikaze.
</P>

<P>
Sarathy said &quot;yikes&quot; again, although on an unrelated topic.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>


<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Smoke_Testing">Smoke Testing</a>
  <li><a href="#Overriding_">Overriding +=</a>
  <li><a href="#More_Big_Unicode_Wars">More Big Unicode Wars</a>
  <li><a href="#Patchlevel_in_V_and_571">Patchlevel in $^V and 5.7.1</a>
  <li><a href="#Deleting_stashes">Deleting stashes</a>
  <li><a href="#IO_on_VMS">IO on VMS</a>
  <li><a href="#Various">Various</a>
</ul>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1444" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/02/dbix.html" rel="bookmark">DBIx::Recordset VS DBI</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Terrence Monroe Brannon</span> on <abbr class="published" title="2001-02-27T00:00:00-08:00">February 27, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- DBIx::Recordset: a DBI Extension for Application-Level Database Use -->
<ul>
 <li><a href="#problems using dbi at applicationlevel">Problems Using DBI at Application-Level</a></li>
	<ul>

  <li><a href="#intolerance to table and data mutation">Intolerance to Table and Data Mutation</a></li>
  <li><a href="#errorprone and tedious query construction">Error-Prone and Tedious Query Construction</a></li>
  <li><a href="#manual and complex mapping of database data to perl data structures">Manual and Complex Mapping of Database Data to Perl Data Structures</a></li>
 </ul>
 <li><a href="#succint cgisql interaction (database control via cgi oneliners)">Succint CGI-SQL Interaction (Database Control via ``CGI One-Liners'')</a></li>
 <ul>

  <li><a href="#control and monitoring of table access">Control and Monitoring of Table Access</a></li>
  <li><a href="#scalability">Scalability</a></li>
  <li><a href="#form data variations">Form Data Variations</a></li>
  <li><a href="#table splits">Table Splits</a></li>
 </ul>

 <li><a href="#sample code">Sample Code</a></li>
 <ul>

  <li><a href="#dbix::recordset version of code">DBIx::Recordset Version of Code</a></li>
  <li><a href="#dbi version of code">DBI Version of Code</a></li>
  <li><a href="#empirical results">Empirical Results</a></li>
 </ul>

 <li><a href="#conclusion">Conclusion</a></li>
 <li><a href="#acknowledgements">Acknowledgements</a></li>
</ul>
<h3>Introduction</h3>
<p>Writing this article was pure hell. No, actually, writing most of it
was quite fun - it was just when I had to write the functional
equivalent of my DBIx::Recordset code in DBI that I began to sweat
profusely. It was only when I had finished writing the mountain of DBI
code to do the same thing as my molehill of DBIx::Recordset that I
could heave a sigh of relief. Since starting to use DBIx::Recordset, I
have been loath to work on projects where the required database
API was DBI. While it may seem like a play on words, it is crucial to
understand that DBI is the standard database interface for Perl but it
should not be the interface for most Perl applications requiring
database functionality.</p>
<p>The key way to determine whether a particular module/library is
matched to the level of a task is to count the number of lines of
``prep code'' you must write before you can do what you want. In other
words, can the complex operations and data of your domain be dealt
with in a unitary fashion by this module? In the case of DBI, we can
say that it has made the tasks of connection, statement preparation,
and data fetching tractable by reducing them to single calls to the
DBI API. However, real-life applications have much larger and more
practical complex units and it is in these respects that the DBI API
falls short.  To me, it comes as no surprise that DBI, a module whose
only design intent was to present a uniform API to the wide variety of
available databases, would lack such high-level functionality. But it
does surprise me to no end that hoards of Perl programmers, some of
whom may have had a software engineering course at some point in their
careers, would make such errant judgment. Thus the fault lies with the
judgment of the programmers, not DBI.</p>
<p>In most cases the gap between DBI's API and Perl applications has been
bridged by indiscriminately mixing generic application-level
functionality with the specifics of the current application. This
makes it difficult to reuse the generic routines in another part of
the application or in an altogether different application. Another
maladaptive way that the DBI API has been extended for
application-level databasing is by developing a collection of generic
application-level tools but not publishing them. Thus, as larger scale
tools are built from two camps using differing generic
application-level APIs, amends for discrepancies in calling
conventions must be duct-taped between the code bodies. The final way
to misuse DBI in an application is to use it directly.</p>
<p>However, an unsung module, publicly available on CPAN that bridges
the gap between DBI and application-level programming robustly and
conveniently is DBIx::Recordset. It is built on top of DBI and is so
well-matched to the level at which database-driven applications are
conceived that in most cases one sentence in an application design
specification equates to one line of DBIx::Recordset.</p>

<h3><a name="problems using dbi at applicationlevel" id="problems using dbi at applicationlevel">Problems Using DBI at Application-Level</a></h3>

<h4><a name="intolerance to table and data mutation" id="intolerance to table and data mutation">Intolerance to Table and Data Mutation</a></h4>

<p>Table mutation - the addition, deletion or rearrangement of fields
from a table or data mutation - the addition, removal or
rearrangement of portions of the input sources intended for database
commission, can break a large number of calls to the DBI API. This is
due to the fact that most routines expect and return arrays or array
references and thus fail when the expected arrays shrink or grow. For
example, the following DBI code:</p>
<pre>
 $dbh-&gt;do(&quot;INSERT INTO students (id,name) VALUES (1,$name)&quot;);</pre>
<p>would break once fields were removed from the table
students. However, the equivalent DBIx::Recordset code<a href="#1">(1)</a>:</p>
<pre>
 DBIx::Recordset-&gt;Insert({%dsn,'!Table'=&gt;'students',%dbdata});</pre>
<p>would work regardless of constructive or destructive mutations of the
students table or %dbdata. If there are fewer field-value pairs in
%dbdata than in the table, then the insert will be performed with the
corresponding fields. If there are irrelevant fields in %dbdata, then
the extra fields are by default silently ignored.</p>

<p>Now, the import of this intolerance for DBI usage is that changes in
either the tables or the input data require changes in the source. For
some, such rigidity is of merit because it forces both the source and
target of database commission to be made explicitly manifest within
the source code. However, for other Perl programmers, such rigidity is
nothing more than an imposition on their highly cultivated sense of
Laziness.</p>
<h4><a name="errorprone and tedious query construction" id="errorprone and tedious query construction">Error-Prone and Tedious Query Construction</a></h4>
<p>A query string is presented to the DBI API in placeholder or literal
notation. An example of DBI placeholder usage is shown below:</p>
<pre>
 $sql='insert into uregisternew
        (country, firstname, lastname, userid, password, address1, city,
        state, province, zippostal, email, phone, favorites, remaddr,
        gender, income, dob, occupation, age)
        values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)';</pre>
<pre>
 my @data=($formdata{country}, $formdata{firstname}, $formdata{lastname},
        $formdata{email}, $formdata{password}, $formdata{address},
        $formdata{city},  $formdata{state},  $formdata{province},
        $formdata{zippostal}, $formdata{email}, $formdata{phone},
        $formdata{favorites}, $formdata{remaddr}, $formdata{gender},
        $formdata{income}, $formdata{date}, $formdata{occupation},
 $formdata{age});</pre>
<pre>
        $sth2 = $dbh-&gt;prepare($sql);
        $sth2-&gt;execute(@data);
        $sth2-&gt;finish();</pre>
<p>This is a slightly modified version of a minefield I had to tiptoe
through during a recent contract I was on. This code has several
accidents waiting to happen. For one you must pray that the number of
question-mark placeholders is the same as the number of fields you are
inserting. Secondly, you must manually insure that the field names in
the insert statement correspond with the data array in both position
and number.</p>
<p>If one were developing the same query using DBI's literal notation,
one would have the same issues and would in addition devote more lines
of code to manually quoting the data and embedding it in the query
string.</p>
<p>In contrast, DBIx::Recordset's <code>Insert()</code> function takes a hash in which
the keys are database field names and the values are the values to be
inserted. Using such a data structure eliminates the correspondence
difficulties mentioned above. Also, DBIx::Recordset generates the
placeholder notation when it calls the DBI API.</p>
<p>Thus, with no loss of functionality<a href="#2">(2)</a>, the entire body of code above
could be written as:</p>
<pre>
 DBIx::Recordset-&gt;Insert({%dsn,%formdata});</pre>
<p>In fact, the DBI code is not equivalent to the DBIx::Recordset code
because connection and database operations are always separate calls
to the DBI API. The additional work required to use DBI has been
omitted for brevity.</p>
<p> </p>
<h4><a name="manual and complex mapping of database data to perl data structures" id="manual and complex mapping of database data to perl data structures">Manual and Complex Mapping of Database Data to Perl Data Structures</a></h4>
<table border="1" cellpadding="2" cellspacing="1">
<tr>
<th align="left">
 operation</th>            <th align="left">DBI</th>          <th align="left">DBIx::Recordset</th>
    <td></th></td>
</tr>

<tr>
 <td>Single row fetch</td>   
<td>
<pre>selectrow_array
selectrow_arrayref</pre>
</td>

         <td><pre>$set[0]</pre></td>
</tr>                        
<tr>
 <td>Multiple row fetch</td>     
<td>
<pre>
fetchall_arrayref  
selectall_arrayref 
fetchrow_array     
fetchrow_arrayref  
fetchrow_hashref
</pre>
</td>

<td>
<pre>
 for $row (@set) {...}
       OR    
while ($href=$set-&gt;Next())</pre>
    </td>
    <td> </td>
  </tr>

</table>
                                    
                        
<p>In DBI, database record retrieval is manual, complex and in most cases
intolerant to table mutation. By manual, we mean that performing the
query does not automatically map the query results onto any native
Perl data structures. By complex, we mean that DBI can return the data
in a multiplicity of ways: array, array reference and hash
reference.</p>
<p>In DBIx::Recordset, however, retrieval of selected recordsets can be <a href="#3">(3)</a>
automatic, simple and field-mutation tolerant. By automatic, we mean
that requesting the records leads to an automatic tie of the
result set to a hash.<a href="4">(4)</a> No functions need be called for this transfer
to take place. The retrieval process is simple because the only way to
receive results is via a hash reference. Because DBIx::Recordset
returns a hash, fields are referred to by name as opposed to
position. This strategy is robust to all table mutations.</p>
<p>Having seen DBIx::Recordset's solution to some of the more troublesome
aspects of DBI use, we now move on to explore the wealth of
application-level benefits that DBIx::Recordset offers in the
following areas:</p>
<ol>
  <li> Succinct CGI to SQL transfer </li>
  <li> Control and monitoring of table access </li>
  <li> Scalability </li>
</ol>
<p>As impressive as these topics may sound, DBIx::Recordset is designed
to achieve each of them in one line of Perl!<a href="#5">(5)</a></p>

<h3><a name="succint cgisql interaction (database control via cgi oneliners)" id="succint cgisql interaction (database control via cgi oneliners)">Succint CGI-SQL Interaction (Database Control via ``CGI One-Liners'')</a></h3>
<p>Assuming that the keys in the query string match the field names in
the target database table, DBIx::Recordset can shuttle form data from
a query string into a database in one line of Perl code:</p>
<pre>
 DBIx::Recordset-&gt;Insert({%formdata,%dsn});</pre>
<p>One line of DBIx::Recordset can also drive recordset retrieval via
form data as well as iterate through the results: 
</p>
<pre>

 # here we: SELECT * FROM sales and automatically tie
 # the selected records to @result</pre>
<pre>
 *result = DBIx::Recordset-&gt;Search({
        %dsn,'!Table'=&gt;'sales',%formdata
        });</pre>
<pre>
 # here we iterate across our results...
 map { 
  printf (&quot;&lt;TR&gt;Sucker # %d purchased item # %s on %s&lt;/TR&gt;&quot;, 
        $_-&gt;{customer_id}, $_-&gt;{item_id}, $_-&gt;{purchase_date}) 
 } @result;</pre>
<p>The above code is automatically quoted and requires no tiresome
connect, prepare and execute ritual.</p>
<p>DBIx::Recordset also has helper functions which create the HTML for
``previous-next-first-last'' navigation of recordsets:</p>
<pre>
 $nav_html = $::result -&gt; PrevNextForm ({
        -first =&gt; 'First',  -prev =&gt; '&lt;&lt;Back', 
        -next  =&gt; 'Next&gt;&gt;', -last =&gt; 'Last',
                -goto  =&gt; 'Goto #'}, 
        \%formdata);</pre>
<p>In this case, we use the scalar aspect of the typeglob, which provides
object-oriented access to the methods of the created recordset.</p>
<p>A final CGI nicety has to do with the fact that browsers send empty
form fields as empty strings. While in some cases you may want this
empty string to propagate into the database as a SQL null, it is also
sometimes desirable to have empty form fields ignored. It is possible
to specify which behavior you prefer through the DBIx::Recordset
'!IgnoreEmpty' hash field of the <code>Insert()</code> and <code>Update()</code> function.</p>
<p> </p>
<h4><a name="control and monitoring of table access" id="control and monitoring of table access">Control and Monitoring of Table Access</a></h4>
<p>A database handle in DBI is a carte blanche to add, retrieve, or remove anything from a database that one can do with a console interface to the database with the same login. The problem with this is that the semantics and volatility of an application's database code is not self-consistent but instead varies as a function of database permission alteration.<a href="#6">(6)</a> Au contraire, a DBIx::Recordset handle is much more structured. A handle is created and configured with a number of attributes: table write modes, accessible tables, and the method of logging database usage to name a few.</p>
<p>The first form of much-needed table access control that DBIx::Recordset offers is specification of the manners in which a particular database connection will be allowed to alter database tables. By the use of a binary-valued string, one specifies the subset of write operations (specifically none/insert/update/delete/clear) that are allowable. Such facilities are often needed when defining access levels to a database for various parties. For example, it is conceivable for a corporate intranet database to give insert access to sales employees, update access to customer service, delete access to processing and complete access to technical support. To implement such constraints in plain DBI would yield a confusing maelstrom of if-thens and 2-3 suicide attempts. With DBIx::Recordset, one simply creates a properly configured connection for each corporate intranet sector.</p>
<p>Tangential to the issue of write permission is the issue of which tables can be accessed at all. Control of table access is simply one more key-value pair to the connection setup hash. Finally to monitor the use of database handles, one only need setup a debug file for each handle.</p>
<p>Thus, assuming the package company::database has a hash %write_mode which contains the write modes for the intranet, a hash %log_file with the log files for each handle, and a hash %table_access which contains the tables for each member of the intranet, one would specify the tables and their mode of access and usage logs for the entire intranet as follows:</p>
<pre>{ 
  package company::database; 

  for (keys %write_mode) {

  *{$handle{$_}} = 
        DBIx::Recordset-&gt;Setup({%dsn, 
        '!Writemode' =&gt; $write_mode{$_}, 
        '!Tables'    =&gt; $table_access{$_}
        });
</pre>
<pre>
   DBIx::Recordset-&gt;Debug({
                '!Level' =&gt; 4,
                '!File'  =&gt; $log_file{$_},
                '!Mode'  =&gt; '&gt;'
                });
   }
}</pre>

<h4><a name="scalability" id="scalability">Scalability</a></h4>

<table border="1" cellpadding="2" cellspacing="5">

<tr>
<td align="left">
<b>Operation</b>
</td>
<td align="left">
<b>Code changes needed (DBI)</b>
</td>
<td align="left">
<b>Code changes (DBIx::Recordset)</b>
</td>
</tr>

<tr>

<td>
 Adding or              
 removing form          
 elements from a        
 webpage but still      
 having the database    
 code commit the        
 generated query        
 string properly.
</td>

<td>
For each change 
of the form (and
hence the query 
string), the    
database code   
would have to be
modified.       
</td>

<td>None</td>
</tr>

<tr>

<td>
 Taking an   
 un-normalized                  
 main table and         
 splitting it           
 into a number of       
 &quot;satellite&quot;      
 tables with            
 foreign keys in
 the main table
 to reference the
 satellite
 tables.</td>


<td>
For each table          
split,                  
additional terms        
would have to           
added to the            
          WHERE or JOIN 
clause.                 
</td>

<td>None</td>

</tr>

</table>

<p>Regardless of how well one plans a project, prototyping and early development are often evolutionary processes. Significant development time can be saved if database-processing routines remain invariant in the face of HTML and database re-design. It is in this regard that DBIx::Recordset dwarfs DBI, making it far more viable during the prototyping phases of a project. Having already shown DBIx::Recordset's scalability in the face of table mutations, this section will demonstrate DBIx::Recordset's scalability in the face of form data variations as well as database table splits.</p>
<h4><a name="form data variations" id="form data variations">Form Data Variations</a></h4>
<p>Let's assume you were developing a user registration form that submitted it's form data to db-commit.cgi for insertion into a database:</p>
<!--Please check code structure here, cleaned up some bad HTML-->
<pre>#!/usr/bin/perl
use CGI (:standard);
$formdata{$_} = param{$_} for param();
if ($#(DBIx::Recordset-&gt;Search(
 { %dsn,
  '!Table'  =&gt; user_registration,
  'username' =&gt; $formdata{username}
 })) &gt;= 0) {
 &amp;username_taken_error;
} else {
 DBIx::Recordset-&gt;Insert(
 { %dsn,
  '!Table'  =&gt; user_registration,
  %formdata
 }
}</pre>
<p>Now assume that you decided to add a new field called AGE to a table and a corresponding form. Under DBI, the insert query would have to be modified to account for the change. Because DBIx::Recordset takes a hash reference for its inserts, no code modification is required. Now of course, I can hear the DBI users squawking: ``I can develop a library that converts form data to hashes and turns this into query strings.'' And of course my hot retort is: ``But don't you see this is a homegrown, non-standard <a href="#7">(7)</a>API that will have to be duct-taped to other people's homegrown, non-standard solutions?''</p>
<h4><a name="table splits" id="table splits">Table Splits</a></h4>
<p>For another example of DBIx::Recordset's flexibility to architecture changes, consider the case where a table is split, perhaps for reasons of normalization. Thus, in the core table where you once explicitly coded a user's name into a field user_name you now have a foreign key titled user_name_id which points to a table called user_name which has a field titled id. Assume that you also later decided to do the same sort of normalization for other fields such as age-bracket or salary-bracket. With plain DBI, each time that a query was supposed to retrieve all fields from each of the associated tables, the query would have to be rewritten to accommodate the splitting of the main table. With DBIx::Recordset, no query would have to be rewritten because the tables were described in a format recognizable by DBIx::Recordset's database meta-analysis.</p>
<h3><a name="sample code" id="sample code">Sample Code</a></h3>
<p>On a recent contract I had to copy a user registration table (named uregister) to a new table (called uregisternew) which had all of the fields of the old table plus a few new fields designed to store profile information on the users.</p>
<p>The key thing to note about the DBIx::Recordset version of this code is that it is highly definitional: very little database mechanics clutters the main logic of the code, allowing one to focus on recordset migration from one table to another.</p>
<h4><a name="dbix::recordset version of code" id="dbix::recordset version of code">DBIx::Recordset Version of Code</a></h4>
<!--This section has some unchanged POD in it also which I can't interpret what is supposed to be happening here. It looks like some of the stuff here in <pre> tags should actually be in <p> tags, need check from author-->
<pre>
 #!/usr/bin/perl</pre>
<pre>
 =head1</pre>
<pre>
 uregisternew is a table with all the fields of uregister plus a few
 profile fields (ie, salary bracket, occupation, age) which contain a
 positive integer which serves as index into the array for that
 particular profile field.</pre>
<pre>
 The purpose of this script is to copy over the same fields and
 generate a valid array index for the new profile fields.</pre>
<pre>
 =cut</pre>
<pre>
 use Angryman::Database;
 use Angryman::User;
 use DBIx::Recordset;
 use Math::Random;
 use strict;</pre>
<pre>
 $::table{in}  = 'uregister';
 $::table{out} = 'uregisternew';
</pre>
<pre>

 # connect to database and SELECT * FROM uregister
 *::uregister = DBIx::Recordset-&gt;Search ({            
        %Angryman::Database::DBIx::Recordset::Connect, 
        '!Table' =&gt; $::table{in}  
        });</pre>
<pre>

 # because we will re-use the target table many times, we separate the 
 # connection and insert steps with this recordset
 *::uregisternew = DBIx::Recordset-&gt;Setup({  
        %Angryman::Database::DBIx::Recordset::Connect, 
        '!Table' =&gt; $::table{out} 
        });</pre>
<pre>

 # iterate through the recordsets from the old table:
 for my $uregister (@::uregister) {
     &amp;randomize_user_profile;
     # INSERT 
        # the old table data into the new table and
        # the computed hash of profile data
    $::uregisternew-&gt;Insert({%{$uregister},%::profile});
 }</pre>
<pre>
 # Angryman::User::Profile is a hash in which each key is a reference 
 # to an array of profile choices. For example:
 # $Angryman::User::Profile{gender} = [ 'male', 'female' ];
 # $Angryman::User::Profile{age} = ['under 14', '14-19', '20-25', ... ];
 # Because we don't have the actual data for the people in uregister,
 # we randomly assign user profile data over a normal distribution.
 # when copying it to uregisternew.
 sub randomize_user_profile {
    for (keys %Angryman::User::Profile) {
        my @tmp=@{$Angryman::User::Profile{$_}};
        $::profile{$_} = random_uniform_integer(1,0,$#tmp);
        $::profile{dob}='1969-05-11';
    }
 }
</pre>

<h4><a name="dbi version of code" id="dbi version of code">DBI Version of Code</a></h4>
<pre>
 #!/usr/bin/perl
</pre>
<pre>
<!--what is =head1? Is that POD format that didn't get changed over?-->
 =head1
 uregisternew is a table with all the fields of uregister plus a few
 profile fields (ie, salary bracket, occupation, age) which contain
 a positive integer which serves as index into the array for that
 particular profile field.</pre>
<pre>

 The purpose of this script is to copy over the same fields and
 generate a valid array index for the new profile fields.</pre>
<pre>

 This file is twice as long as the DBIx::Recordset version and it 
 easily took me 5 times longer to write.
 =cut <!--Same here, what is =cut?--></pre>
<pre>

 use Angryman::Database;
 use Angryman::User;
 use DBI;
 use Math::Random;
 use strict;</pre>
<pre>

 $::table{in}  = 'uregister';
 $::table{out} = 'uregisternew';</pre>
<pre>

 # connect to database and SELECT * FROM uregister
 my $dbh = DBI-&gt;connect($Angryman::Database::DSN, 
                        $Angryman::Database::Username, 
                        $Angryman::Database::Password);
 my $sth = $dbh-&gt;prepare('SELECT * FROM uregister');
 my $ret = $sth-&gt;execute;</pre>
<pre>

 &amp;determine_target_database_field_order;</pre>
<pre>

 # because we will re-use the target table many times, we separate the 
 # connection and insert steps with this recordset</pre>
<pre>

 # iterate through the recordsets from the old table:
 while ($::uregister = $sth-&gt;fetchrow_hashref) {</pre>
<pre>

     &amp;randomize_user_profile;
     &amp;fiddle_with_my_data_to_get_it_to_work_with_the_DBI_API();</pre>
<pre>

     # INSERT 
         # the old table data into the new table and
         # the computed hash of profile data
     my $sql = &quot;INSERT into $::table{out}($::sql_field_term) values($::INSERT_TERM)&quot;;
     $dbh-&gt;do($sql);
 }</pre>
<pre>

 # Angryman::User::Profile is a hash in which each key is a reference 
 # to an array of profile choices. For example:
 # $Angryman::User::Profile{gender} = [ 'male', 'female' ];
 # $Angryman::User::Profile{age} = ['under 14', '14-19', '20-25',  ];
 # Because we don't have the actual data for the people in uregister,
 # we randomly assign user profile data over a normal distribution.
 # when copying it to uregisternew.
 sub randomize_user_profile {
     for (keys %Angryman::User::Profile) {
         my @tmp=@{$Angryman::User::Profile{$_}};
         $::profile{$_} = random_uniform_integer(1,0,$#tmp);
     }</pre>
<pre>

     $::profile{dob}='';
 }</pre>
<pre>

 # Hmm, I cant just give DBI my data and have it figure out the order
 # of the database fields... So here he we go getting the field
 # order dynamically so this code doesnt break with the least little
 # switch of field position.
 sub determine_target_database_field_order {</pre>
<pre>

     my $order_sth = $dbh-&gt;prepare(&quot;SELECT * FROM $::table{out} LIMIT 1&quot;);
     $order_sth-&gt;execute;</pre>
<pre>

 # In DBIx::Recordset, I would just say $handle-&gt;Names()... but here we 
 # must iterate through the fields manually and get their names.</pre>
<pre>

     for (my $i = 0; $i &lt; $order_sth-&gt;{NUM_OF_FIELDS}; $i++) {
         push @::order_data, $order_sth-&gt;{NAME}-&gt;[$i];
     }</pre>
<pre>

     $::sql_field_term = join ',',  @::order_data;</pre>
<pre>

 }</pre>
<pre>

 # As ubiquitous as hashes are in Perl, the DBI API does not
 # offer a way to commit hashes to disk.
 sub fiddle_with_my_data_to_get_it_to_work_with_the_DBI_API {</pre>
<pre>

     my @output_data;
     for (@::order_data) {
         push @output_data, $dbh-&gt;quote
             (
              defined($::uregister-&gt;{$_}) 
              ? $::uregister-&gt;{$_} 
              : $::profile{$_}
              );
    }</pre>
<pre>

    $::INSERT_TERM=join ',', @output_data;
 }</pre>
<p> </p>
<h4><a name="empirical results" id="empirical results">Empirical Results</a></h4>
<table>
<tr>
<th>
                DBI</th>             <th> DBIx::Recordset</th>
</tr>
<tr>
         <td>1.4 seconds (1,2)</td>      <td>3.7 seconds (3,4)</td>
</tr>
</table>

<p>The average, minimum, and maximum number of seconds required to
execute the sample code under DBI and DBIx::Recordset. The code was
run on a database of 250 users.</p>

<h3><a name="conclusion" id="conclusion">Conclusion</a></h3>
<p>DBI accelerated past the ODBC API for database interface because it
was simpler and more portable. Because DBIx::Recordset is built on top
of DBI, it maintains these advantages and improves upon DBI's
simplicity. Because it also adds much-needed application-level
features to DBI, it is a clear choice for database driven Perl
applications.</p>
<p>A strong contender for an improvement of DBI is the recent effort by
Simon Matthews to simplify DBI use via a Template Toolkit plugin. Many
of the advantages of DBIx::Recordset are available to the DBI plugin
either intrinsically or due to the context in which it was
developed. For example, DBIx::Recordset allows filtering of
recordsets through the !Filter key to its database processing
functions. The plugin did not have to provide filtering because there
are several generic, widely useful filters (e.g., HTML, date, etc.)
already available for Template Toolkit. However, Matthew's DBI plugin
uses the same level of abstraction as DBI. This shortcoming, along
with the plug-in's lack of application-level databasing conveniences,
lands the plugin in the same functional boat as DBI with only nicer
syntax to pad the same troublesome ride.</p>
<p>That being said, DBI is preferable to DBIx::Recordset when speed is of
utmost importance. DBI's speed advantage is due to several factors <a href="#8">(8)</a>.
First DBIx::Recordset is built on the DBI API and thus one has the
overhead of at least one additional function call per
application-level database command. Secondly, it takes time for
DBIx::Recordset to decode its compact input algebra and produce
well-formed SQL.</p>
<p>All theory aside, my experience and the timing results show that you
don't lose more than a second or two when you reach for
DBIx::Recordset instead of DBI. Such a slowdown is acceptable in light
of what DBIx::Recordset offers over DBI: speed of development, power
of expression and availability of standard and necessary
application-level functionality.</p>
<p>Even if time constraints do lead one to decide that DBIx::Recordset is
inappropriate for a finished product because it is slightly slower
than DBI, it can prove especially handy during early prototyping or
when one is solving a complex problem and wants to focus on the flow
of recordsets as opposed to the mechanics of managing this flow.</p>

<h4><a name="acknowledgements" id="acknowledgements">Acknowledgements</a></h4>
<p>I would like to thank Gerald Richter (<a href="mailto:richter@ecos.de">richter@ecos.de</a>) for authoring
DBIx::Recordset, commenting on an early version of this manuscript as
well as providing me and others with free help on his great tool.</p>

<h4>Footnotes</h4>
<ol>
<li><a name="1" id="1">Actually, the DBI code is not equivalent to the DBIx::Recordset code because connection and database operations are always separate calls to the DBI API. The additional work required to use DBI has been omitted for brevity.</a></li>

<li><a name="2">The DBIx::Recordset code is also more accurate because it uses database metadata to determine which data to quote, while DBI uses string-based heuristics.</a></li>

<li><a name="3">DBIx::Recordset can be automatic and simple, but, you can also operate in a more manual mode to afford yourself time/space efficiency on the same order as DBI.</a></li>

<li><a name="4">More precisely, each row in the recordset is an anonymous hash which is referred to by one element of an array whose name is determined by the typeglob bound during the call to the Search() function.</a></li>

<li><a name="5" id="5">I can't wait to see the next generation of obfuscated Perl now that major database operations only take one line!</a></li>

<li><a name="6" id="6">Be this alteration done by friend or foe.</a></li>

<li><a name="7" id="7">Now admittedly, the transfer of a CGI query string into a hash is non-standard as well, but, most high-end web application frameworks for Perl (e.g. HTML::Embperl and HTML::Mason) provide this transfer automatically as part of their application-level API to web site development.</a></li>

<li><a name="8" id="8">Maybe that's why there's a cheetah on the front of the DBI book</a>.</li>
</ol>
        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1446" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/02/esmith.html" rel="bookmark">The e-smith Server and Gateway: a Perl Case Study</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Kirrily &quot;&quot;Skud&quot;&quot; Robert</span> on <abbr class="published" title="2001-02-20T00:00:00-08:00">February 20, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- The e-smith Server and Gateway: A Perl Study</a> --> 

<br />

<p>The e-smith server and gateway system is a Linux distribution designed for 
small to medium enterprises. It's intended to simplify the process of 
setting up Internet and file-sharing services and can be administered by a 
non-technical user with no prior Linux experience. </p> <p>We chose Perl as the main development language for the e-smith server and 
gateway because of its widespread popularity (making it easier to recruit 
developers) and it's well suited to e-smith's blend of system 
administration, templating and Web-application development.</p> <p>Of course, the system isn't just Perl. Other parts of the system include the 
base operating system (based on Red Hat 7.0), a customized installer using Red 
Hat's Anaconda (which is written in Python), and a range of applications 
including mail and Web servers, file sharing, and Web-based e-mail using IMP 
(which is written in PHP). However, despite the modifications and quick hacks 
we've made in other languages, the bulk of development performed by the e-smith 
team is in Perl.</p> <h3><a name=aen16>The E-Smith Manager: a Perl CGI 
Application</a></h3> <p>Administration of an e-smith server and gateway system is performed primarily 
via a Web interface called the "e-smith manager." This is essentially a 
collection of CGI programs that display system information and allow the 
administrator to modify it as necessary.</p> <p>This allows system owners with no previous knowledge of Linux to administer 
their systems easily without the need to understand the arcana of the command 
line, text configuration files, and so on.</p> <div class=mediaobject> <p><img src="/pub/2001/02/perl-article-manager.jpg"></img></p></div> <p>The manager interface is based on the <code>CGI</code> module 
that comes standard with the Perl distribution. However, a module <code>esmith::cgi</code> has been written to provide further 
abstractions of common tasks such as:</p>  <ul> <li> generating page headers and footers
  <li> generating commonly used widgets
  <li> generating status report pages</li></ul> <p>It is likely that this module will be further extended in the next version to 
provide more abstract ways of building "wizard" style interfaces, so that 
developers don't have to copy and paste huge swathes of code calling the <code>CGI</code> module directly.</p></div>   <h3><a name=aen37>Global Configuration Files</a></h3> <p>The e-smith server and gateway is a collection of many parts, all of which 
can be configured in different ways depending on the user's needs. All the 
global configuration data is kept in a central repository and this information 
is used as the base for specific configurations for the various software on the 
system.</p> <p>Much of the system configuration data is kept in a simple text file, 

<code>/home/e-smith/configuration</code>. The basic format is name=value, 
as shown below:</p> <pre>AccessType=dedicated
ExternalDHCP=off
ExternalNetmask=255.255.255.0</pre> <p>Obviously, this can be simply parsed with Perl, by using something equivalent 
to:</p>  <pre>my %conf;
while (&lt;&gt;) {
    chomp;
    my ($name, $value) = split(/=/);
    $conf{$name} = $value;
}

print "$conf{DomainName}\n";</pre> <p>However, it is also possible to store more information in a single line by 
adding zero or more pairs of property names and values delimited by pipe symbols 
(<code>|</code>), like this:</p> <pre>fetchmail=service|status|enabled
flexbackup=backupservice|erase_rewind_only|true
ftp=service|access|private|status|enabled</pre> <p>Parsing this gets tricky, requiring an additional split and 
putting the property names and values into a hash. </p> <p>As it happens, e-smith has a module with common utilities such as this built 
in, so a developer would only write something like this:</p> <pre>use esmith::db;

my %conf;
tie %conf, 'esmith::config', '/home/e-smith/configuration';

my $domain = db_get(\%conf, 'DomainName');

my ($type, %properties) = db_get(\%conf, 'ftp');</pre> <p>Similar to the main configuration file, user and group information is kept 
in <code>/home/e-smith/accounts</code>, in a format that is also
simple to parse.</p> <p>This simplicity is intentional; although the data could have been stored in a 
more complex database, the developers decided to keep the core of e-smith as 
simple as possible so that the learning curve for new developers would not be 
steep.</p>  <h3><a name=aen54>Templated Configuration Files Using 
Text::Template</a></h3> <p>Things become more complex when we examine the configuration files stored in <code>/etc</code>. Each piece of software has its own configuration 
format, and writing parsers for each one can be a complex, time-consuming and 
error-prone process. The e-smith software avoids this by using a 
template-driven system instead, using <a 
href="http://search.cpan.org/search?mode=module&amp;amp;query=text::template" 
target=_top><code>Text::Template</code></a>.</p>  <p>Templates are stored in a directory hierarchy rooted at <code>/etc/e-smith/templates</code>. Each configuration file is either a 
<code>Text::Template</code> file or can be given a subdirectory in 
which template fragments are stored. These templates are then parsed (and in the 
case of a subdirectory of fragments, concatenated together) to generate the 
config files for each service on the system. The fragmented approach is part of 
e-smith's modular and extensible architecture; it allows third-party modules to 
add fragments to the configuration, if necessary.</p>  <p>For example, let's look at the <span class=application>ntpd</span> service (which keeps the system's clock right by querying a time server using 
the Network Time Protocol). It usually has a config file 
<code>/etc/ntp.conf</code>. On an e-smith server, this is built out of 
the template fragments found in the <code>/etc/e-smith/templates/etc/ntp.conf/</code> directory.</p>  <p>This is a simple template, and only requires basic variable substitutions. 
(Since <code>Text::Template</code> evaluates anything in braces and 
replaces it with the return value of the code, some templates have more complex 
code embedded within them.) Here is what is in the template fragment file 
<code>/etc/e-smith/templates/etc/ntp.conf/template-begin</code>:</p> <pre>Server { $NTPServer }
driftfile /etc/ntp/drift
authenticate no</pre> <p>In this example, <code>$NTPServer</code> would be replaced with the 
value of that variable.</p> <p>Instead of calling <code>Text::Template</code> directly, e-smith 
developers use the <code>e-smith::util</code> module to automate the 
process. Here's how we would generate the <code>ntp.conf</code> file:</p><pre>use esmith::util;

processTemplate({
    CONFREF =&gt; \%conf,  # this is the %conf from the last section
    TEMPLATE_PATH =&gt; '/etc/ntp.conf',
});</pre> <p>The above example takes advantage of a number of default values set by the 
<code>processTemplate()</code>. If we want more control, we can 
specify such things as the user ID (UID), group ID (GID) and permissions to use 
when writing the configuration file.</p> <pre>use esmith::util;

processTemplate({
    CONFREF =&gt; \%conf,  # this is the %conf from the last section
    TEMPLATE_PATH =&gt; '/etc/ntp.conf',
    UID =&gt; $username,
    GID =&gt; $group,
    PERMS =&gt; 0644,
});</pre> <p>Incidentally, the way in which the <code>processTemplate()</code> routine lets the programmer override the default values is a good example of 
Perlish idiom:</p><pre># the parameter hash the programmer passed to the routine is

my %p = (faults, %params_hash);

</pre> <h3><a name=aen84>Events and Actions</a></h3> <p>When the user hits "submit" on a Web form, a number of things can occur:</p> <p></p> <ul> <li> master configuration files are updated
  <li> templated configuration files in /etc are updated
  <li> network services restarted
  <li> new user account created
  <li> backup performed
  <li> ... or any of a number of other events.</li></ul> <p>The model used to make these things happen is one of actions and events. An 
event is something that happens on the system (such as the user submitting a Web 
form, an installation completing, a reboot, etc). An action is the atomic unit 
of things-that-need-doing, several of which may be called when an event occurs. 
For instance, the <code>post-install</code> event calls actions to 
configure and start various services, initialize the password file, and so 
on.</p> <p>Actions are written as Perl scripts, and stored in <code>/etc/e-smith/events/actions</code>. Some of them just use 
<code>system()</code> calls to do what's needed, as in this example (
<code>/etc/e-smith/events/actions/reboot</code>):</p><pre>package esmith;

use strict;
use Errno;

exec ("/sbin/shutdown", qw(-r now)) or die "Can't exec shutdown: $!";
exit (2);</pre> <p>Others are more complex and can contain as many as a few hundred lines of Perl 
code.</p> <p>An event is defined by creating a subdirectory under <code>/etc/e-smith/events</code> and filling it with symlinks to the 
actions to be performed.</p> <pre>[root@e-smith events]# ls -l user-create/
total 0
lrwxrwxrwx    1 root     root           27 Jan 24 00:07 S15user-create-unix -&gt; ../actions/user-create-unix
lrwxrwxrwx    1 root     root           27 Jan 24 00:07 S20conf-httpd-admin -&gt; ../actions/conf-httpd-admin
lrwxrwxrwx    1 root     root           28 Jan 24 00:07 S20email-update-user -&gt; ../actions/email-update-user
lrwxrwxrwx    1 root     root           30 Jan 24 00:07 S25email-update-shared -&gt; ../actions/email-update-shared
lrwxrwxrwx    1 root     root           22 Jan 24 00:07 S25ldap-update -&gt; ../actions/ldap-update
lrwxrwxrwx    1 root     root           29 Jan 24 00:07 S25reload-httpd-admin -&gt; ../actions/reload-httpd-admin
lrwxrwxrwx    1 root     root           23 Jan 24 00:07 S50email-assign -&gt; ../actions/email-assign
lrwxrwxrwx    1 root     root           21 Jan 24 00:07 S80pptpd-conf -&gt; ../actions/pptpd-conf</pre> <p>Events are called via a script called <code>/sbin/e-smith/signal-event</code>, itself written in Perl. It's 
included here nearly in full, as a detailed example of e-smith code.</p><pre>#!/usr/bin/perl -w

package esmith;
use strict;


my $event = $ARGV [0];
my $handlerDir = "/etc/e-smith/events/$event";


opendir (DIR, $handlerDir)
    || die "Can't open directory /etc/e-smith/events/$event\n";

my @handlers = sort (grep (!/^\.\.?$/, readdir (DIR)));

closedir (DIR);


open (LOG, "|/usr/bin/logger -i -t e-smith");


my $ofh = select (LOG);
$| = 1;
select ($ofh);

print LOG "Processing event: @ARGV\n";


my $exitcode = 0;
my $handler;
foreach $handler (@handlers)
{
    my $filename = "$handlerDir/$handler";
    if (-f $filename)
    {
 print LOG "Running event handler: $filename\n";
 print LOG `$filename @ARGV 2&gt;&amp;1`;
 if ($? != 0)
 {   
     $exitcode = 1;
 }
    } 
}

close LOG;
exit ($exitcode);</pre>  <h3><a name=aen114>Future Development</a></h3> <p>There is currently a locking issue with the global configuration files. The 
techniques used to manipulate these files do not allow multiple processes to 
modify them concurrently. If two programs try to manipulate the files at the 
same time, one of them will overwrite the other's changes. This is obviously 
a serious issue, albeit one that seldom causes problems in normal use, as most 
e-smith servers do not have multiple administrators working on the system at the 
same time.</p> <p>A seemingly obvious solution is to use DBM instead of the current flat-text 
file system. However, the flat-text files are important because they make the 
system config readable and modifiable using a standard text editor from the 
Linux shell prompt. A simple command can then regenerate other configs or stop 
or start services based on the changes, without requiring the Web interface to 
be used. This is useful in the situation when the Web interface might have 
been broken (a rare situation) or when a configuration option is hidden from 
less technical users.</p> <p>A solution combining the benefits of text files and DBM has been suggested, 
in which the routine that reads the config database would check to see whether 
the text file has been changed recently. If it has been changed, it would convert it to 
DBM, otherwise it would just use the DBM directly. When a configuration option 
is changed, it would be written to both the DBM and the text file.</p> <p>Another problem is the way that multiple instances of the Perl interpreter 
are invoked to run events and actions, causing some performance problems. A 
number of alternatives are being considered, including <a 
href="http://perl.apache.org/" target=_top>mod_perl</a> and <a 
href="http://poe.perl.org/" target=_top>POE</a>. The goal is to reduce the wait 
experienced by the user when they click "submit" via the Web interface; 
ideally, response should be near-instantaneous.</p> <p>Other forthcoming improvements include a simpler way to create "wizard" 
interfaces for the e-smith manager (possibly using the <a 
href="http://sourceforge.net/projects/formmagick/" target=_top>FormMagick</a> Perl module currently under development), and internationalisation (probably 
using the <a 
href="http://search.cpan.org/search?mode=module&amp;amp;query=Locale::Maketext" 
target=_top>Locale::Maketext</a> module).</p>  <h3><a name=aen125>In Conclusion ...</a></h3> <p>The e-smith server and gateway is a great example of a large project using 
Perl both as a system administration scripting tool and a Serious Programming 
Language. Although it has about 20,000 lines of Perl code, the system 
is easy to understand and the Perl code is maintainable and readable, 
even by relatively inexperienced Perl programmers.</p> <p>If you're interested in taking a closer look at the e-smith code, or maybe 
contributing to it, more information is available from the <a 
href="http://www.e-smith.org/" target=_top>e-smith developer 
Web site</a>.</p>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1460" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/02/p6pdigest/THISWEEK-20010218.html" rel="bookmark">This Week on p6p 2001/02/18</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-02-18T00:00:00-08:00">February 18, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This week on perl6 (12-18 Feb 2001) -->
<!- :field::id-author::before=by+::>
<br />
<!- :field::date::>
<br />
      <H3><a name="Notes">Notes</a></H3>



<P>

Please send corrections and additions to 
<CODE>perl6-thisweek-YYYYMM@simon-cozens.org</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
</P>

<P>
We looked at over 400 messages this week, about a quarter of which were
to do with garbage collection. Again. I'm afraid this week's summary is
a little short, but I'd rather get it out early than leave it until it's
a week old.
<H3><a name="Garbage_Collection">Garbage Collection</a></H3>

</P>

<P>

The GC fetish rages on, despite Dan's valiant efforts to call a
temporary halt to the discussion. Dan also valiantly tried to
distinguish between garbage collection (which is the freeing of unused
memory) and destruction. (which is what the 
<CODE>DESTROY</CODE> method provides for objects) When he claimed that &quot;Perl needs some
level of tracking for objects with finalization attached to
them. Full refcounting isn't required, however&quot;, (Note: Jan Dubois later
pointed out that what we were calling finalization is actually object
destruction) Sam Tregar came back with three important questions:
<blockquote></P>

<P>
 I think I've heard you state that before.  Can you be more specific?
 What alternate system do you have in mind?  Is this just wishful thinking?
</blockquote></P>

<P>
It has to be said that Dan seemed reluctant to answer the first two
questions, and both Sam and Jan Dubois pulled him up on this. Dan said
that he did not have time right now, but also said that most variables
would not need finalization, and of those which did, most would not need
reference counting because the lifespan of a variable can be determined
by code analysis:
<blockquote></P>

<P>
Most perl doesn't use that many objects that live on past what's obvious
lexically, at least in my experience. (Which may be rather skewed, I
admit) And the ratio of non-destructible objects to everything else is
also very small. Even if dealing with destructable things is reasonably
expensive, the number of places we pay that (and the number of times we
pay that) will be small enough to balance out. If that turns out not to
be the case, then we toss the idea and go with plan B.
</blockquote></P>

<P>
A lot of people made noises to the effect that they want predictable
destruction, so that's probably something that will happen - Perl 5 now
claims to have predictable 
<CODE>DESTROY</CODE> calling, after a patch by Ilya a couple of months back. Unfortunately,
 it transpires that the only way to get predictable destruction is to
use reference counting.
</P>

<P>
There was some
 discussion of the weird and usually unexpected interaction between 
<CODE>AUTOLOAD</CODE> and 
<CODE>DESTROY</CODE>, where the consensus seemed to be that 
<CODE>AUTOLOAD</CODE> should not, in future, be consulted for a 
<CODE>DESTROY</CODE> subroutine; Perl should do what its programmers actually want, instead
of what they consider consistent.
And there was a lot more <!-- ill-informed ranting by people who have no idea how the current Perl 5 destruction/garbage-collection mechanism works, --></P>

<P>
discussion which unfortunately produced 
far more light than heat. On the other hand, stay tuned for a
potential GC PDD from Dan next week.
<H3><a name="More_end_of_scope_actions">More end of scope actions</a></H3>

</P>

<P>

(Thanks to Bryan Warnock for this report)
</P>

<P>
In response to various peripheral discussions, Tony Olekshy
<a href="http://archive.develooper.com/perl6-language@perl.org/msg05604.html)">kicked off </a> a revisit to RFC 88, dealing with end-of-scope matters, particularly in the
area of exception handling.  The bulk of the various discussions subtitled
&quot;Background&quot;, &quot;Visibility&quot;, &quot;POST blocks&quot;, &quot;Reference model 2.0.2.1&quot;, 
&quot;Error messages&quot;, and &quot;Core Exceptions&quot; resulted in light traffic -
responses were generally limited to Q&amp;A.  (Although James Mastros did
provide an alternate syntax for a POST block, in an effort to minimalize
the exception handling syntax.)  The thead covering &quot;do/eval duality&quot;
generated more discussion, but was mainly centered around the
semantics of the duality in Perl 5. Likewise, the thread covering &quot;Garbage
collection&quot; did little more than to try to agree on proper terminology.  
</P>

<P>
The only new material presented was in the sub-thread &quot;Toward a hybrid
approach&quot;, where Tony and Glenn Linderman attempted to consolidate a
traditional static try/catch/finally exception model with a dynamic
always/except model.  Both Tony and Glenn posted a number of examples - 
too lengthy to do justice to here.  But the whole discussion can basically 
be boiled down to these two messages:
<a href="http://archive.develooper.com/perl6-language@perl.org/msg05868.html">this one</a> and
<a href="http://archive.develooper.com/perl6-language@perl.org/msg05985.html">this one</a>.
</P>

<P>
Tony has a 
<a href="http://www.avrasoft.com/perl6/try6-2021.txt">working model</a>, and you may want to revisit RFCs 
<a href="http://dev.perl.org/rfc/88.html">88</a> and
<a href="http://dev.perl.org/rfc/119.html">119</a>.
<H3><a name="Quality_Assurance">Quality Assurance</a></H3>

</P>

<P>

(Thanks to Woodrow Hill for this summary; you wouldn't believe how much
easier this job gets when other people do it for you.)
</P>

<P>
Michael got the whole ball rolling with a number of &quot;wake up&quot; postings to 
perl-qa, including such highlights as:
<blockquote></P>

<P>
...we had some ideas about developing a sane patching process.[...] Patch, 
Test, Review, Integrate.  Please comment/add/take away.
</blockquote></P>

<P>
Which no one seems to have done. But his comment that:
<blockquote></P>

<P>
As part of the QA process we need to do alot of test coverage analysis
and, to a lesser extent, performance profiling.  Our existing tools
(Devel::Coverage, Devel::DProf, Devel::SmallProf) are a start, but
need alot of work.  We need really solid, tested, documented libraries
*and* tools to pull this off.
</blockquote></P>

<P>
got folks talking about how complex a topic this is, and how many different 
way it can be looked at. Paul Johnson came to the rescue with a nice piece 
of work describing 
<a href="http://archive.develooper.com/perl-qa@perl.org/msg00277.html">Code Coverage</a>.
</P>

<P>
All this finally led to the creation of perl-qa-metrics, for the discussion 
of code metrics and other forms of analysis as thy apply to Perl.
</P>

<P>
Michael also asked for Administrative help:
<blockquote></P>

<P>
I need someone to
maintain/take responsibility for:
<ul><li> A list of projects and their development status and needs.<li>  Making sure things move forward<li> A "this week on perl-qa" style summary<li> The code repository<li> Mailing list organization (creating new lists when necessary, etc..)</ul></blockquote></P>

<P>

Which he then clarified with:
<blockquote></P>

<P>
I think that's what I need.  A project manager.  If anyone out there
actually has experience in any of this, feel free to shout loudly.
</blockquote></P>

<P>
Michael started another thread with his comment about Test::Harness. He 
noticed that there's an ill-documented option for it to allow certain test 
to fail by design, for unimplemented features and the like. 
</P>

<P>
This led to a discussion about how exactly to write the test, closures vs. 
if/then vs. CODE references, which seems to have come to this conclusion:
<blockquote></P>

<P>
Michael: Okay, we'll file this discussion under YMMV.
</P>

<P>
Barrie: That's my point.  Your style isn't the only one out here.
</blockquote><H3><a name="String_Encoding">String Encoding</a></H3>

</P>

<P>

(Thanks again to Woodrow Hill)
</P>


<P>
Character representations in Perl 6
</P>

<P>
Hong Zhang started out the thread with:
<blockquote></P>

<P>
I want to give some of my thougts about string encoding...
Personally I like the UTF-8 encoding.
...
The new style will be strange, but not very difficult to
use. It also hide the internal representation.
</P>

<P>
The UTF-32 suggestion is largely ignorant to internationalization.
Many user characters are composed by more than one unicode code
point. If you consider the unicode normalization, canonical form,
hangul conjoined, hindic cluster, combining character, varama,
collation, locale, UTF-32 will not help you much, if at all.
</blockquote></P>

<P>
Simon pointed out that the general direction for Perl 6 currently seemed to 
point towards the use of codepoints instead of an internal UTF-8 
representation, for simplicity of tracking character positions, amongst 
other issues. Hong disagreed, and thus began a interesting little set of 
emails concerning the use of UTF-8, 16, or 32 vs. codepoints in Perl, the 
efficiency of determining the position of a character in Perl using the 
various encoding schemes, and so on. As Dan would maintain:
</P>

<P><blockquote>
To find the character at position 233253 in a variable-length encoding 
requires scanning the string from the beginning, and has a rather 
significant potential cost. You've got a test for every character up to 
that point with a potential branch or two on each one. You're guaranteed to 
blow the heck out of your processor's D-cache, since you've just waded 
through between 200 and 800K of data that's essentially meaningless for the 
operation in question.
</blockquote></P>

<P>
And Simon commented, towards the end of this thread, that:
</P>

<P><blockquote>
I think you're confused. Codepoints *are* characters. Combining characters 
are taken care of as per the RFC.
</blockquote></P>

</P>
         The commentary seemed to end with Hong restating his basic 
position for the record, that UTF-8 was the way to go, and Dan's response:


<P><blockquote>
Um, I hate to point this out, but perl isn't going to have a single string 
encoding. I thought you knew that.
</blockquote><H3><a name="Various">Various</a></H3>


<P>

Branden tried to bring up the deadly 
<CODE>|||</CODE> operator again. This did not go down well. Ziggy suggested a PDD to
document all the hoary old crap that we don't want to drag up again.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

<hr>

<a href="mailto:simon@brecon.co.uk">Simon Cozens</a>


<ul>
  <li><a href="#Notes">Notes</a>
  <li><a href="#Garbage_Collection">Garbage Collection</a>
  <li><a href="#More_end_of_scope_actions">More end of scope actions</a>
  <li><a href="#Quality_Assurance">Quality Assurance</a>
  <li><a href="#String_Encoding">String Encoding</a>
  <li><a href="#Various">Various</a>
</ul>


        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1454" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/02/p5pdigest/THISWEEK-20010212.html" rel="bookmark">This Week on p5p 2001/02/12</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-02-14T00:00:00-08:00">February 14, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This week on perl5-porters (06-12 Feb 2001) -->

<br />
<br />
      <H3><a name="Notes">Notes</a></H3>

<P>

You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com"><tt>p5p-digest-subscribe@plover.com</tt>.</a></P>

<P>
Please send corrections and additions to 
<CODE>perl-thisweek-YYYYMM@simon-cozens.org</CODE> where 
<CODE>YYYYMM</CODE> is the current year and month.
</P>

<P>
I've been having mail problems this week, so it's possible that I've
missed one or two important things. Even so, it seems to be looking
relatively quiet out there.
<H3><a name="Perl_FAQ_updates">Perl FAQ updates</a></H3>

</P>

<P>

A number of bug reports and suggested fixes came in regarding the Perl
FAQ this week; the most contentuous one was a bug in the regular
expression for matching email addresses given in 
<CODE>perlfaq9</CODE>. Everyone agreed that there was no point trying to be completely
correct, since the RFC822 grammar for an email address is not easily
reduced into a regular expression. There are complete regular
expressions, such as the one in Abigail's 
<CODE>RFC::RFC822::Address</CODE>  module, and the one given in Jeffery Friedl's &quot;Mastering Regular
Expressions&quot;. However, the current one required some slight tweaking.
</P>

<P>
This, combined with the other bug reports both on P5P and 
<CODE>perl-friends</CODE>, led Jarkko to set up a working group to look after the FAQ. If you're
interested in helping out, see 
<a href="http://lists.perl.org/showlist.cgi?name=perlfaq-workers">the list's home page</a>.
<H3><a name="Namespace_for_IO_Layers">Namespace for IO Layers</a></H3>

</P>

<P>

Nicholas Clark asked three difficult questions about IO layers:
<blockquote></P>

<P>
1: How is it proposed to avoid namespace clashes with layers?
</P>

<P>
2: Is there a suggested namespace (eg Layer:: ?) for modules
implementing layers?
</P>

<P>
3: Is there a standard (memorable) way of passing arguments to layers?
</blockquote></P>

<P>
The other Nick said that he wanted the layer names (
<CODE>:gzip</CODE> and the like) to behave like (and possibly even converge with)
attribute names, and so generalised the problem to &quot;how do we avoid
namespace clashes with attributes?&quot;. As for question two, he suggested
the 
<CODE>PerlIO::</CODE> or 
<CODE>perlio::</CODE> namespaces. The final question caused more consternation. Nicholas
wanted to avoid problems where an argument to a layer could have meaning
to the layer system in general. It wouldn't be good, for instance, to
say
</P>

</P><PRE>
    open (FOO, ':layer(name="(test1),:gzip")', $file)
</PRE>

<P>
He first proposed a system similar to URL encoding, using 
<CODE>%XX</CODE> to escape significant characters. Nick Ing-Simmons got a little worried
at this point:
<blockquote></P>

<P>
I have a feeling that putting too much in the one string is a mistake.
I think we may need something akin to 
<CODE>ioctl()</CODE> which can call
&quot;method(s)&quot; on the &quot;layer object&quot; to allow a more extensible
approach.
</blockquote></P>

<P>
Surprisingly, this is what Ilya was saying
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2000-04/msg00098.html">nearly a year ago</a>.
<H3><a name="Memory_Leak_Plumbing">Memory Leak Plumbing</a></H3>

</P>

<P>

Alan has been working exceptionally hard of late on what he called the
&quot;south end of the camel&quot;: memory leaks. He's been using a software tool
called &quot;Purify&quot; that checks for leaks and illegal memory accesses. 
</P>

<P>
Firstly, he discovered something awry in 
<CODE>Perl_pmtrans</CODE>, part of the regular expression engine. This led him to issue the
following plea:
<blockquote></P>

<P>
The fact that
there isn't even a comment explaining what it is supposed to do isn't
helping - it is virtually impossible to figure out if it is working
correctly if I have no idea of what is correct behaviour.
</P>

<P>
A heartfelt plea - *please* comment your code.  Take pity on those of us
following at the south end of the camel, carrying the shovel and bucket.
</blockquote></P>

<P>
Next, he produced evidence of a leak in another part of the RE engine,
along with some code which is probably doing something exceptionally
evil indeed: it saves a way a pointer, sets it to zero, saves it again
and then re-allocates some memory for it. Obviously, when it's time for
the saved-away values to be restored, Bad Things happen. Alan says that
before he started work on 
<CODE>Perl_pmtrans</CODE> it was leaking 96% of available memory - a far cry from the usual call
that &quot;the only thing that leaks memory is failed evals&quot;.
</P>

<P>
That was, however, the next area that Alan planned to take on but it's a
very hard problem. Nick Ing-Simmons is going to take a look at it, and
Nicholas Clark came up with his favourite memory leak, which Alan duly
fixed.
</P>

<P>
He also found a rather major memory leak in the Perl destruction
process; his fixes to the SV allocation process were coming up with
strange errors about &quot;unbalanced reference counts&quot;. He thought this was
initially a problem in his patch, but eventually it became clear that
strings in environment variables or parser tokens weren't being
properly freed, because they weren't been allocated from designated
blocks of memory. (&quot;arenas&quot;) Worse, everything in stashes had problems
with circular references: the variable would contain a reference to its
parent stash, and vice versa. Just for fun, 
<CODE>%main::</CODE> refers to itself, because as it's set up, it declares itself to be its
own parent. (That's why you can do
<CODE>$main::main::main::c</CODE>)
</P>

<P>
Hopefully, Perl will be a lot less leaky in the very near future - and
you have Alan to thank for that.
<H3><a name="Shared_functions">Shared functions</a></H3>

</P>

<P>

Last week, I mentioned Doug MacEachern's experiments with shared subs.
This week, he's produced a complete patch which allows you to say (in an
XSUB):
</P>

</P><PRE>
    void
    foo()
</PRE>

</P><PRE>
      ATTRS: shared
</PRE>

<P>
and the resulting sub will be shared between interpreters. 
<CODE>Apache::*</CODE> module authors, listen up. This one could be useful for you.
</P>

<P>
There was a little concern that there was no locking provided on the
shared subroutine code, but Doug countered that the 
<CODE>GvSHARED</CODE> test combined with the 
<CODE>SvREADONLY</CODE> flag meant that if anyone messed around with the GV, they basically had
to take responsibility for their actions...
<H3><a name="Perl_6_Is_Alive">Perl 6 Is Alive!</a></H3>

</P>

<P>

Rumours of Perl 6's death have been greatly exaggerated, and devotees of
this weekly summary will be overjoyed to learn that I (together with my
merry band of volunteers) will be putting together summaries of the
<a href="http://dev.perl.org/lists">Perl 6 mailing lists</a>.
</P>

<P>
Later on this week and from next week, the summaries will be appearing on 
the front page of
<a href="/">http://www.perl.com/</a>; this week's issue is temporarily located at
<a href="http://simon-cozens.org/perl6/THISWEEK-20010211.html">http://simon-cozens.org/perl6/THISWEEK-20010211.html</a><H3><a name="Various">Various</a></H3>

</P>

<P>

Quite a few bug reports annd a few quick fixes, but nothing else of
major note.
</P>

<P>
Until next week I remain, your humble and obedient servant,
</P>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1450" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/02/14/p6p.html" rel="bookmark">Perl 6 Alive and Well! Introducing the perl6-mailing-lists Digest</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-02-14T00:00:00-08:00">February 14, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- Perl 6 Alive and Well! Introducing the perl6-mailing-lists Digest -->
<!- :field::id-author::before=by+::>
<br />
<!- :field::date::>

<blockquote><em>"What *is* going on over there, anyway? It is unfortunately 
  true that the effort looks stalled from the outside."</em> 
  <br>&nbsp;&nbsp;&nbsp;&nbsp;- Eric S. Raymond, to the <a   href="http://www.mail-archive.com/perl6-meta@perl.org/msg00622.html">perl6-meta</a> 
  mailing list </em></blockquote>
<p>The push towards the next major version of perl started with a bang -- 
literally, thanks to Jon Orwant and his <a 
href="http://www.mail-archive.com/perl6-meta@perl.org/msg00409.html">now-infamous</a> 
coffee-mug-tossing act. Mailing lists were set up, a flurry of RFCs were 
submitted, and now, almost five months since the RFC process ended... Quiet. 
What *is* going on with perl6, anyway?</p>
<p>As it stands now, the silence is mostly due to the fact a lot of the work has 
gone underground. First, of course, we continue to wait eagerly for Larry's 
language design, although as Larry himself <a 
href="http://lwn.net/2001/features/LarryWall/">points out</a>, he's got his 
hands full with the 361 RFCs submitted last fall. Elsewhere, work continues at a 
steady murmur, especially on the <code>perl6-language</code> and 
<code>perl6-internals</code> lists. In particular, the 
<code>perl6-internals</code> group, led by the redoubtable Dan Sugalski, has 
borne some recent fruits, as discussions have started to coalesce into "Perl 
Design Documents," or PDDs.</p>
<p>PDDs are detailed white papers that will hopefully serve as guides when 
people actually sit down to write code. So far, PDDs have been submitted to 
<code>perl6-internals</code> relating to the structures of the interpreter 
itself, and of <code>vtables</code>, which will be used to implement primitive 
variables, like scalars. More PDDs are expected on other language-independent 
features, like garbage collection and I/O abstraction, which will need to be 
implemented somehow, regardless of what Larry's final language design looks 
like. Some preliminary code for the perl6 interpreter might even be written in 
the next month or so, once the existing PDDs are finalized.</p>
<p>So, contrary to all outward appearances, perl6 is indeed alive and well! In 
order to remedy this information deficit, Simon Cozens has stepped forward, and 
volunteered a companion to his perl5-porters digest. As such, the O'Reilly 
Network is pleased to introduce the first edition of the <b>perl6 mailing lists 
digest</b>. Simon plans to set up e-mail distribution (analogous to the p5p 
digest), so we'll be sure to let you know when that happens. Meanwhile, the 
perl6 digest will become a regular weekly feature of www.perl.com, hot off the 
mailing lists to you. Enjoy!</p>

<h2>This week on perl6 (04--11 Feb 2001)</h2>

<p>

Please send corrections and additions to 
<code>perl6-thisweek-YYYYMM@simon-cozens.org</code> where 
<code>YYYYMM</code> is the current year and month.
</p>

<p>
This week was reasonably quiet, seeing around 350 messages in all the
groups. For a change, most of the traffic was on 
<code>perl6-language</code><h3><a name="Autoloading_Modules">Autoloading Modules</a></h3>

</p>

<p>

Last week, Dan asked people to think about ways to autoload modules when
a function was used; the idea being that you'd be able to say, for
instance:
</p>

</p><pre>
    socket(SOCK, PF_INET, SOCK_STREAM, $proto);
</pre>

<p>
(or moral equivalent) and Perl would load in all the socket functions.
This is actually what Perl 5 already does for 
<code>glob</code> and some of the Unicode functionality. Some people went off on a bit of
a tangent and started discussing ways to autoload modules more
generally, by having modules declare what functionality they're providing.
</p>

<p>
One big question for both sub-discussions was how we key the functions to 
code. Jarkko said:
<blockquote></p>

<p>

A gut feeling that I have is we can't simply go by interface 'names',
be they just simple names of funtions/methods or their full
'signatures'
(let us not even start on (1) how difficult with Perl's type system
and functions it is to define signatures (2) the difficulty in
defining an ontology/vocabulary), either would not really be enough.
</p>

<p>
What I think is needed is some sort of opaque tag: the name of the
'contract' the API claims to fulfill.  The name can be the name of 
the standard, the name of the company, the name of the individual.
</blockquote></p>

<p>

Branden suggested that a URI should be used, leading to the inevitable
but still horribly scary notion of
</p>

</p><pre>
    use autoload { Bar => 'http://www.cpan.org/modules/Bar' },
                 { Baz => 'ftp://my.local.domain/perl-modules/Baz', VERSION
                 => 2 };
</pre>

<p>
Various people pointed out that this might not be secure.
<h3><a name="Packaging">Packaging</a></h3>

</p>

<p>

The autoloaded core functions idea got slightly left by the wayside,
as the discussion finally veered off onto how to package up modules and
programs to satisfy dependencies and make things easy for the user. A
setup similar to Java's &quot;jar&quot;s was suggested. Dan came up with the very
simple and neat idea of simply shipping a bytecode compiled version of
a program instead. Schwern was a bit concerned that this would lose
source code and would separate out documentation; Dan's brilliant answer
was: 
<blockquote></p>

<p>
Not unless you strip the bytecode. I want to optionally package the
source in the bytecode, since otherwise you can't do some optimizations
after the fact on the generated bytecode stream.
</blockquote></p>

<p>
He also suggested a text segment in bytecode so that, for instance, you
can still get POD embedded in code.
</p>

<p>
That's something that may well happen anyway, but Branden came back on
the packaging issue. He noted that Dan's suggestion wouldn't help for
modules with C extensions, and also said:
<blockquote></p>

<p>
Actually, I think the archive approach is more general, because it
wouldn't have this kind of problems and would allow other resources to
be deployed together with the code, like documentation, perhaps even
text files and images used by a Perl/Tk application
</blockquote></p>

<p>
Comparisons were made between this and the currently-existing PPM.
Branden produced a 
<a href="http://archive.develooper.com/perl6-language@perl.org/msg05694.html">draft PDD</a> for his ideas.
<h3><a name="Vtables">Vtables</a></h3>

</p>

<p>

At long last, Dan produced the second PDD, specifying 
<a href="http://archive.develooper.com/perl6-internals@perl.org/msg02305.html">the vtable API</a>. As expected, this exposed a lot of hidden confusion about what vtables are
for and how they're going to be handled. Tim piped up with a few
questions and corrections, including a discussion about how string
handling is going to work, especially string encoding. Dan said he 
deliberately left UTF8 off, because dealing with variable-length data
is horrid. Most people disagreed, saying that UTF32 was too big for most
people, and UTF8 was a good compromise for most data. It was generally
agreed that an abstracted string handling layer would make most of the
problem go away.
</p>

<p>
Edwin Steiner asked whether the vtable API should be made up of macros;
I pointed out that this was the road that Perl 5 went down, and look
what happened to that. Dan also said that there wouldn't be an &quot;API&quot; for
vtables - they're to be used by the Perl guts only.
</p>

<p>
There was still a lot of confusion as to how overloading and aliasing
would be accomplished. Branden came up with an alternative suggestion
for how to handle vtables, which seemed to be rather more high-level.
The current vtable PDD wants to make many core ops a single vtable call
if possible. There seemed to be much confusion about how the <code>key</code> field worked, and what operation was being carried out on what. No
doubt further revisions of the PDD will clear this up. Dan also said
that once the PDD has matured a little more, he wants to start writing
code for the base classes. We're nearly there, guys</p>.
<h3><a name="Subroutine_return_values">Subroutine return values</a></h3>



<p>

There was a lot of light but very little heat in the continuing saga of
assigning to a magic return value variable. Some people seem to want to
do this:
</p>

<pre>
    sub foo {
        foo = 10;
    }
</pre>

<p>
instead of 
<code>return 10</code>, just like Pascal, Algol and all those other failed, now-dead
languages.
</p>

<p>
A (slightly) better suggestion was a magic variable to hold the return
value, similar to what 
<code>Parse::RecDescent</code> (and of course, 
<code>yacc</code>) does. The names 
<code>$__</code> and 
<code>$^R</code> were suggested, but there was no consensus on whether or not it would
even be a good idea.</p> 
<h3><a name="End_of_Scope_Actions">End of Scope Actions</a></h3>

<p>

A far better idea came out when people stopped looking at what they
wanted and started looking at why they wanted it. A lot of the value in
having a assignable return value is in the situation of subroutines
which set something up, compute, and then turn it down again. Another
way of looking at that was to stipulate a block executed at the end of
the scope, like this:
</p>

<pre>
    sub lines {
        open IN, $_ or die $!;
        return scalar(&lt;in>);
    }
    post lines { # This is executed on return
        close IN;
    }
</pre>

<p>
Damian had, of course, thought ahead, and this is covered by his 
<a href="http://dev.perl.org/rfc/271.html">RFC 271</a>. However, he agreed that post-block actions should be allowed
everywhere, not just on subroutines. The 
<code>always</code> keyword was agreed upon as a good way of doing this, although
<code>POST</code> was also suggested. This lead to the
semi-inevitable rehash of the 
<code>try</code>-
<code>catch</code> exception handling debate. According to John Porter,</p>
<blockquote>

<p>
There is no 
<code>try</code>, there is only 
<code>do</code>. :-)
</blockquote>

<h3><a name="Garbage_Collection">Garbage Collection</a></h3>

<p>

Jamie Zawinski published his 
<a href="http://www.jwz.org/doc/java.html">rant about Java</a>, which caused certain sensible people to ponder how to make sure Perl
avoids the same mistakes. A few of the things mentioned included
platform independence, the size of SVs, locking, but the discussion
settled down to garbage collection, as rather a lot of discussions on 
<code>perl6-internals</code> are wont to do. (Oh, this was on 
<code>perl6-language</code>. Ho hum.)
</p>

<p>
The trigger was a question from Branden:</p>
<blockquote>
I actually don't understand how traversing a graph can be faster than
incrementing/decrementing/testing for zero on a refcount. I believe you,
but I just don't understand. Could you point me to some URLs that talk
about this?
</blockquote></p>

<p>
and a masterful answer from Piers:
</p><blockquote>

<p>
There's a jolly good book on this called (would you believe) 'Garbage
Collection'. The crux of the matter would appear to be that with
refcounts you have to do a pretty small amount of work very, very
often. With a well designed GC system you do a largish amount of work
much less frequently. The total amount of work done tends to come out
higher in the refcounting scenario.</p>
</blockquote>

<p>
This was coupled with a  
<a href="http://archive.develooper.com/perl6-language@perl.org/msg05693.html">more comprehensive answer</a> from Ken Fox. Dan said he wanted to put GC-related data at the end of a
variable, so that it didn't always get loaded into memory. He also
pointed out that</p>
<blockquote>

<p>
The less memory you chew through the faster your code will probably be
(or at least you'll have less overhead). Reuse is generally faster and less
resource-intensive than recycling. What's true for tin cans is true for
memory.
</blockquote></p>

<p>
and hinted that Perl 6 is likely to be using a generational semi-space
garbage collection scheme.
<h3><a name="kdb">kdb</a></h3>

</p>

<p>

Joshua Pritikin mentioned 
<a href="http://www.kx.com/">kdb</a>, but had to be tortured before he would explain why. It eventually
became clear he was talking about the K language and its interesting
data model; he says:
<blockquote></p>

<p>
Whether K is ultimately a failure or not, i find it to be an interesting
mix of design trade-offs.  Of course i'd have to use it in a real
project to offer a detailed report of its weaknesses.
</blockquote><h3><a name="ESR_on_Perl_6">ESR on Perl 6</a></h3>

</p>

<p>

Eric Raymond released two more chapters of his on-line book 
<a href="http://www.tuxedo.org/~esr/writings/taoup">The Art of Unix Programming</a>, something Perl 6 people would do well to read. Unfortunately, he
wasn't particularly complimentary about Perl, claiming that both Perl 5
and Perl 6 are currently stagnant and stalled. This led to a rather
acrimonious discussion about our public image, and it was resolved that
these summaries might help us let the public know what's going on. So
here we are.
</p>

<p>
And there we were. Until next week I remain, your humble and obedient
servant,</p>
<p><a href="mailto:simon@brecon.co.uk">Simon Cozens</a>

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1452" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/02/p5pdigest/THISWEEK-20010206.html" rel="bookmark">This Week on p5p 2001/02/06</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Simon Cozens</span> on <abbr class="published" title="2001-02-06T00:00:00-08:00">February  6, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <!-- This week on perl5-porters (29 Jan - 05 Feb 2001) --> 


<br />
 
<H3><a name="Notes">Notes</a></H3>  

<P>  You can subscribe to an email version of this summary by sending an
empty message to 
<a href="mailto:p5p-digest-subscribe@plover.com">p5p-digest-subscribe@plover.com.</a></P>  <P> Please send corrections and additions to 
<code>perl-thisweek-YYYYMM@simon-cozens.org
</code> where 
<CODE>YYYYMM</CODE> is the current year and month.
</P>  <P> Wow. 600 messages this week, and that's not counting a lot of the test
result messages. 
<H3><a name="Perl_561_not_delayed_after_all">Perl 5.6.1 not delayed after all</a></H3>  

<P>  It had to happen. Just after I announced last week that 5.6.1 would be
delayed, Sarathy announced the release of 5.6.1 trial 2. This is
available for testing on CPAN at 
<a href="http://www.cpan.org/authors/id/G/GS/GSAR/perl-5.6.1-TRIAL2.tar.gz">$CPAN/authors/id/G/GS/GSAR/perl-5.6.1-TRIAL2.tar.gz </a>. Sarathy says:
<blockquote></P>  <P> Thanks largely to Jarkko's help, the second trial version of perl
v5.6.1 is now available.  (CPAN may need some time to catch up.)
</P>  <P> If this release passes muster, I will update perldelta.pod and send
it to CPAN as v5.6.1.  Owing to the large number of patches, testing
is very very important.  So give it all you've got on all your
favourite platforms!
</P>  <P> In particular, I'd like to see some purify (or similar) runs.  Patches
to documentation are also welcome.  Changes to *.[ch] are probably
out unless they are fixing serious bugs.
</blockquote></P>  <P> Naturally, this produced a deluge of test results, the vast majority of
which were successful. As usual, if you've got any weird and funky
platforms, give it a spin.
</P>  <P> And, of course, well done to Jarkko and Sarathy for putting this one
together.
<H3><a name="MacPerl">MacPerl</a></H3>  </P>  <P>  I forgot to mention this last week, but it's important enough for me to 
mention it this week: Chris Nandor has taken over the MacPerl pumpkin.
If you have a Mac and you want to run Perl on it, (or even better, help
move MacPerl up to 5.6.1) then you really ought to read Chris' 
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01724.html">State of MacPerl</a> posting.
<H3><a name="select_on_Win32">select() on Win32</a></H3>  </P>  <P>  Barrie Slaymaker mentioned that he wanted to get 
<CODE>select()</CODE> working on Win32, and that Perforce were interested in funding the
work. Nick Ing-Simmons said that the PerlIO abstraction layer would help
with this:
<blockquote></P>  <P> he problem is that on Win32 to use 
<CODE>select()</CODE> the Socket has to be in synchronous mode. While to use 
<CODE>WaitForMultipleEvents()</CODE> the Socket has
to be in asynchronous mode - thus if you want to use Win32's native
&quot;poll-oid&quot;
API you cannot use 
<CODE>select()</CODE>. In addition MS's C runtime (
<CODE>read</CODE>/
<CODE>fread</CODE> etc) will not work on sockets in asynchronous mode (or non-blocking IO in
general).
</P>  <P> So you need to replace 
<CODE>read</CODE> and 
<CODE>stdio</CODE> with another IO subsystem and get perl to use it - hence PerlIO.
</blockquote></P>  <P> Uri Guttman predictably took this as a cue to push for a portable event
interface; Rocco Caputo said that he'd added an event-driven 
<CODE>IPC::Run</CODE>-style process communication model to his 
<CODE>POE</CODE> module which worked fine on Win32, using TCP sockets as a form of
<CODE>select()</CODE>-able pipe emulation.
</P>  <P> Nick wanted to work at the problem from the other end, by building up a
new PerlIO bottom layer for Windows, using the native Windows IO calls.
Sean McCune, who's working with Barrie on this, said that's what he
would try to do. As Jarkko pointed out:
<blockquote></P>  <P> First fork() emulation and now select()?  If we are not careful in ten
years or so NT/W2K/W2010 will be almost as useful as UNIX was in
mid-1980's.
</blockquote><H3><a name="TestHarness">Test::Harness</a></H3>  </P>  <P>  At last, Schwern's Test::Harness patch made it in, after a tiny bit more
messing around. The discussion turned into a useful thread on patching
strategies. For instance, it's apparently not very widely known that if
you add a new file to the Perl distribution, you also need to patch the 
<CODE>MANIFEST</CODE> file. There's also a load of good information in the file 
<CODE>Porting/patching.pod</CODE>. Andreas Koenig also put in a plug for Johan Vroman's 
<CODE>makepatch</CODE> utility:
<blockquote></P>  <P> Johan Vromans has written a powerful utility to create patches based
on large diretory trees -- makepatch. See the JV directory on CPAN for
the current version. If you have this program available, it is
recommended to create a duplicate of the perl directory tree against
which you are intending to provide a patch and let makepatch figure
out all the changes you made to your copy of the sources. As perl
comes with a MANIFEST file, you need not delete object files and other
derivative files from the two directory trees, makepatch is smart
about them.
</blockquote></P>  <P> Nicholas Clark suggested that each time you plan to make a change, you
can call configure with 
<CODE>-Dmksynlinks</CODE> which creates a symlink farm. Then when you change a file, remove the
symlink and replace it with a real copy of the file. This means you can
maintain multiple patch trees without the space overhead of full source
trees. Other suggestions included various version control systems, and
some people provided programs to sync up 
<CODE>bleadperl</CODE> with their local version control repository.
</P>  <P> Schwern also came out with a load of documentation patches explaining
the difference between 
<CODE>chop</CODE> and 
<CODE>chomp</CODE> from a portability point of view, and changing the examples to use 
<CODE>chomp</CODE> where they previously used
<CODE>chop</CODE>.
<H3><a name="CHECK_blocks">CHECK blocks</a></H3>  </P>  <P>  Piers Cawley asked about 
<CODE>CHECK</CODE> blocks
<blockquote></P>  <P> I have a CHECK block that checks that
all the methods requested by the interface are accessible. No problem.
</P>  <P> Until, one of my class's client classes comes to do a deferred load
using require and everything falls over in a heap because it's
</P>  </P><PRE> Too late to run CHECK block.
</PRE>  <P> And I can't, for the life of me, understand why.
</blockquote></P>  <P> So, what's a 
<CODE>CHECK</CODE> block? The idea is that they're supposed to be called after compilation
is completed. They're intended to be used by the compiler backends, to
save the program state once everything's been assembled into an op tree.
However, there's no reason why you can't use them for other things
instead.
</P>  <P> The problem that Piers was coming up against was that we expect 
<CODE>CHECK</CODE> blocks to be run every time something is compiled, but this doesn't
happen yet; Sarathy explains:
<blockquote></P>  <P> In the current implementation, there is exactly one point at which
CHECK and INIT blocks are run (this being the point at which the
Compiler would do its work, when it saves and restores program
state, respectively).
</P>  <P> But I believe Larry has stated that CHECK blocks should be able to
run at the end of compilation of every individual &quot;compilation unit&quot;,
whatever that happens to be (file/BEGIN block/eval&quot;&quot;). 
</blockquote></P>  <P> As far as I'm aware, nobody is currently working on making those new
semantics reality, but I don't think it would be too difficult.
<H3><a name="C_library_functions_in_the_core">C library functions in the core</a></H3>  </P>  <P>  I compiled a list of standard C library functions that are either
reimplemented in the Perl core, or redefined to have more predictable
semantics. This helps you write more `politically correct' internals
code. For instance, instead of saying
</P>  </P><PRE> char *foo = malloc(10);
</PRE>  <P> you should really say
</P>  </P><PRE> New(0, foo, 10, char);
<a href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2001-01/msg01752.html">Read about it.</a></PRE>  <P>  <H3><a name="Perl_for_Windows_CE">Perl for Windows CE</a></H3>  </P>  <P> So they beat me to it. Perl for Windows CE is finally available, at
<a href="http://www.rainer-keuchel.de/software.html">http://www.rainer-keuchel.de/software.html</a></P>  <P> Well done, Rainer, you mad individual.
<H3><a name="Various">Various</a></H3>  </P>  <P>  Lupe Christoph came up with some patches to make Solaris's 
<CODE>malloc</CODE> the default rather than Perl's 
<CODE>malloc</CODE> on that platform; this works around a known problem with Perl's
<CODE>malloc</CODE> with more than 2G of memory.
</P>  <P> Doug MacEachern had a really neat patch which shared globs containing
XSUBs across cloned
Perl interpreters, something that could save a lot of memory for those
embedding Perl. (Especially things that clone a lot of interpreters,
like 
<CODE>mod_perl</CODE>) 
</P>  <P> And that's about it. Until next week I remain, your humble and obedient servant,
</P>  <hr>  <a href="mailto:simon@brecon.co.uk">Simon Cozens</a>   

        </div>



    </div>
    <div class="asset-footer"></div>
</div>


                            
                            <div id="entry-1448" class="entry-asset asset hentry">
    <div class="asset-header">
        <h2 class="asset-name entry-title"><a href="/pub/2001/02/inline.html" rel="bookmark">Pathologically Polluting Perl</a></h2>
        <div class="asset-meta">
            <span class="byline">
    
                By <span class="vcard author">Brian Ingerson</span> on <abbr class="published" title="2001-02-06T00:00:00-08:00">February  6, 2001 12:00 AM</abbr>
    
            </span>

            
            

        </div>
    </div>
    <div class="asset-content entry-content">

        <div class="asset-body">
            <h3>Pathologically Polluting Perl</h3>

<br />

<p><table width="180" cellspacing="0" cellpadding="4" align="right" border="1">
<tr>
<td align="center" valign="top" bgcolor="#6699cc">
<font color="#ffffff">Table of Contents</td>
</tr>

<tr>
<td>
<p class="fine">
&#149;<a href="#inline in action  simple examples in c">Inline in Action - Simple examples in C</a><br />
&#149;<a href="#hello, world">Hello, world</a><br />
&#149;<a href="#just another ____ hacker">Just Another ____ Hacker</a><br />
&#149;<a href="#what about xs and swig">What about XS and SWIG?</a><br />
&#149;<a href="#oneliners">One-Liners</a><br />
&#149;<a href="#supported platforms for c">Supported Platforms for C</a><br />
&#149;<a href="#the inline syntax">The Inline Syntax</a><br />
&#149;<a href="#fine dining  a glimpse at the c cookbook">Fine Dining - A Glimpse at the C Cookbook</a><br />
&#149;<a href="#external libraries">External Libraries</a><br />
&#149;<a href="#it takes all types">It Takes All Types</a><br />
&#149;<a href="#some ware beyond the c">Some Ware Beyond the C</a><br />
&#149;<a href="#see perl run. run perl, run!">See Perl Run. Run, Perl, Run!</a><br />
&#149;<a href="#the future of inline">The Future of Inline</a><br />
&#149;<a href="#conclusion">Conclusion</a><br />
</td>
</tr>
</p>
</table>

<p>No programming language is Perfect. Perl comes very close. <strong>P</strong>! <strong>e</strong>! <strong>r</strong>! <em>l</em>? :-( Not quite ``Perfect''. Sometimes it just makes sense to use another language for part of your work. You might have a stable, pre-existing code base to take advantage of. Perhaps maximum performance is the issue. Maybe you just ``know how to do it'' that way. Or very likely, it's a project requirement forced upon you by management. Whatever the reason, wouldn't it be great to use Perl most of the time, but be able to invoke something else when you had to?</p>

<p><code>Inline.pm</code> is a new module that glues other programming languages to Perl. It allows you to write C, C++, and Python code directly inside your Perl scripts and modules. This is conceptually similar to the way you can write inline assembly language in C programs. Thus the name: <code>Inline.pm</code>.</p>

<p>The basic philosophy behind Inline is this: ``make it as easy as possible to use Perl with other programming languages, while ensuring that the user's experience retains the DWIMity of Perl''. To accomplish this, Inline must do away with nuisances such as interface definition languages, makefiles, build directories and compiling. You simply write your code and run it. Just like Perl.</p>

<p>Inline will silently take care of all the messy implementation details and ``do the right thing''. It analyzes your code, compiles it if necessary, creates the correct Perl bindings, loads everything up, and runs the whole schmear. The net effect of this is you can now write functions, subroutines, classes, and methods in another language and call them as if they were Perl.</p>

<h3><a name="inline in action  simple examples in c">Inline in Action - Simple examples in C</a></h3>
<p>Inline addresses an old problem in a completely revolutionary way. Just describing Inline doesn't really do it justice. It should be <em>seen</em> to be fully appreciated. Here are a couple examples to give you a feel for the module.</p>
<p>
<h3><a name="hello, world">Hello, world</a></h3>
<p>It seems that the first thing any programmer wants to do when he learns a new programming technique is to use it to greet the Earth. In keeping with that tradition, here is the ``Hello, world'' program using Inline.</p>
<pre>
    use Inline C =&gt; &lt;&lt;'END_C';
    void greet() {
        printf(&quot;Hello, world\n&quot;);
    }
    END_C</pre>
<pre>
    greet;</pre>
<p>Simply run this script from the command line and it will print (you guessed it):</p>
<pre>
    Hello, world</pre>
<p>In this example, <code>Inline.pm</code> is instantiated with the name of a programming language, ``C'', and a string containing a piece of that language's source code. This C code defines a function called <code>greet()</code> which gets bound to the Perl subroutine <code>&amp;main::greet</code>. Therefore, when we call the <code>greet()</code> subroutine, the program prints our message on the screen.</p>
<p>You may be wondering why there are no <code>#include</code> statements for things like <code>stdio.h</code>? That's because Inline::C automatically prepends the following lines to the top of your code:</p>
<pre>
    #include &quot;EXTERN.h&quot;
    #include &quot;perl.h&quot;
    #include &quot;XSUB.h&quot;
    #include &quot;INLINE.h&quot;</pre>
<p>These header files include all of the standard system header files, so you almost never need to use <code>#include</code> unless you are dealing with a non-standard library. This is in keeping with Inline's philosophy of making easy things easy. (Where have I heard that before?)</p>
<p>
<h3><a name="just another ____ hacker">Just Another ____ Hacker</a></h3>
<p>The next logical question is, ``How do I pass data back and forth between Perl and C?'' In this example we'll pass a string to a C function and have it pass back a brand new Perl scalar.</p>
<pre>
    use Inline C;
    print JAxH('Perl');
</pre>
<pre>

    __END__
    __C__
    SV* JAxH(char* x) {
        return newSVpvf(&quot;Just Another %s Hacker\n&quot;, x);
    }</pre>
<p>When you run this program, it prints:</p>
<pre>
    Just Another Perl Hacker</pre>
<p>You've probably noticed that this example is coded differently then the last one. The <code>use Inline</code> statement specifies the language being used, but not the source code. This is an indicator for Inline to look for the source at the end of the program, after the special marker '<code>__C__</code>'.</p>
<p>The concept being demonstrated is that we can pass Perl data in and out of a C function. Using the default Perl type conversions, Inline can easily convert all of the basic Perl data types to C and vice-versa.</p>
<p>This example uses a couple of the more advanced concepts of Inlining. Its return value is of the type <code>SV*</code> (or Scalar Value). The Scalar Value is the most common Perl internal type. Also, the Perl internal function <code>newSVpfv()</code> is called to create a new Scalar Value from a string, using the familiar <code>sprintf()</code> syntax. You can learn more about simple Perl internals by reading the <code>perlguts</code> and <code>perlapi</code> documentation distributed with Perl.</p>

<h3><a name="what about xs and swig">What about XS and SWIG?</a></h3>
<p>Let's detour momentarily to ponder ``Why Inline?''</p>
<p>There are already two major facilities for extending Perl with C. They are XS and SWIG. Both are similar in their capabilities, at least as far as Perl is concerned. And both of them are quite difficult to learn compared to Inline. Since SWIG isn't used in practice to nearly the degree that XS is, I'll only address XS.</p>
<p>There is a big fat learning curve involved with setting up and using the XS environment. You need to get quite intimate with the following docs:</p>
<pre>
 * perlxs
 * perlxstut
 * perlapi
 * perlguts
 * perlcall
 * perlmod
 * h2xs
 * xsubpp
 * ExtUtils::MakeMaker</pre>
<p>With Inline you can be up and running in minutes. There is a C Cookbook with lots of short but complete programs that you can extend to your real-life problems. No need to learn about the complicated build process going on in the background. You don't even need to compile the code yourself. Perl programmers cannot be bothered with silly things like compiling. ``Tweak, Run, Tweak, Run'' is our way of life. Inline takes care of every last detail except writing the C code.</p>
<p>Another advantage of Inline is that you can use it directly in a script. As we'll soon see, you can even use it in a Perl one-liner. With XS and SWIG, you always set up an entirely separate module, even if you only have one or two functions. Inline makes easy things easy, and hard things possible. Just like Perl.</p>
<p>Finally, Inline supports several programming languages (not just C and C++). As of this writing, Inline has support for C, C++, Python, and CPR. There are plans to add many more.</p>

<h3><a name="oneliners">One-Liners</a></h3>
<p>Perl is famous for its one-liners. A Perl one-liner is short piece of Perl code that can accomplish a task that would take much longer in another language. It is one of the popular techniques that Perl hackers use to flex their programming muscles.</p>
<p>So you may wonder: ``Is Inline powerful enough to produce a one-liner that is also bonifide C extension?'' Of course it is! Here you go:</p>
<pre>
    perl -e 'use Inline C=&gt;
	q{void J(){printf(&quot;Just Another Perl Hacker\n&quot;);}};J'</pre>
<p>Try doing that with XS! We can even write the more complex Inline <code>JAxH()</code> discussed earlier as a one-liner:</p>
<pre>
    perl -le 'use Inline C=&gt;
	q{SV*JAxH(char*x){return newSVpvf(&quot;Just Another %s Hacker&quot;,x);}};print JAxH+Perl'</pre>
<p>I have been using this one-liner as my email signature for the past couple months. I thought it was pretty cool until Bernhard Muenzer posted this gem to <code>comp.lang.perl.modules</code>:</p>
<pre>
    #!/usr/bin/perl -- -* Nie wieder Nachtschicht! *- -- lrep\nib\rsu\!#
    use Inline C=&gt;'void C(){int m,u,e=0;float l,_,I;for(;1840-e;putchar((++e&gt;907
     &amp;&amp;942&gt;e?61-m:u)[&quot;\n)moc.isc@rezneumb(rezneuM drahnreB&quot;]))for(u=_=l=0;79-(m
      =e%80)&amp;&amp;I*l+_*_&lt;6&amp;&amp;26-++u;_=2*l*_+e/80*.09-1,l=I)I=l*l-_*_-2+m/27.;}';&amp;C</pre>

<h3><a name="supported platforms for c">Supported Platforms for C</a></h3>
<p>Inline C works on all of the Perl platforms that I have tested it with so far. This includes all common Unixes and recent versions of Microsoft Windows. The only catch is that you must have the same compiler and <code>make</code> utility that was used to build your <code>perl</code> binary.</p>
<p>Inline has been successfully used on Linux, Solaris, AIX, HPUX, and all the recent BSD's.</p>
<p>There are two common ways to use Inline on MS Windows. The first one is with ActiveState's ActivePerl for MSWin32. In order to use Inline in that environment, you'll need a copy of MS Visual C++ 6.0. This comes with the <code>cl.exe</code> compiler and the <code>nmake</code> make utility. Actually these are the only parts you need. The visual components aren't necessary for Inline.</p>
<p>The other alternative is to use the Cygwin utilities. This is an actual Unix porting layer for Windows. It includes all of the most common Unix utilities, such as <code>bash</code>, <code>less</code>, <code>make</code>, <code>gcc</code> and of course <code>perl</code>.</p>

<h3><a name="the inline syntax">The Inline Syntax</a></h3>
<p>Inline is a little bit different than most of the Perl modules that you are used to. It doesn't import any functions into your namespace and it doesn't have any object oriented methods. Its entire interface is specified through <code>'use Inline ...'</code> commands. The general Inline usage is:</p>
<pre>
    use Inline C =&gt; source-code,
               config_option =&gt; value,
               config_option =&gt; value;</pre>
<p>Where <code>C</code> is the programming language, and <code>source-code</code> is a string, filename, or the keyword '<code>DATA</code>'. You can follow that with any number of optional '<code>keyword =&gt; value</code>' configuration pairs. If you are using the 'DATA' option, with no configuration parameters, you can just say:</p>
<pre>
    use Inline C;</pre>

<h3><a name="fine dining  a glimpse at the c cookbook">Fine Dining - A Glimpse at the C Cookbook</a></h3>
<p>In the spirit of the O'Reilly book ``Perl Cookbook'', Inline provides a manpage called C-Cookbook. In it you will find the recipes you need to help satisfy your Inline cravings. Here are a couple of tasty morsels that you can whip up in no time. Bon Appetit!</p>
<p>
<h3><a name="external libraries">External Libraries</a></h3>
<p>The most common real world need for Inline is probably using it to access existing compiled C code from Perl. This is easy to do. The secret is to write a wrapper function for each function you want to expose in Perl space. The wrapper calls the real function. It also handles how the arguments get passed in and out. Here is a short Windows example that displays a text box with a message, a caption and an ``OK'' button:</p>
<pre>
    use Inline C =&gt; DATA =&gt;
               LIBS =&gt; '-luser32',
               PREFIX =&gt; 'my_';</pre>
<pre>
    MessageBoxA('Inline Message Box', 'Just Another Perl Hacker');
</pre>
<pre>

    __END__
    __C__
    #include &lt;windows.h&gt;
    int my_MessageBoxA(char* Caption, char* Text) {
      return MessageBoxA(0, Text, Caption, 0);
    }</pre>
<p>This program calls a function from the MSWin32 <code>user32.dll</code> library. The wrapper determines the type and order of arguments to be passed from Perl. Even though the real <code>MessageBoxA()</code> needs four arguments, we can expose it to Perl with only two, and we can change the order. In order to avoid namespace conflicts in C, the wrapper must have a different name. But by using the <code>PREFIX</code> option (same as the XS <code>PREFIX</code> option) we can bind it to the original name in Perl.</p>

<h3><a name="it takes all types">It Takes All Types</a></h3>
<p>Older versions of Inline only supported five C data types. These were: <code>int</code>, <code>long</code>, <code>double</code>, <code>char*</code> and <code>SV*</code>. This was all you needed. All the basic Perl scalar types are represented by these. Fancier things like references could be handled by using the generic <code>SV*</code> (scalar value) type, and then doing the mapping code yourself, inside the C function.</p>
<p>The process of converting between Perl's <code>SV*</code> and C types is called <strong>typemapping</strong>. In XS, you normally do this by using <code>typemap</code> files. A default <code>typemap</code> file exists in every Perl installation in a file called <code>/usr/lib/perl5/5.6.0/ExtUtils/typemap</code> or something similar. This file contains conversion code for over 20 different C types, including all of the Inline defaults.</p>
<p>As of version 0.30, Inline no longer has <em>any</em> built in types. It gets all of its types exclusively from <code>typemap</code> files. Since it uses Perl's default <code>typemap</code> file for its own defaults, it actually has many more types available automatically.</p>
<p>This setup provides a lot of flexibility. You can specify your own <code>typemap</code> files through the use of the <code>TYPEMAPS</code> configuration option. This not only allows you to override the defaults with your own conversion code, but it also means that you can add new types to Inline as well. The major advantage to extending the Inline syntax this way is that there are already many typemaps available for various APIs. And if you've done your own XS coding in the past, you can use your existing <code>typemap</code> files as is. No changes are required.</p>
<p>Let's look at a small example of writing your own typemaps. For some reason, the C type <code>float</code> is not represented in the default Perl <code>typemap</code> file. I suppose it's because Perl's floating point numbers are always stored as type <code>double</code>, which is higher precision than <code>float</code>. But if we wanted it anyway, writing a <code>typemap</code> file to support <code>float</code> is trivial.</p>
<p>Here is what the file would look like:</p>
<pre>
    float                   T_FLOAT
</pre>
<pre>

    INPUT
    T_FLOAT
            $var = (float)SvNV($arg)</pre>
<pre>

    OUTPUT
    T_FLOAT
            sv_setnv($arg, (double)$var);</pre>
<p>Without going into details, this file provides two snippets of code. One for converting a <code>SV*</code> to a float, and one for the opposite. Now we can write the following script:</p>
<pre>
    use Inline C =&gt; DATA =&gt;
               TYPEMAPS =&gt; './typemap';
</pre>
<pre>

    print '1.2 + 3.4 = ', fadd(1.2, 3.4), &quot;\n&quot;;</pre>
<pre>

    __END__
    __C__
    float fadd(float x, float y) {
        return x + y;
    }</pre>

<h3><a name="some ware beyond the c">Some Ware Beyond the C</a></h3>
<p>The primary goal of Inline is to make it easy to use other programming languages with Perl. This is not limited to C. The initial implementations of Inline only supported C, and the language support was built directly into <code>Inline.pm</code>. Since then things have changed considerably. Inline now supports multiple languages of both compiled and interpreted nature. And it keeps the implementations in an object oriented type structure, whereby each language has its own separate module, but they can inherit behavior from the base Inline module.</p>
<p>On my second day working at ActiveState, a young man approached me. ``Hi, my name is Neil Watkiss. I just hacked your Inline module to work with C++.''</p>
<p>Neil, I soon found out, was a computer science student at a local university. He was working part-time for ActiveState then, and had somehow stumbled across Inline. I was thrilled! I had wanted to pursue new languages, but didn't know how I'd find the time. Now I was sitting 15 feet away from my answer!</p>
<p>Over the next couple months, Neil and I spent our spare time turning Inline into a generic environment for gluing new languages to Perl. I ripped all the C specific code out of Inline and put it into Inline::C. Neil started putting together Inline::CPP and Inline::Python. Together we came up with a new syntax that allowed multiple languages and easier configuration.</p>
<p>Here is a sample program that makes uses of Inline Python:</p>
<pre>
    use Inline Python;
    my $language = shift;
    print $language, 
          (match($language, 'Perl') ? ' rules' : ' sucks'),
          &quot;!\n&quot;;
    __END__
    __Python__
    import sys
    import re
    def match(str, regex):
        f = re.compile(regex);
        if f.match(str): return 1
        return 0</pre>
<p>This program uses a Python regex to show that ``Perl rules!''.</p>
<p>Since Python supports its own versions of Perl scalars, arrays, and hashes, Inline::Python can flip-flop between them easily and logically. If you pass a hash reference to python, it will turn it into a dictionary, and vice-versa. Neil even has mechanisms for calling back to Perl from Python code. See the Inline::Python docs for more info.</p>

<h3><a name="see perl run. run perl, run!">See Perl Run. Run Perl, Run!</a></h3>
<p>Inline is a great way to write C extensions for Perl. But is there an equally simple way to embed a Perl interpreter in a C program? I pondered this question myself one day. Writing Inline functionality for C would not be my cup of tea.</p>
<p>The normal way to embed Perl into C involves jumping through a lot of hoops to bootstrap a perl interpreter. Too messy for one-liners. And you need to compile the C. Not very Inlinish. But what if you could pass your C program to a perl program that could pass it to Inline? Then you could write this program:</p>
<pre>
    #!/usr/bin/cpr
    int main(void) {
        printf(&quot;Hello, world\n&quot;);
    }</pre>
<p>and just run it from the command line. Interpreted C!</p>
<p>And thus, a new programming language was born. <strong>CPR</strong>. ``C Perl Run''. The Perl module that gives it life is called <code>Inline::CPR</code>.</p>
<p>Of course, CPR is not really its own language, in the strict sense. But you can think of it that way. CPR is just like C except that you can call out to the Perl5 API at any time, without any extra code. In fact, CPR redefines this API with its own CPR wrapper API.</p>
<p>There are several ways to think of CPR: ``a new language'', ``an easy way to embed Perl in C'', or just ``a cute hack''. I lean towards the latter. CPR is probably a far stretch from meeting most peoples embedding needs. But at the same time its a very easy way to play around with, and perhaps redefine, the Perl5 internal API. The best compliment I've gotten for CPR is when my ActiveState coworker Adam Turoff said, ``I feel like my head has just been wrapped around a brick''. I hope this next example makes you feel that way too:</p>
<pre>
    #!/usr/bin/cpr
    int main(void) {
        CPR_eval(&quot;use Inline (C =&gt; q{
            char* greet() {
                return \&quot;Hello world\&quot;;
            }
        })&quot;);</pre>
<pre>
        printf(&quot;%s, I'm running under Perl version %s\n&quot;,
               CPR_eval(&quot;&amp;greet&quot;),
               CPR_eval(&quot;use Config; $Config{version}&quot;));
        return 0;
    }</pre>
<p>Running this program prints:</p>
<pre>
    Hello world, I'm running under Perl version 5.6.0</pre>
<p>Using the <code>eval()</code> call this CPR program calls Perl and tells it to use Inline C to add a new function, which the CPR program subsequently calls. I think I have a headache myself.</p>

<h3><a name="the future of inline">The Future of Inline</a></h3>
<p>Inline version 0.30 was written specifically so that it would be easy for other people in the Perl community to contribute new language bindings for Perl. On the day of that release, I announced the birth of the Inline mailing list, <a href="mailto:inline@perl.org.">inline@perl.org.</a> This is intended to be the primary forum for discussion on all Inline issues, including the proposal of new features, and the authoring of new ILSMs.</p>
<p>In the year 2001, I would like to see bindings for Java, Ruby, Fortran and Bash. I don't plan on authoring all of these myself. But I may kickstart some of them, and see if anyone's interested in taking over. If <em>you</em> have a desire to get involved with Inline development, please join the mailing list (<a href="mailto:inline-subscribe@perl.org">inline-subscribe@perl.org</a>) and speak up.</p>
<p>My primary focus at the present time, is to make the base Inline module as simple, flexible, and stable as possible. Also I want to see Inline::C become an acceptable replacement for XS; at least for most situations.</p>

<h3><a name="conclusion">Conclusion</a></h3>
<p>Using XS is just too hard. At least when you compare it to the rest of the Perl we know and love. Inline takes advantage of the existing frameworks for combining Perl and C, and packages it all up into one easy to swallow pill. As an added bonus, it provides a great framework for binding other programming languages to Perl. You might say, ``It's a 'Perl-fect' solution!''</p>



        </div>



    </div>
    <div class="asset-footer"></div>
</div>




                            <div class="content-nav">
                                <a href="/pub/2001/01/">&laquo; January 2001</a> |
                                <a href="/pub/">Main Index</a> |
                                <a href="/pub/archives.html">Archives</a>
                                | <a href="/pub/2001/03/">March 2001 &raquo;</a>
                            </div>


                        </div>
                    </div>


                    <div id="beta">
    <div id="beta-inner">


    
    <div class="widget-what-is-perl widget">
    <div class="widget-content widget-content-what-is-perl">
       Visit the home of the  Perl programming language: <a href="http://www.perl.org/">Perl.org</a
    </div>
</div>
<div class="widget-find-out-more widget-archives widget">
    <div class="widget-content">
        <ul>
            <li><a href="http://www.perl.org/get.html">Download</a></li>
            <li><a href="http://perldoc.perl.org/">Documentation</a></li>
            <li><a href="http://blogs.perl.org/">Perl Bloggers</a></li>
            <li><a href="http://news.perlfoundation.org/">Foundation News</a></li>
        </ul>
    </div>
</div><div class="widget-tcpc widget">
<h3 class="widget-header">Sponsored by</h3>
    <div class="widget-content">
        <a href="http://training.perl.com/" alt="Perl Training" target="_blank"><img src="/i/tcpc.png" width="150" height="50"></a>
    </div>
</div>

<div class="widget-syndication widget">
    <div class="widget-content">
        <ul>
            <li><img src="/mt-static/images/status_icons/feed.gif" alt="Subscribe to feed" width="9" height="9" /> <a href="/pub/atom.xml">Subscribe to this website's feed</a></li>

        </ul>
    </div>
</div>
<div class="widget-archive-monthly widget-archive widget">
    <h3 class="widget-header">Monthly <a href="/pub/archives.html">Archives</a></h3>
    <div class="widget-content">
        <ul>
        
            <li><a href="/pub/2014/02/">February 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2014/01/">January 2014 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/10/">October 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2013/01/">January 2013 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/12/">December 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/11/">November 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2012/10/">October 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/08/">August 2012 (2)</a></li>
        
    
        
            <li><a href="/pub/2012/06/">June 2012 (11)</a></li>
        
    
        
            <li><a href="/pub/2012/05/">May 2012 (18)</a></li>
        
    
        
            <li><a href="/pub/2012/04/">April 2012 (17)</a></li>
        
    
        
            <li><a href="/pub/2012/02/">February 2012 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/12/">December 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/09/">September 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/08/">August 2011 (2)</a></li>
        
    
        
            <li><a href="/pub/2011/06/">June 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/05/">May 2011 (3)</a></li>
        
    
        
            <li><a href="/pub/2011/04/">April 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/03/">March 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/02/">February 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2011/01/">January 2011 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/11/">November 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/10/">October 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/09/">September 2010 (1)</a></li>
        
    
        
            <li><a href="/pub/2010/08/">August 2010 (3)</a></li>
        
    
        
            <li><a href="/pub/2010/07/">July 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/04/">April 2010 (2)</a></li>
        
    
        
            <li><a href="/pub/2010/03/">March 2010 (4)</a></li>
        
    
        
            <li><a href="/pub/2008/05/">May 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/04/">April 2008 (2)</a></li>
        
    
        
            <li><a href="/pub/2008/03/">March 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/02/">February 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2008/01/">January 2008 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/12/">December 2007 (2)</a></li>
        
    
        
            <li><a href="/pub/2007/09/">September 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/08/">August 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/07/">July 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/06/">June 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/05/">May 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/04/">April 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/03/">March 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/02/">February 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2007/01/">January 2007 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/12/">December 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/11/">November 2006 (2)</a></li>
        
    
        
            <li><a href="/pub/2006/10/">October 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/09/">September 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/08/">August 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/07/">July 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/06/">June 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/05/">May 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/04/">April 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/03/">March 2006 (1)</a></li>
        
    
        
            <li><a href="/pub/2006/02/">February 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2006/01/">January 2006 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/12/">December 2005 (4)</a></li>
        
    
        
            <li><a href="/pub/2005/11/">November 2005 (3)</a></li>
        
    
        
            <li><a href="/pub/2005/10/">October 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/09/">September 2005 (2)</a></li>
        
    
        
            <li><a href="/pub/2005/08/">August 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/07/">July 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/06/">June 2005 (9)</a></li>
        
    
        
            <li><a href="/pub/2005/05/">May 2005 (8)</a></li>
        
    
        
            <li><a href="/pub/2005/04/">April 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/03/">March 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2005/02/">February 2005 (7)</a></li>
        
    
        
            <li><a href="/pub/2005/01/">January 2005 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/12/">December 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/11/">November 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/10/">October 2004 (5)</a></li>
        
    
        
            <li><a href="/pub/2004/09/">September 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/08/">August 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/07/">July 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/06/">June 2004 (6)</a></li>
        
    
        
            <li><a href="/pub/2004/05/">May 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2004/04/">April 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/03/">March 2004 (8)</a></li>
        
    
        
            <li><a href="/pub/2004/02/">February 2004 (9)</a></li>
        
    
        
            <li><a href="/pub/2004/01/">January 2004 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/12/">December 2003 (4)</a></li>
        
    
        
            <li><a href="/pub/2003/11/">November 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/10/">October 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/09/">September 2003 (6)</a></li>
        
    
        
            <li><a href="/pub/2003/08/">August 2003 (7)</a></li>
        
    
        
            <li><a href="/pub/2003/07/">July 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/06/">June 2003 (9)</a></li>
        
    
        
            <li><a href="/pub/2003/05/">May 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/04/">April 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/03/">March 2003 (10)</a></li>
        
    
        
            <li><a href="/pub/2003/02/">February 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2003/01/">January 2003 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/12/">December 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/11/">November 2002 (9)</a></li>
        
    
        
            <li><a href="/pub/2002/10/">October 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/09/">September 2002 (11)</a></li>
        
    
        
            <li><a href="/pub/2002/08/">August 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/07/">July 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2002/06/">June 2002 (4)</a></li>
        
    
        
            <li><a href="/pub/2002/05/">May 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/04/">April 2002 (6)</a></li>
        
    
        
            <li><a href="/pub/2002/03/">March 2002 (7)</a></li>
        
    
        
            <li><a href="/pub/2002/02/">February 2002 (5)</a></li>
        
    
        
            <li><a href="/pub/2002/01/">January 2002 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/12/">December 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/11/">November 2001 (5)</a></li>
        
    
        
            <li><a href="/pub/2001/10/">October 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/09/">September 2001 (7)</a></li>
        
    
        
            <li><a href="/pub/2001/08/">August 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/07/">July 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/06/">June 2001 (13)</a></li>
        
    
        
            <li><a href="/pub/2001/05/">May 2001 (11)</a></li>
        
    
        
            <li><a href="/pub/2001/04/">April 2001 (9)</a></li>
        
    
        
            <li><a href="/pub/2001/03/">March 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/02/">February 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2001/01/">January 2001 (8)</a></li>
        
    
        
            <li><a href="/pub/2000/12/">December 2000 (6)</a></li>
        
    
        
            <li><a href="/pub/2000/11/">November 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/10/">October 2000 (10)</a></li>
        
    
        
            <li><a href="/pub/2000/09/">September 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/08/">August 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/07/">July 2000 (5)</a></li>
        
    
        
            <li><a href="/pub/2000/06/">June 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/05/">May 2000 (7)</a></li>
        
    
        
            <li><a href="/pub/2000/04/">April 2000 (3)</a></li>
        
    
        
            <li><a href="/pub/2000/03/">March 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/02/">February 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/2000/01/">January 2000 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/12/">December 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/11/">November 1999 (6)</a></li>
        
    
        
            <li><a href="/pub/1999/10/">October 1999 (5)</a></li>
        
    
        
            <li><a href="/pub/1999/09/">September 1999 (4)</a></li>
        
    
        
            <li><a href="/pub/1999/08/">August 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/07/">July 1999 (2)</a></li>
        
    
        
            <li><a href="/pub/1999/06/">June 1999 (3)</a></li>
        
    
        
            <li><a href="/pub/1999/04/">April 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/03/">March 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1999/01/">January 1999 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/12/">December 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/11/">November 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/07/">July 1998 (2)</a></li>
        
    
        
            <li><a href="/pub/1998/06/">June 1998 (1)</a></li>
        
    
        
            <li><a href="/pub/1998/03/">March 1998 (1)</a></li>
        
        </ul>
    </div>
</div>
        
    

<div class="widget-powered widget">
    <div class="widget-content">
        <a href="http://www.movabletype.com/"><img src="/mt-static/images/bug-pbmt-white.png" alt="Powered by Movable Type 5.13-en" width="120" height="75" /></a>
    </div>
</div>



    </div>
</div>






                </div>
            </div>


            <div id="footer">
    <div id="footer-inner">
        <div id="footer-content">
            <div class="widget-powered widget">
                <div class="widget-content">
                    Powered by <a href="http://www.movabletype.com/" rel="generator">Movable Type Pro</a>
                </div>
            </div>

            <div class="widget-creative-commons widget">
                <div class="widget-content">
                    This blog is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons License</a>.
                </div>
            </div>

        </div>
    </div>
</div>



        </div>
    </div>
</body>
</html>
