<!DOCTYPE html>
<html lang="en-us">
  <head>
  <title> Time::Moment can save time </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A useful alternative to DateTime"/>
  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="TZowffo_LX2mmsw2DbeNNbukCMnIOA8T-6CMJPiYllI" />

<meta property="twitter:card" content="summary">
<meta property="twitter:site" content="@PerlFoundation">
<meta property="og:url" content="http://localhost:1313/article/148/2015/2/2/Time--Moment-can-save-time/" />
<meta property="og:title" content="Time::Moment can save time" />
<meta property="og:description" content="A useful alternative to DateTime">
<meta property="og:site_name" content="Perl.com" />

<meta property="og:type" content="article" />
<meta property="og:article:published_time" content="2015-02-02T02:02:02Z" />
<meta property="og:image" content="http://localhost:1313/images/148/thumb_050708F8-AAE4-11E4-AC4E-C3E39EE10EC8.png" />
<meta property="og:article:tag" content="time" />
<meta property="og:article:tag" content="datetime" />
<meta property="og:article:tag" content="8601" />
<meta property="og:article:tag" content="moment" />


  <link rel="icon" href="/favicon.ico">
  <link href="/article/index.xml" rel="alternate" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/article/index.xml" rel="feed" type="application/rss+xml" title="Perl.com - programming news, code and culture" />
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/css/perldotcom.css"/>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-50555-22', 'auto');
ga('create', 'UA-85734801-2', 'auto', 'editor');
ga('send', 'pageview');
ga('editor.send', 'pageview');
</script>

</head>
<body>

<div class="container-fluid full-wdith antonio">
 <div class="row">
  <div class="navbar-inverse" style="border-radius:none !important" role="navigation">
    <div class="container-fluid">
      <ul class="nav navbar-nav pull-right follow">
          <li>MORE:</li>
          <li><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a><li>
          <li><a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a><li>
          <li><a href="/article/index.xml" />
              <img src="/images/site/rss_20.png" alt="rss"></a></li>
          <li><a href="https://github.com/tpf/perldotcom" />
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></li>
      </ul>
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          <a class="navbar-nav" href="/">
            <div class="header-logo">Perl.com</div>
          </a>
      </div>
      <div class="navbar-collapse collapse">
        <ul class="nav navbar-nav">
          <li><a href="/about">
              <div class="circle">
                <img src="/images/site/perl-camel.png" alt="" />
              </div>
                  &nbsp;&nbsp;ABOUT</a>
          </li>
          <li><a href="/authors">
              <div class="circle">
                  <span class="glyphicon glyphicon-user txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;AUTHORS</a>
          </li>
          <li><a href="/categories">
              <div class="circle">
                  <span class="glyphicon glyphicon-folder-open txt-blue-major" aria-hidden="true"></span>
              </div>
                  &nbsp;&nbsp;CATEGORIES</a>
          </li>
          <li><a href="/tags">
              <div class="circle">
                <span class="txt-blue-major" aria-hidden="true"><strong>#</strong></span>
              </div>
                  &nbsp;&nbsp;TAGS</a>
          </li>
          <li>
            <form class="search" name="ddg" action="https://duckduckgo.com/" method="get">
              <input type="text" name ="q" placeholder="SEARCH" />
              <input type="hidden" value="perl.com" name="sites" />
            </form>
          </li>
        </ul>
      </div>
    </div>
  </div>
 </div>
</div>


  <section id="content" role="main">
    <section class="entry-content">
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <article class="fulltext">
              <h1 class="blog-post-title">Time::Moment can save time</h1>
              <p class="blog-post-meta">Feb 2, 2015 by
              
              
                
                
                <a href="#author-bio-brian-d-foy">brian d foy</a>
              
              </p>
              <img alt="" src="/images/148/050708F8-AAE4-11E4-AC4E-C3E39EE10EC8.png"/>
                <p>A long time ago in a galaxy far, far away, the rebel alliance ran into a slight problem when the starship carrying the princess left two hours late because its software was in the wrong time zone, running into an imperial cruiser that was patrolling an hour early for a similar reason. The bad guys unwittingly solved the rebels&rsquo; problem by removing the wrong time zone when they removed that special case—a solution familiar to programmers. The rebels exploited an imperial bug when a literal hole in their defense was left open an hour late.</p>

<p>You might think that we are in the computer revolution (<a href="https://www.youtube.com/watch?v=oKg1hTOQXoY">Alan Kay says we aren&rsquo;t</a>), but for all of our fancy hardware, the cheap or free platforms and services, and the amazing programming tools we have, the way we handle and times is often a mess. Y2K has nothing on this.</p>

<p>When Dave Rolsky came out with <a href="https://metacpan.org/pod/DateTime">DateTime</a>, everyone rejoiced. It&rsquo;s a masterful piece of software that strives to be pedantically correct down to the nanosecond and leap seconds. Before then, I used a hodge-podge of modules to deal with dates and avoided date math.</p>

<p><a href="https://metacpan.org/pod/DateTime">DateTime</a> can represent dates and tell me various things about them, such as the day of the quarter, give me locale-specific names, format them in interesting ways, and also give me the difference between dates:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Date::Time;

<span style="color:#66d9ef">my</span> $dt <span style="color:#f92672">=</span> DateTime<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">new</span>(
    year       <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">2014</span>,
    month      <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">12</span>,
    day        <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">18</span>,
    hour       <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">12</span>,
    minute     <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">37</span>,
    second     <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">57</span>,
    nanosecond <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">0</span>,
    time_zone  <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;UTC&#39;</span>,
);

<span style="color:#66d9ef">my</span> $quarter <span style="color:#f92672">=</span> $dt<span style="color:#f92672">-&gt;</span>quarter;
<span style="color:#66d9ef">my</span> $day_of_quarter <span style="color:#f92672">=</span> $dt<span style="color:#f92672">-&gt;</span>day_of_quarter;

<span style="color:#66d9ef">my</span> $month_name <span style="color:#f92672">=</span> $dt<span style="color:#f92672">-&gt;</span>month_name;  <span style="color:#75715e"># can be locale specific</span>

<span style="color:#66d9ef">my</span> $ymd <span style="color:#f92672">=</span> $dt<span style="color:#f92672">-&gt;</span>ymd(<span style="color:#e6db74">&#39;/&#39;</span>); <span style="color:#75715e"># 2015/02/06</span>

<span style="color:#66d9ef">my</span> $now <span style="color:#f92672">=</span> DateTime<span style="color:#f92672">-&gt;</span>now;

<span style="color:#66d9ef">my</span> $duration <span style="color:#f92672">=</span> $now <span style="color:#f92672">-</span> $dt;</code></pre></div>
<p><a href="https://metacpan.org/pod/DateTime">DateTime</a> doesn&rsquo;t parse dates. Separate modules in the same namespace can do that while returning a <a href="https://metacpan.org/pod/DateTime">DateTime</a> object. For instance, the <a href="https://metacpan.org/pod/DateTime::Format::W3CDTF">DateTime::Format::W3CDTF</a> module parses dates and turn them into objects:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> DateTime::Format::W3CDTF;

<span style="color:#66d9ef">my</span> $w3c <span style="color:#f92672">=</span> DateTime::Format::W3CDTF<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">new</span>;
<span style="color:#66d9ef">my</span> $dt <span style="color:#f92672">=</span> $w3c<span style="color:#f92672">-&gt;</span>parse_datetime( <span style="color:#e6db74">&#39;2003-02-15T13:50:05-05:00&#39;</span> );

<span style="color:#75715e"># 2003-02-15T13:50:05-05:00</span>
$w3c<span style="color:#f92672">-&gt;</span>format_datetime($dt);</code></pre></div>
<p>Brilliant. <a href="https://metacpan.org/pod/DateTime">DateTime</a> is the standard answer to any date question. It works with almost no thought on my side.</p>

<p>But <a href="https://metacpan.org/pod/DateTime">DateTime</a> has a problem. It creates big objects and in the excitement to use something that works (slow and correct is better than fast and wrong), I might end up with hundreds of those objects, not leaving much space for other things. Try dumping one of these objects to see its extent. I won&rsquo;t waste space with that in this article.</p>

<p>Although <a href="https://metacpan.org/pod/DateTime">DateTime</a> is exactingly correct, sometimes I&rsquo;d like to be a little less exact and quite a bit faster. That&rsquo;s where Christian Hansen&rsquo;s <a href="https://metacpan.org/pod/Time::Moment">Time::Moment</a> comes in (see his <a href="http://blogs.perl.org/users/chansen/2014/08/timemoment-vs-datetime.html">Time::Moment vs DateTime</a>). It works in UTC, ignores leap seconds, and limits its dates to the years 1 to 9999. It&rsquo;s objects are immutable, so it can be a bit faster. To get a new datetime, you get a new object. And, it has many of the common features and an interface close to <a href="https://metacpan.org/pod/DateTime">DateTime</a>.</p>

<p>The <a href="https://metacpan.org/pod/Time::Moment">Time::Moment</a> distribution comes with a program, <em>dev/bench.pl</em>, that allows me to compare the performance. Here&rsquo;s some of the output:</p>

<pre><code>$ perl dev/bench.pl
Benchmarking constructor: -&gt;new()
                  Rate     DateTime Time::Moment
DateTime       14436/s           --         -99%
Time::Moment 1064751/s        7276%           --
</code></pre>

<p>Let&rsquo;s make a more interesting benchmark that constructs an object from a string, add a day to it, and check if it&rsquo;s before today. As with every benchmark, you have to check it against your particular use:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl"><span style="color:#66d9ef">use</span> Benchmark;
<span style="color:#66d9ef">use</span> DateTime;
<span style="color:#66d9ef">use</span> Time::Moment;
<span style="color:#66d9ef">use</span> DateTime::Format::W3CDTF;

<span style="color:#66d9ef">my</span> $dtf_string <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;2014-02-01T13:01:37-05:00&#39;</span>;

<span style="color:#66d9ef">my</span> $time_moment <span style="color:#f92672">=</span> <span style="color:#66d9ef">sub</span> {
    <span style="color:#66d9ef">my</span> $tm <span style="color:#f92672">=</span> Time::Moment<span style="color:#f92672">-&gt;</span>from_string( $dtf_string );
    <span style="color:#66d9ef">my</span> $tm2 <span style="color:#f92672">=</span> $tm<span style="color:#f92672">-&gt;</span>plus_days( <span style="color:#ae81ff">1</span> );

    <span style="color:#66d9ef">my</span> $now <span style="color:#f92672">=</span> Time::Moment<span style="color:#f92672">-&gt;</span>now;

    <span style="color:#66d9ef">my</span> $comparison <span style="color:#f92672">=</span> $now <span style="color:#f92672">&gt;</span> $tm2;
    };

<span style="color:#66d9ef">my</span> $datetime <span style="color:#f92672">=</span> <span style="color:#66d9ef">sub</span> {
    <span style="color:#66d9ef">my</span> $w3c <span style="color:#f92672">=</span> DateTime::Format::W3CDTF<span style="color:#f92672">-&gt;</span><span style="color:#66d9ef">new</span>;
    <span style="color:#66d9ef">my</span> $dt <span style="color:#f92672">=</span> $w3c<span style="color:#f92672">-&gt;</span>parse_datetime( $dtf_string );
    $dt<span style="color:#f92672">-&gt;</span>add( days <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1</span> );

    <span style="color:#66d9ef">my</span> $now <span style="color:#f92672">=</span> DateTime<span style="color:#f92672">-&gt;</span>now;

    <span style="color:#66d9ef">my</span> $comparison <span style="color:#f92672">=</span> $now <span style="color:#f92672">&gt;</span> $dt;
    };

Benchmark::cmpthese( <span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, {
    <span style="color:#e6db74">&#39;Time::Moment&#39;</span> <span style="color:#f92672">=&gt;</span> $time_moment,
    <span style="color:#e6db74">&#39;DateTime&#39;</span>     <span style="color:#f92672">=&gt;</span> $datetime,
    });</code></pre></div>
<p><a href="https://metacpan.org/pod/Time::Moment">Time::Moment</a> is still really fast. Amazingly fast:</p>

<pre><code>$ perl dtf_bench.pl
                 Rate     DateTime Time::Moment
DateTime       1889/s           --         -99%
Time::Moment 273557/s       14384%           --
</code></pre>

<p>If my problem is within the limits of <a href="https://metacpan.org/pod/Time::Moment">Time::Moment</a> (and, who ever needs more than 640k?), I can get big wins. When that no longer applies, with a little work I can switch to <a href="https://metacpan.org/pod/DateTime">DateTime</a>. Either way, you might want to wipe the memory of your droids.</p>

<p><em>Cover image <a href="https://creativecommons.org/licenses/by-nc/2.5/">©</a> <a href="http://xkcd.com/1179/">XKCD</a></em></p>

<p><br />
<em>This article was originally posted on <a href="http://perltricks.com">PerlTricks.com</a>.</em></p>

              </article>
              <p><strong>Tags</strong></p>
              <div class="tags">
                <div class="category"><a href="/categories/data">data</a></div>
                
                  <div class="tag"><a href="/tags/time">time</a></div>
                
                  <div class="tag"><a href="/tags/datetime">datetime</a></div>
                
                  <div class="tag"><a href="/tags/8601">8601</a></div>
                
                  <div class="tag"><a href="/tags/moment">moment</a></div>
                
              </div>
            </div>
            
              
                
<div class="row" id="author-bio-brian-d-foy">
  <div class="col-sm-2">
    
    <a href="/authors/brian-d-foy/"><div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div></a>
  </div>
  <div class="col-sm-10">
    <a href="/authors/brian-d-foy/"><h3>brian d foy</h3></a>
    <p><a href="http://www.pair.com/~comdog/">brian d foy</a> is a Perl trainer and writer, and a senior editor at Perl.com. He&rsquo;s the author of <a href="https://www.masteringperl.org">Mastering Perl</a>, <a href="https://leanpub.com/mojo_web_clients">Mojolicious Web Clients</a>, <a href="https://leanpub.com/learning_perl_exercises">Learning Perl Exercises</a>, and co-author of <a href="https://www.programmingperl.org">Programming Perl</a>, <a href="https://www.learning-perl.com">Learning Perl</a>, <a href="https://www.intermediateperl.com">Intermediate Perl</a> and <a href="https://www.effectiveperlprogramming.com">Effective Perl Programming</a>.</p>
    <h5><a href="/authors/brian-d-foy/">Browse their articles</a></h5>
  </div>
</div>

            
            <div class="row">
              <h3>Feedback</h3>
              <p>Something wrong with this article? Help us out by opening an issue or pull request on <a href="https://github.com/tpf/perldotcom/blob/master/content/article/time--moment-can-save-time.md">GitHub</a></p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="latest-sidebar">

  <div class="row">
    <div class="col-sm-12 centering">
      <span style="font-size:1.8em" class="antonio txt-blue-major">OUR LATEST ARTICLES</span>
    </div>
  </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/the-perl-admbassador-curtis-poe/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/the-perl-ambassador-curtis-poe/curtis-poe.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>The Perl Ambassador: Curtis &#39;Ovid&#39; Poe</h6>
          <p style="line-height:1"><small>The person behind the news of Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/a-tour-with-net-ftp/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/a-tour-with-net-ftp/thumb_kidyes.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>A tour with Net::FTP</h6>
          <p style="line-height:1"><small>How to write an FTP client in Perl</small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/shortcode_test/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/author/brian-d-foy.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>shortcode_test</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/listen-to-larry-wall-s-state-of-the-onion-2000-on-youtube/thumb_larry-wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Listen to Larry Wall&#39;s State of the Onion 2000 on YouTube</h6>
          <p style="line-height:1"><small></small></p>
      </div>
        </a>
    </div>
  
    
    
    <div class="row">
        <a href="http://localhost:1313/article/announcing-perl-7/">
      <div class="col-sm-3">
        <div class="circle-avatar" style="background-image:url(/images/announcing-perl-7/thumb_seven_on_blue_wall.jpg)"></div>
      </div>
      <div class="col-sm-9">
          <h6>Announcing Perl 7</h6>
          <p style="line-height:1"><small>Perl 5 with modern defaults</small></p>
      </div>
        </a>
    </div>
  
</div>
<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
  <script async src="/widget/toplinks/toplinks.js" type="text/javascript"></script>
    <div id="toplinks"></div>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <a class="twitter-timeline" data-height="640" data-dnt="true" data-theme="dark" href="https://twitter.com/perlfoundation?ref_src=twsrc%5Etfw">Tweets by perlfoundation</a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="row" style="margin-top:20px">
  <div class="col-sm-12 centering">
    <script src="https://www.reddit.com/r/perl/hot/.embed?limit=10&t=all" type="text/javascript"></script>
  </div>
</div>



          </div>
        </div>
      </div>
    </section>
  </section>
<script>
 
var tables, i;
tables = document.getElementsByTagName('table');
for (i=0;i<tables.length;i++) {
  tables[i].className = 'table table-striped';
}
</script>
<div class="push"></div>
<div class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
        <h5>Site Map</h5>
        <ul>
        <li><a href="/">Home</a></li>
        <hr>
        <li><a href="/about">About</a></li>
        <hr>
        <li><a href="/authors">Authors</a></li>
        <hr>
        <li><a href="/categories">Categories</a></li>
        <hr>
        <li><a href="/tags">Tags</a></li>
        <hr>
        </ul>
      </div>
      <div class="col-md-3">
        <h5>Contact Us</h5>
        <p>To get in touch, send an email to: perl.com-editor@perl.org</p>
        <p><a href="https://perl.org">
              <img src="/images/site/perl-onion_20.png" alt="Perl Onion"></a>
          <a href="https://twitter.com/intent/follow?screen_name=perlfoundation">
              <img src="/images/site/twitter_20.png" alt="twitter"></a>
          <a href="/index.xml" /><img src="/images/site/rss_20.png" alt="rss"></a>
          <a href="https://github.com/tpf/perldotcom">
              <img src="/images/site/github_light_20.png" alt="GitHub logo"></a></p>
      </div>
      <div class="col-md-2">
          <h5>License</h5>
          <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>.</p>
          <p><a rel="license" href="https://creativecommons.org/licenses/by-nc/3.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/3.0/88x31.png" /></a></p>
      </div>
      <div class="col-md-5">
          <h5>Legal</h5>
          <p>Perl.com and the authors make no representations with respect to the accuracy or completeness of the contents of all work on this website and specifically disclaim all warranties, including without limitation warranties of fitness for a particular purpose. The information published on this website may not be suitable for every situation. All work on this website is provided with the understanding that Perl.com and the authors are not engaged in rendering professional services. Neither Perl.com nor the authors shall be liable for damages arising herefrom.</p>
      </div>
    </div>
  </div>
</div>
<script src="/javascript/jquery.min.js"></script>
<script src="/javascript/bootstrap.min.js"></script>
<script data-no-instant>document.write('<script src="/livereload.js?port=1313&mindelay=10"></' + 'script>')</script></body>
</html>

